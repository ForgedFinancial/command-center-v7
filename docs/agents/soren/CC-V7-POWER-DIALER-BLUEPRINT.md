# CC v7 â€” Power Dialer: Complete System Blueprint
## Architecture Blueprint v2.0
### Author: Soren (FF-PLN-001) | Date: 2026-02-19
### Status: AWAITING BOSS APPROVAL â€” Nothing executes until approved.

---

## BOTTOM LINE UP FRONT

This blueprint builds a **15-feature power dialer** directly into CC v7. Boss can dial 2-3 leads simultaneously via Twilio, auto-detect voicemails, bridge live humans to his browser, drop pre-recorded voicemails, see real-time call scripts, track analytics that learn the best times to call, and get a weekly intelligence brief on Telegram. Everything runs through the existing VPS sync server â†’ D1 pipeline with zero changes to the YN-CRM Worker. iPhone stays primary for personal calls. Twilio powers all business dialing.

**The 15 features at a glance:**

| # | Feature | Category | Phase |
|---|---------|----------|-------|
| 1 | Local Presence Dialing | Core | 1 |
| 2 | Answering Machine Detection (AMD) | Core | 2 |
| 3 | Multi-Line Power Dialing (2-3 lines) | Core | 2 |
| 4 | Auto-Redial | Core | 2 |
| 5 | Smart Call Queue with Priority Scoring | Core | 3 |
| 6 | Number Health Rotation + Spam Check | Core | 4 |
| 7 | Post-Call Disposition Flow | Post-Call | 2 |
| 8 | Live Call Dashboard | Post-Call | 3 |
| 9 | CNAM Caller ID Branding | Identity | 4 |
| 10 | Auto-SMS After Missed Calls | Automation | 3 |
| 11 | Voicemail Drop | Automation | 2 |
| 12 | Call Scripts / Talk Tracks | Agent Support | 3 |
| 13 | Scheduled Callback Queue | Agent Support | 3 |
| 14 | Best Time to Call Intelligence | Intelligence | 4 |
| 15 | Clawd Auto-Intelligence Suite | Intelligence | 5 |

**Key architectural decision:** Power dialer uses **server-initiated calls** (Twilio REST API `calls.create()`) because AMD requires the `machineDetection` parameter which is only available via REST, not the Client SDK. Single click-to-call from pipeline cards uses Client SDK directly (no AMD needed). Human-answered calls get bridged to Boss's browser via `<Client>boss</Client>` TwiML.

---

## TABLE OF CONTENTS

1. [Architecture Overview](#1-architecture-overview)
2. [UI/UX Design](#2-uiux-design)
3. [Twilio Integration Layer](#3-twilio-integration-layer)
4. [VPS Backend Routes](#4-vps-backend-routes)
5. [D1 Schema Changes](#5-d1-schema-changes)
6. [Smart Number Routing](#6-smart-number-routing)
7. [Auto-Redial State Machine](#7-auto-redial-state-machine)
8. [Multi-Line Call Management](#8-multi-line-call-management)
9. [Number Health Monitoring](#9-number-health-monitoring)
10. [Intelligence & Analytics](#10-intelligence--analytics)
11. [CalDAV Integration for Scheduled Callbacks](#11-caldav-integration)
12. [Compliance](#12-compliance)
13. [Build Sequence](#13-build-sequence)
14. [Cost Estimates](#14-cost-estimates)
15. [Risk Register](#15-risk-register)

---

## 1. ARCHITECTURE OVERVIEW

### System Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CC v7 Browser (React + Vite + Tailwind)               â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Pipeline   â”‚ â”‚ Lead     â”‚ â”‚ Power Dialer Panel (persistent, floating)â”‚   â”‚
â”‚  â”‚ Kanban     â”‚ â”‚ Detail   â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚ [ğŸ“][ğŸ’¬]  â”‚ â”‚ Modal    â”‚ â”‚ â”‚ Queue + Priority Scoring (F5)       â”‚ â”‚   â”‚
â”‚  â”‚            â”‚ â”‚          â”‚ â”‚ â”‚ Active Lines 1-3 + AMD status (F2-3)â”‚ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ Activity â”‚ â”‚ â”‚ Call Script Display (F12)           â”‚ â”‚   â”‚
â”‚                 â”‚ SMS Tab  â”‚ â”‚ â”‚ Disposition Inline (F7)             â”‚ â”‚   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Scripts  â”‚ â”‚ â”‚ Live Dashboard mini-stats (F8)     â”‚ â”‚   â”‚
â”‚  â”‚ Settings   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ Callback Countdown Timers (F13)    â”‚ â”‚   â”‚
â”‚  â”‚ Numbers    â”‚              â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚ Health (F6)â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”‚ CNAM (F9)  â”‚                                                             â”‚
â”‚  â”‚ VM Tmpl(11)â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Scripts(12)â”‚  â”‚ Twilio Voice SDK (@twilio/voice-sdk) â€” WebRTC        â”‚   â”‚
â”‚  â”‚ SMS Tmpl10 â”‚  â”‚ Receives bridged calls from server-initiated dialer  â”‚   â”‚
â”‚  â”‚ Analytics  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”‚ (F14-15)   â”‚                         â”‚                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚ HTTPS                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚   Cloudflare Worker Proxy   â”‚
                            â”‚   forged-sync â†’ VPS         â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚   VPS Sync Server (443)     â”‚
                            â”‚                             â”‚
                            â”‚   DIALER ENGINE:            â”‚
                            â”‚   Â· DialerSession class     â”‚
                            â”‚   Â· REST calls.create()     â”‚
                            â”‚   Â· AMD callback handler    â”‚
                            â”‚   Â· Bridge TwiML generator  â”‚
                            â”‚   Â· Voicemail drop (F11)    â”‚
                            â”‚   Â· Auto-SMS trigger (F10)  â”‚
                            â”‚   Â· Number health cron (F6) â”‚
                            â”‚   Â· Analytics aggregator    â”‚
                            â”‚   Â· Callback scheduler (13) â”‚
                            â”‚                             â”‚
                            â”‚   WebSocket â†’ Browser       â”‚
                            â”‚   (real-time call events)   â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚         Twilio              â”‚
                            â”‚  5 Numbers:                 â”‚
                            â”‚  (630) 489-6325 IL-West     â”‚
                            â”‚  (847) 744-8354 IL-North    â”‚
                            â”‚  (323) 849-3632 CA-LA       â”‚
                            â”‚  (469) 275-4702 TX-DFW      â”‚
                            â”‚  (984) 600-4966 NC-RAL      â”‚
                            â”‚                             â”‚
                            â”‚  Voice + AMD + Recording    â”‚
                            â”‚  Messaging (A2P pending)    â”‚
                            â”‚  CNAM Registration          â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚ PSTN
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚      Lead's Phone           â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  Mac Node (100.84.3.117:7890)      â”‚
      â”‚  iPhone primary for personal calls â”‚
      â”‚  FaceTime / iMessage fallback      â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  iCloud CalDAV                     â”‚
      â”‚  Scheduled callback events (F13)   â”‚
      â”‚  Via existing /api/calendar/events â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  Cloudflare D1                     â”‚
      â”‚  call_log, sms_messages,           â”‚
      â”‚  voicemail_templates, call_scripts,â”‚
      â”‚  call_analytics, number_health,    â”‚
      â”‚  dialer_sessions, callback_queue,  â”‚
      â”‚  sms_templates                     â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### How All 15 Features Interconnect

```
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  DIALER SESSION      â”‚
                        â”‚  (server-side)       â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                          â”‚                          â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
   â”‚ F5:Smartâ”‚             â”‚ F1:Local    â”‚            â”‚ F6:Number   â”‚
   â”‚ Queue   â”‚â”€â”€â”€â”€sortsâ”€â”€â”€â–¶â”‚ Presence    â”‚â—€â”€â”€picksâ”€â”€â”€â”€â”‚ Health      â”‚
   â”‚ Priorityâ”‚    leads    â”‚ Dialing     â”‚   number   â”‚ Rotation    â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
        â”‚                         â”‚                          â”‚
        â”‚ F14: Best Time         â”‚ calls.create()           â”‚ health score
        â”‚ adjusts order          â”‚                          â”‚ influences pick
        â”‚                   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                    â”‚
        â”‚                   â”‚ F2: AMD  â”‚                    â”‚
        â”‚                   â””â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”˜                    â”‚
        â”‚            machineâ”€â”€â”˜   â””â”€â”€human                  â”‚
        â”‚              â”‚               â”‚                    â”‚
        â”‚         â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”              â”‚
        â”‚         â”‚ F11:VM  â”‚    â”‚ F3:Multi â”‚              â”‚
        â”‚         â”‚ Drop    â”‚    â”‚ Line Mgmtâ”‚              â”‚
        â”‚         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â”‚
        â”‚              â”‚              â”‚ bridge to Boss      â”‚
        â”‚         â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”              â”‚
        â”‚         â”‚ F4:Auto â”‚    â”‚ F12:Call â”‚              â”‚
        â”‚         â”‚ Redial  â”‚    â”‚ Scripts  â”‚              â”‚
        â”‚         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â”‚
        â”‚              â”‚              â”‚ call ends           â”‚
        â”‚    all attemptsâ”‚        â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”             â”‚
        â”‚    exhausted  â”‚        â”‚ F7:Dispo â”‚             â”‚
        â”‚         â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”    â”‚ Flow     â”‚             â”‚
        â”‚         â”‚ F10:Autoâ”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜             â”‚
        â”‚         â”‚ SMS     â”‚         â”‚                    â”‚
        â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”             â”‚
        â”‚                        â”‚ F13:     â”‚             â”‚
        â”‚                        â”‚ Callback â”‚             â”‚
        â”‚                        â”‚ Schedule â”‚             â”‚
        â”‚                        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜             â”‚
        â”‚                             â”‚                    â”‚
        â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â””â”€â”€â”€â–¶â”‚ F8: Live Dashboard  â—€â”€â”€ all events      â”‚â—€â”€â”€â”˜
             â”‚ F14: Best Time Intel â—€â”€â”€ call outcomes   â”‚
             â”‚ F15: Intelligence Suite â—€â”€â”€ all metrics  â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                        F9: CNAM Branding
                        (configured once in Settings,
                         applies to all outbound)
```

### Where Things Live

| Component | Location | Why |
|-----------|----------|-----|
| Dialer UI + call state | CC v7 React frontend | Real-time user interaction |
| Twilio Voice SDK | Browser (WebRTC) | Receives bridged calls |
| Dialer engine (session, queue, AMD, bridge) | VPS sync server (in-memory) | Server-initiated calls for AMD; credentials stay server-side |
| Access Token generation | VPS sync server | API Key Secret server-side only |
| TwiML handlers | VPS sync server | Twilio fetches instructions during calls |
| Call/SMS/analytics logs | Cloudflare D1 (via VPS direct REST) | Co-located with lead data |
| Number health cron | VPS cron (daily) | Checks spam APIs server-side |
| Voicemail recordings | Twilio Asset Storage | Served via `<Play>` TwiML |
| Call scripts | D1 `call_scripts` table | Editable from Settings |
| Callback scheduling | VPS â†’ CalDAV API | Creates iCloud calendar events |
| Intelligence aggregation | VPS cron (hourly + weekly) | Crunches call_log data â†’ analytics tables |
| Weekly brief | VPS cron (Monday 7am CT) â†’ Telegram | Sent via OpenClaw message API |
| WebSocket events | VPS sync server | Real-time call status to browser |
| iPhone/FaceTime actions | Mac node via phone-actions.js | Preserved â€” iPhone primary for personal |

### What We Do NOT Touch
- **YN-CRM Worker** â€” zero modifications
- **Existing phone-actions.js routes** â€” left intact
- **Existing CRM proxy** â€” untouched

---

## 2. UI/UX DESIGN

### 2.1 The Dialer Panel â€” Floating, Persistent, Non-Intrusive

The power dialer is a **floating panel** anchored bottom-right. Persists across all CC v7 views. Four visual states:

#### State A: Collapsed (Idle) â€” FAB Button
```
                                    â”Œâ”€â”€â”€â”€â”€â”€â”
                                    â”‚  ğŸ“  â”‚  â† 56px circle, var(--accent)
                                    â”‚  3   â”‚  â† badge = queue count
                                    â””â”€â”€â”€â”€â”€â”€â”˜
```
- Click opens dialer panel (State B)
- No badge when queue empty

#### State B: Expanded Panel (Ready to Dial)
400px wide Ã— auto height. Bottom-right, 24px inset. `z-index: 9990`.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš¡ Power Dialer                    â”€  â–¡  Ã—  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  QUEUE (12 leads)              [âš™ï¸ Config]  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸ”µ 1. John Smith    NC  (984) 55.. â”‚    â”‚ â† Priority indicator dot
â”‚  â”‚ ğŸŸ¡ 2. Mary Johnson  IL  (630) 55.. â”‚    â”‚   ğŸ”µ NEW  ğŸŸ¡ Callback due
â”‚  â”‚ âšª 3. Bob Williams  TX  (469) 55.. â”‚    â”‚   ğŸŸ¢ Follow-up  âšª Aged
â”‚  â”‚ âšª 4. Lisa Davis    CA  (323) 55.. â”‚    â”‚
â”‚  â”‚ ğŸŸ¢ 5. Tom Brown     IL  (847) 55.. â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  [Load More â–¾]                              â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Lines: [2 â–¾] â”‚ â”‚ Redial: [2x â–¾]  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€ Callback Due â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â† F13: if callbacks pending
â”‚  â”‚ â° Mary Johnson in 12 min (3:00 PM) â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚         [ â–¶  START DIALING ]        â”‚    â”‚ â† Big green CTA
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                             â”‚
â”‚  ğŸ“Š Today: 0 calls Â· 0 connects Â· 0:00     â”‚ â† F8: mini dashboard
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### State C: Active Calling Session
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš¡ Power Dialer  â— LIVE            â”€  â–¡  Ã—  â”‚ â† pulsing green dot
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  LINE 1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸ“ John Smith    NC  (984) 555-1234â”‚    â”‚
â”‚  â”‚ â± 00:12  â— RINGING                â”‚    â”‚
â”‚  â”‚ Via: (984) 600-4966                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                             â”‚
â”‚  LINE 2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸ“ Mary Johnson  IL  (630) 555-5678â”‚    â”‚
â”‚  â”‚ â± 00:08  â— RINGING                â”‚    â”‚
â”‚  â”‚ Via: (630) 489-6325                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                             â”‚
â”‚  â”€â”€ SCRIPT (F12) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â–¾ â”‚ â† collapsible
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ "Hi John, this is Dano from Forged â”‚    â”‚
â”‚  â”‚  Financial. I see you requested    â”‚    â”‚
â”‚  â”‚  info about FEX coverage in NC..." â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                             â”‚
â”‚  NEXT: Bob Williams (TX)                    â”‚
â”‚  ğŸ“Š 14 calls Â· 3 connects Â· 12:40 Â· 21%    â”‚
â”‚  [ â¹ STOP DIALER ]                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### State C2: Connected to Live Human
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš¡ Power Dialer  â— CONNECTED       â”€  â–¡  Ã—  â”‚ â† solid green
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ âœ… John Smith â€” LIVE    â± 02:34    â”‚    â”‚
â”‚  â”‚ NC Â· FEX Â· $50k face Â· Via (984)   â”‚    â”‚ â† lead context
â”‚  â”‚                                     â”‚    â”‚
â”‚  â”‚ [ğŸ”‡ Mute] [â¸ Hold] [ğŸ”´ End Call]  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                             â”‚
â”‚  â”€â”€ SCRIPT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â–¾ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ "Hi John, this is Dano from Forged â”‚    â”‚
â”‚  â”‚  Financial. I see you requested    â”‚    â”‚
â”‚  â”‚  info about FEX coverage in NC.   â”‚    â”‚
â”‚  â”‚  Do you have a few minutes?"      â”‚    â”‚
â”‚  â”‚                                     â”‚    â”‚
â”‚  â”‚  â†’ If yes: "Great! Let me ask a   â”‚    â”‚
â”‚  â”‚    few questions to find the best  â”‚    â”‚
â”‚  â”‚    fit for you..."                 â”‚    â”‚
â”‚  â”‚  â†’ If no: "No problem â€” when's a  â”‚    â”‚
â”‚  â”‚    good time to call back?"        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                             â”‚
â”‚  NEXT: Bob Williams (TX)                    â”‚
â”‚  ğŸ“Š 15 calls Â· 4 connects Â· 15:14 Â· 27%    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### State D: Post-Call Disposition (Inline â€” F7)
Call ends â†’ panel transitions to disposition view. No modal. Speed matters.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš¡ Power Dialer                    â”€  â–¡  Ã—  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  âœ… Call ended Â· John Smith Â· â± 4:32       â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸ“ Called      â”‚ ğŸ“… Follow-Up      â”‚    â”‚ â† 2-column grid of tiles
â”‚  â”‚ ğŸ“‹ Appt Book  â”‚ ğŸš« Appt No-Show   â”‚    â”‚
â”‚  â”‚ ğŸ¯ Pitched    â”‚ ğŸ‰ Sold           â”‚    â”‚
â”‚  â”‚ âŒ Not Inter. â”‚ ğŸ“µ Bad Number      â”‚    â”‚
â”‚  â”‚ ğŸŒ± Nurture    â”‚ ğŸ”„ Req Replace    â”‚    â”‚
â”‚  â”‚ ğŸ“¨ Replace Subâ”‚ ğŸ›‘ Add to DNC     â”‚    â”‚
â”‚  â”‚               â”‚ ğŸ†• New Lead       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                             â”‚
â”‚  Notes: [________________________________]  â”‚
â”‚                                             â”‚
â”‚  [Skip â†’ auto-log "Called"]                 â”‚
â”‚                                             â”‚
â”‚  Auto-advance in 5s... â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘           â”‚ â† progress bar
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Disposition tile behaviors:**
- **Sold** â†’ applies disposition + auto-opens policy form (per disposition blueprint)
- **Follow-Up** â†’ applies disposition + opens inline date/time picker â†’ creates CalDAV event (F13)
- **Appt Booked** â†’ applies disposition + opens inline date/time picker â†’ creates CalDAV event (F13)
- **Bad Number** â†’ flags lead, skips in future dialer sessions
- **Add to DNC** â†’ flags lead, permanent skip
- **All others** â†’ one-click apply, auto-advance to next lead
- **Skip** â†’ auto-logs as "Called" after 5s countdown. Boss can keep clicking elsewhere.

#### State E: Mini-Player (Collapsed During Active Call)
When Boss minimizes during active call:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ John Smith  â± 03:22  [ğŸ”‡ Mute] [ğŸ”´ End]  [â†— Expand]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
Fixed bottom, full width, 48px height. `z-index: 9999`.

### 2.2 Queue Loading & Configuration

The âš™ï¸ Config button opens a slide-out config panel within the dialer:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš™ï¸ Dialer Configuration           [â† Back] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚ LOAD QUEUE FROM:                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚ â”‚ Pipeline Stage  [New Lead      â–¾]   â”‚     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚ [ Load 24 Leads ]                           â”‚
â”‚                                             â”‚
â”‚ â”€â”€â”€ or â”€â”€â”€                                  â”‚
â”‚ [ Load from Filtered View ]                 â”‚ â† uses current pipeline filters
â”‚ [ Load Callback Queue (3 due) ]             â”‚ â† F13
â”‚                                             â”‚
â”‚ LINES:                                      â”‚
â”‚ â—‹ 1 line (standard)                         â”‚
â”‚ â— 2 lines (recommended)                     â”‚
â”‚ â—‹ 3 lines (aggressive)                      â”‚
â”‚                                             â”‚
â”‚ AUTO-REDIAL:                                â”‚
â”‚ â—‹ Off  â— 2x  â—‹ 3x                          â”‚
â”‚                                             â”‚
â”‚ REDIAL DELAY:                               â”‚
â”‚ â— End of queue  â—‹ 5s  â—‹ 30s                â”‚
â”‚                                             â”‚
â”‚ VOICEMAIL HANDLING:                         â”‚
â”‚ â— Skip (AMD auto-hangup)                   â”‚
â”‚ â—‹ Drop voicemail: [Intro      â–¾]           â”‚ â† F11
â”‚                                             â”‚
â”‚ SMART QUEUE (F5):                           â”‚
â”‚ [âœ“] Auto-prioritize leads                  â”‚
â”‚   NEW â†’ Callbacks due â†’ Follow-ups â†’        â”‚
â”‚   Hot leads â†’ Aged                          â”‚
â”‚                                             â”‚
â”‚ CALLER ID:                                  â”‚
â”‚ â— Auto-match area (smart routing)           â”‚
â”‚ â—‹ Always use: [(847) 744-8354    â–¾]         â”‚
â”‚                                             â”‚
â”‚ AUTO-SMS ON EXHAUST (F10):                  â”‚
â”‚ [âœ“] Send SMS after all attempts fail        â”‚
â”‚ Template: [Missed Call Follow-Up â–¾]         â”‚
â”‚ âš ï¸ SMS pending A2P approval                â”‚ â† hidden once approved
â”‚                                             â”‚
â”‚ SKIP:                                       â”‚
â”‚ [âœ“] Skip Bad Number flagged                â”‚
â”‚ [âœ“] Skip DNC flagged                       â”‚
â”‚                                             â”‚
â”‚ SCRIPT TEMPLATE:                            â”‚
â”‚ [New Lead - First Call â–¾]                   â”‚ â† F12
â”‚                                             â”‚
â”‚ [ Save Config ]                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 Live Call Dashboard (F8)

Two views: **mini stats** in dialer panel footer (always visible) and **full dashboard** in a dedicated Settings > Analytics tab.

**Mini Stats (dialer panel footer):**
```
ğŸ“Š 47 calls Â· 12 connects Â· 38:20 talk Â· 25.5% Â· 11.8/hr
```

**Full Dashboard (Settings > Dialer Analytics):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š Dialer Dashboard                    Today â–¾  [This Week]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚    47    â”‚ â”‚    12    â”‚ â”‚  25.5%   â”‚ â”‚  38:20   â”‚          â”‚
â”‚  â”‚  Calls   â”‚ â”‚ Connects â”‚ â”‚ Connect% â”‚ â”‚Talk Time â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  3:11    â”‚ â”‚  11.8    â”‚ â”‚    3     â”‚ â”‚   8.5%   â”‚          â”‚
â”‚  â”‚ Avg Call â”‚ â”‚Calls/Hr  â”‚ â”‚  Sold    â”‚ â”‚Close Rateâ”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€ Talk Time vs Idle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  Talk: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  42%                         â”‚
â”‚  Idle: â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  58%                      â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€ Dispositions Today â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  Called: 8  â”‚ Follow-Up: 5  â”‚ Sold: 3  â”‚ Not Int: 4           â”‚
â”‚  Appt: 2   â”‚ Nurture: 3    â”‚ Bad#: 2  â”‚ DNC: 1               â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€ Best Times (F14) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ (2+ weeks data) â”€â”€  â”‚
â”‚  NC leads: 10-11 AM (3x answer rate)                           â”‚
â”‚  TX leads: 2-4 PM (2.1x answer rate)                           â”‚
â”‚  IL leads: 9-10 AM (1.8x answer rate)                          â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€ Number Performance (F15) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  (984) 600-4966  NC  â”‚ 34% connect â”‚ ğŸŸ¢ Healthy               â”‚
â”‚  (469) 275-4702  TX  â”‚ 28% connect â”‚ ğŸŸ¢ Healthy               â”‚
â”‚  (847) 744-8354  IL  â”‚ 22% connect â”‚ ğŸŸ¡ Monitor               â”‚
â”‚  (630) 489-6325  IL  â”‚ 19% connect â”‚ ğŸŸ¢ Healthy               â”‚
â”‚  (323) 849-3632  CA  â”‚ 15% connect â”‚ ğŸŸ¢ Healthy               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.4 Settings Panels (New Sections)

#### Settings > Phone Numbers (F6 + F9)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“± Phone Numbers                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â­ (630) 489-6325 Â· West Chicago Â· IL         ğŸŸ¢ Healthy  â”‚  â”‚
â”‚  â”‚   CNAM: "Forged Financial" âœ… Active                       â”‚  â”‚
â”‚  â”‚   Voice âœ… Â· SMS â³ A2P Pending                             â”‚  â”‚
â”‚  â”‚   Connect Rate: 19% Â· 142 calls this month                â”‚  â”‚
â”‚  â”‚   Spam Check: Clean (checked 2h ago)                       â”‚  â”‚
â”‚  â”‚   [Set CNAM] [Check Health] [Set Default]                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   (847) 744-8354 Â· North Chicago Â· IL         ğŸŸ¡ Monitor  â”‚  â”‚
â”‚  â”‚   CNAM: "Forged Financial" âœ… Active                       â”‚  â”‚
â”‚  â”‚   Voice âœ… Â· SMS â³ A2P Pending                             â”‚  â”‚
â”‚  â”‚   Connect Rate: 22% (â†“ from 28% last week)                â”‚  â”‚
â”‚  â”‚   Spam Check: Flagged on Hiya (checked 2h ago)             â”‚  â”‚
â”‚  â”‚   [Set CNAM] [Check Health] [Deprioritize]                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  ... (3 more numbers) ...                                        â”‚
â”‚                                                                  â”‚
â”‚  Number Rotation: [Auto-rotate â–¾] (spreads volume evenly)       â”‚
â”‚  Health Check Schedule: Every 12 hours                           â”‚
â”‚                                                                  â”‚
â”‚  A2P 10DLC Status: Submitted Feb 19 â€” est. ~Mar 5               â”‚
â”‚  Messaging Service: MGd5d41336ff45895b06005d2ab3a6995d           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**CNAM inline editor** (click "Set CNAM" on any number):
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Set Caller ID Name for (630) 489-6325          â”‚
â”‚                                                â”‚
â”‚ Display Name: [Forged Financial_______]        â”‚ â† 15 char max
â”‚                                                â”‚
â”‚ Current Status: âœ… Active                      â”‚
â”‚ Last Updated: Feb 15, 2026                     â”‚
â”‚ Note: CNAM propagation takes 24-48 hours       â”‚
â”‚                                                â”‚
â”‚ [Update CNAM]  [Cancel]                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Settings > Voicemail Templates (F11)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¤ Voicemail Drop Templates                     [+ New]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ“¼ Intro Voicemail                          â± 0:28        â”‚  â”‚
â”‚  â”‚ "Hi, this is Dano from Forged Financial..."                â”‚  â”‚
â”‚  â”‚ [â–¶ Play] [ğŸ”´ Re-record] [âœï¸ Rename] [ğŸ—‘]                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ“¼ Follow-Up                                â± 0:22        â”‚  â”‚
â”‚  â”‚ "Hey, this is Dano calling back about..."                  â”‚  â”‚
â”‚  â”‚ [â–¶ Play] [ğŸ”´ Re-record] [âœï¸ Rename] [ğŸ—‘]                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ“¼ Callback Request                         â± 0:18        â”‚  â”‚
â”‚  â”‚ "Hi, returning your call. Give me a ring..."               â”‚  â”‚
â”‚  â”‚ [â–¶ Play] [ğŸ”´ Re-record] [âœï¸ Rename] [ğŸ—‘]                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€ Recording â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  Record via browser microphone.                                  â”‚
â”‚  [ğŸ¤ Start Recording]                                           â”‚
â”‚                                                                  â”‚
â”‚  Default for dialer: [Intro Voicemail â–¾]                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Recording flow:**
1. Click "Start Recording" â†’ browser `MediaRecorder` API captures audio
2. Click "Stop" â†’ preview playback
3. Click "Save" â†’ uploads WAV to VPS â†’ VPS stores in Twilio Assets (or local file served via TwiML `<Play>` URL)
4. Each template gets a name, audio URL, duration, created date

#### Settings > Call Scripts (F12)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ Call Scripts                                  [+ New]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ“„ New Lead - First Call                      [Default]    â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚ "Hi {Name}, this is Dano from Forged Financial.           â”‚  â”‚
â”‚  â”‚  I see you requested info about {LeadType} coverage       â”‚  â”‚
â”‚  â”‚  in {State}. Do you have a few minutes?"                  â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â†’ If yes: "Great! Let me ask a few questions to          â”‚  â”‚
â”‚  â”‚    find the best fit for your needs..."                   â”‚  â”‚
â”‚  â”‚  â†’ If no: "No problem â€” when's a good time to call       â”‚  â”‚
â”‚  â”‚    back?"                                                 â”‚  â”‚
â”‚  â”‚  â†’ Objection - cost: "I completely understand. The        â”‚  â”‚
â”‚  â”‚    good news is these policies start as low as..."        â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚ [âœï¸ Edit] [ğŸ“‹ Duplicate] [ğŸ—‘]                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ“„ Follow-Up Call                                          â”‚  â”‚
â”‚  â”‚ "Hey {Name}, this is Dano from Forged Financial.          â”‚  â”‚
â”‚  â”‚  We spoke {LastCallRelative} about {LeadType}..."         â”‚  â”‚
â”‚  â”‚ [âœï¸ Edit] [ğŸ“‹ Duplicate] [ğŸ—‘]                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ“„ Aged Lead                                               â”‚  â”‚
â”‚  â”‚ ğŸ“„ Scheduled Callback                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  Available Variables:                                            â”‚
â”‚  {Name} {FirstName} {LastName} {LeadType} {State} {FaceAmount}  â”‚
â”‚  {LastCallRelative} {LastCallDate} {CallAttempts}                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Scripts are edited in a simple textarea with variable highlighting. No WYSIWYG editor â€” just markdown-like plain text with `â†’` for branches.

#### Settings > SMS Templates (F10)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’¬ SMS Templates                                  [+ New]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ“© Missed Call Follow-Up                      [Auto-Send]  â”‚  â”‚
â”‚  â”‚ "Hi {Name}, I tried reaching you about {LeadType}         â”‚  â”‚
â”‚  â”‚  coverage. When's a good time to connect?                  â”‚  â”‚
â”‚  â”‚  - Dano, Forged Financial"                                â”‚  â”‚
â”‚  â”‚ 124/160 chars Â· 1 segment                                 â”‚  â”‚
â”‚  â”‚ [âœï¸ Edit] [ğŸ—‘]                                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ“© Intro SMS                                               â”‚  â”‚
â”‚  â”‚ ğŸ“© Appointment Confirmation                                â”‚  â”‚
â”‚  â”‚ ğŸ“© Calendar Link                                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  âš ï¸ SMS sending requires A2P approval (pending ~Mar 5)         â”‚
â”‚  Available: {Name} {LeadType} {State} {CalendarLink}            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.5 Click-to-Call from Pipeline Cards

Every pipeline card has action buttons:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ John Smith                  â”‚
â”‚ FEX Â· NC Â· (984) 555-1234  â”‚
â”‚ ğŸ“Ã—2  Last: 2 days ago     â”‚
â”‚                             â”‚
â”‚ [ğŸ“] [ğŸ’¬] [ğŸ“‹ Dispose]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- **ğŸ“ Single click** â†’ Twilio browser call (Client SDK, no AMD). Smart number auto-selected.
- **ğŸ“ Long-press/right-click** â†’ method picker (Twilio / iPhone / FaceTime)
- **ğŸ’¬** â†’ SMS thread (or "A2P pending" state)
- **ğŸ“‹ Dispose** â†’ disposition modal (per existing blueprint)
- **Drag to dialer FAB** â†’ adds lead to dialer queue (stretch goal)

### 2.6 Visual Design Rules

All dialer UI follows existing CC v7 theme system:
- `var(--surface-1)` panel background
- `var(--surface-2)` cards within panel
- `var(--accent)` active/connected states
- `var(--text-primary)` names; `var(--text-secondary)` metadata
- `var(--danger)` (#ef4444) end call
- `var(--success)` (#4ade80) connected/start
- Phone numbers: `#f59e0b` (amber), bold, 12px
- Status transitions: `200ms ease`. No other animations except:
  - Pulsing dot on LIVE/CONNECTED states
  - Progress bar countdown on disposition auto-advance
- Panel shadow: `shadow-2xl` for floating depth
- Border radius: `rounded-xl` for panel, `rounded-lg` for inner cards

---

## 3. TWILIO INTEGRATION LAYER

### 3.1 Two Call Modes

| Mode | Initiation | AMD | Use Case |
|------|-----------|-----|----------|
| **Single Call** | Client SDK `device.connect()` | No | Click-to-call from pipeline card |
| **Power Dialer** | Server REST `calls.create()` | Yes | Multi-line batch dialing |

### 3.2 Twilio Client SDK (Browser â€” WebRTC)

Used for: receiving bridged calls from power dialer, single click-to-call, inbound calls.

```javascript
// TwilioManager â€” singleton
class TwilioManager {
  constructor() {
    this.device = null;
    this.activeCall = null;
    this.token = null;
  }

  async initialize() {
    const resp = await fetch('/api/twilio/token?identity=boss');
    const { token } = await resp.json();
    this.token = token;

    this.device = new Device(token, {
      codecPreferences: ['opus', 'pcmu'],
      enableRingingState: true,
      logLevel: 'warn',
    });

    await this.device.register();
    this.device.on('incoming', (call) => this.handleIncoming(call));
    this.device.on('tokenWillExpire', () => this.refreshToken());
    this.device.on('error', (err) => console.error('[Twilio]', err));
  }

  // Single call (click-to-call from pipeline)
  async callLead(lead) {
    const call = await this.device.connect({
      params: {
        To: lead.phone,
        LeadId: lead.id,
        LeadState: lead.state || '',
      }
    });
    this.activeCall = call;
    this.bindCallEvents(call);
    return call;
  }

  // Accept incoming/bridged call (power dialer bridges to client)
  handleIncoming(call) {
    // In power dialer mode: auto-accept (Boss expects the bridge)
    if (dialerStore.isActive) {
      call.accept();
      this.activeCall = call;
      this.bindCallEvents(call);
      return;
    }
    // Manual mode: show incoming call UI
    dialerStore.setIncoming(call);
  }

  bindCallEvents(call) {
    call.on('accept', () => dialerStore.setConnected(call));
    call.on('disconnect', () => this.handleDisconnect());
    call.on('cancel', () => this.handleDisconnect());
    call.on('error', (err) => console.error('[Call Error]', err));
  }

  handleDisconnect() {
    this.activeCall = null;
    dialerStore.setCallEnded();
  }

  mute(on) { this.activeCall?.mute(on); }
  hangup() { this.activeCall?.disconnect(); }

  async refreshToken() {
    const resp = await fetch('/api/twilio/token?identity=boss');
    const { token } = await resp.json();
    this.device.updateToken(token);
  }
}
```

### 3.3 Server-Initiated Calls (Power Dialer with AMD)

The VPS DialerSession creates calls via REST API:

```javascript
async function initiateDialerCall(to, from, leadId, sessionId, enableAMD, vmDropUrl) {
  const params = {
    url: `${BASE_URL}/twilio/voice/dialer?leadId=${leadId}&sessionId=${sessionId}`,
    to,
    from,
    statusCallback: `${BASE_URL}/twilio/status`,
    statusCallbackEvent: ['initiated', 'ringing', 'answered', 'completed'],
    statusCallbackMethod: 'POST',
    timeout: 25,
  };

  if (enableAMD) {
    params.machineDetection = 'DetectMessageEnd';
    params.asyncAmdStatusCallback = `${BASE_URL}/twilio/amd?leadId=${leadId}&sessionId=${sessionId}&vmDrop=${vmDropUrl || ''}`;
    params.asyncAmdStatusCallbackMethod = 'POST';
    params.machineDetectionTimeout = 3; // 3 seconds max for AMD decision
  }

  return await twilioClient.calls.create(params);
}
```

### 3.4 AMD Callback + Voicemail Drop (F2 + F11)

```javascript
// POST /twilio/amd
app.post('/twilio/amd', async (req, res) => {
  const { CallSid, AnsweredBy } = req.body;
  const { leadId, sessionId, vmDrop } = req.query;

  const session = getDialerSession(sessionId);
  if (!session) return res.sendStatus(200);

  if (AnsweredBy === 'human') {
    // === HUMAN DETECTED ===
    // Check if Boss is already on another call
    if (session.bossConnectedTo && session.bossConnectedTo !== CallSid) {
      // Boss busy â€” polite drop + re-queue
      await twilioClient.calls(CallSid).update({
        url: `${BASE_URL}/twilio/voice/drop-polite`,
        method: 'POST',
      });
      session.requeueLead(leadId, false); // don't burn attempt
    } else {
      // Bridge to Boss
      session.bossConnectedTo = CallSid;
      await twilioClient.calls(CallSid).update({
        url: `${BASE_URL}/twilio/voice/bridge?leadId=${leadId}`,
        method: 'POST',
      });
      // Drop all other active lines
      session.dropAllExcept(CallSid);
      wsBroadcast('dialer:connected', { callSid: CallSid, leadId });
    }

  } else if (AnsweredBy.startsWith('machine')) {
    // === VOICEMAIL DETECTED ===
    if (vmDrop) {
      // F11: Drop voicemail recording instead of hanging up
      await twilioClient.calls(CallSid).update({
        url: `${BASE_URL}/twilio/voice/vm-drop?audio=${encodeURIComponent(vmDrop)}`,
        method: 'POST',
      });
      logCall(leadId, 'voicemail-drop', 0, session.getFromNumber(CallSid));
    } else {
      // No VM drop configured â€” just hang up
      await twilioClient.calls(CallSid).update({ status: 'completed' });
      logCall(leadId, 'voicemail', 0, session.getFromNumber(CallSid));
    }
    session.handleMachine(CallSid, leadId);

  } else {
    // Fax / unknown â€” hang up
    await twilioClient.calls(CallSid).update({ status: 'completed' });
  }

  res.sendStatus(200);
});
```

### 3.5 Voicemail Drop TwiML (F11)

```javascript
// POST /twilio/voice/vm-drop â€” Play pre-recorded voicemail after beep
app.post('/twilio/voice/vm-drop', (req, res) => {
  const { audio } = req.query;
  const twiml = new twilio.twiml.VoiceResponse();

  // AMD detected "machine_end_beep" or "machine_end_silence"
  // Twilio waited for the beep â€” now play the recording
  twiml.play(audio); // URL to pre-recorded voicemail WAV/MP3
  twiml.hangup();

  res.type('text/xml');
  res.send(twiml.toString());
});
```

**Voicemail recording storage:** Recordings are uploaded to VPS and served from a static route (`/twilio/audio/:id`). Alternatively, stored in Twilio's Assets if we want Twilio to serve them directly (faster, more reliable for `<Play>`).

### 3.6 Bridge TwiML (Connect Human to Boss)

```javascript
// POST /twilio/voice/bridge
app.post('/twilio/voice/bridge', (req, res) => {
  const { leadId } = req.query;
  const twiml = new twilio.twiml.VoiceResponse();

  // Illinois two-party consent announcement
  twiml.say({ voice: 'Polly.Matthew' },
    'This call may be recorded for quality purposes.');

  const dial = twiml.dial({
    callerId: req.body.From,
    record: 'do-not-record', // OFF by default. Boss toggles on per-call.
    recordingStatusCallback: `${BASE_URL}/twilio/recording/status`,
    action: `${BASE_URL}/twilio/voice/bridge/complete?leadId=${leadId}`,
  });
  dial.client('boss'); // Ring Boss's Twilio Client SDK in browser

  res.type('text/xml');
  res.send(twiml.toString());
});
```

### 3.7 Access Token Generation

```javascript
app.get('/twilio/token', (req, res) => {
  const identity = req.query.identity || 'boss';
  const AccessToken = require('twilio').jwt.AccessToken;
  const VoiceGrant = AccessToken.VoiceGrant;

  const token = new AccessToken(
    process.env.TWILIO_ACCOUNT_SID,
    process.env.TWILIO_API_KEY_SID,
    process.env.TWILIO_API_KEY_SECRET,
    { identity, ttl: 3600 }
  );

  token.addGrant(new VoiceGrant({
    outgoingApplicationSid: process.env.TWILIO_TWIML_APP_SID,
    incomingAllow: true,
  }));

  res.json({ token: token.toJwt(), identity });
});
```

### 3.8 CNAM Registration (F9)

CNAM (Caller Name) registration tells carriers what name to display when Boss calls. Done via Twilio API:

```javascript
// POST /twilio/cnam/update
app.post('/twilio/cnam/update', async (req, res) => {
  const { numberSid, callerIdName } = req.body;
  // callerIdName max 15 chars, alphanumeric + spaces

  if (!callerIdName || callerIdName.length > 15) {
    return res.status(400).json({ error: 'CNAM must be 1-15 characters' });
  }

  // Update the number's caller ID name via Twilio API
  // Note: CNAM is set per-number via Twilio Console or API
  // Twilio charges $0.01/month per CNAM-registered number
  const updated = await twilioClient.incomingPhoneNumbers(numberSid).update({
    friendlyName: callerIdName, // This sets the display in Console
  });

  // For actual CNAM registration, Twilio requires a support ticket or
  // uses their CNAM Registration API (available via add-on)
  // Store the desired CNAM name in our config
  await updateNumberConfig(numberSid, { cnamName: callerIdName, cnamStatus: 'pending' });

  res.json({ success: true, status: 'pending', note: 'CNAM propagation takes 24-48 hours' });
});
```

**CNAM implementation note:** Twilio's CNAM registration is done via their Outbound Caller ID Registration. For full CNAM branding to show on recipient phones:
1. Register CNAM display name via Twilio Console â†’ Phone Numbers â†’ select number â†’ Caller ID Name
2. $0.01/month per number (negligible)
3. Takes 24-48 hours to propagate across carriers
4. Not 100% guaranteed on mobile (carriers vary) but highly effective on landlines and most mobile networks

---

## 4. VPS BACKEND ROUTES

All routes added to VPS sync server. Proxied through Cloudflare Worker.

### Complete Route Table

| Method | Path | Purpose | Called By |
|--------|------|---------|-----------|
| **Core Voice** |
| GET | `/twilio/token` | Access Token (JWT) for Client SDK | Frontend |
| POST | `/twilio/voice` | TwiML for single click-to-call | Twilio |
| POST | `/twilio/voice/inbound` | TwiML for incoming calls | Twilio |
| POST | `/twilio/status` | Call status webhook | Twilio |
| **Power Dialer** |
| POST | `/twilio/dialer/start` | Start dialer session | Frontend |
| POST | `/twilio/dialer/stop` | Stop dialer session | Frontend |
| GET | `/twilio/dialer/status` | Current session status | Frontend (poll) |
| POST | `/twilio/voice/dialer` | TwiML for dialer outbound | Twilio |
| POST | `/twilio/amd` | AMD result callback | Twilio |
| POST | `/twilio/voice/bridge` | Bridge human to Boss | Twilio |
| POST | `/twilio/voice/bridge/complete` | Bridge call ended | Twilio |
| POST | `/twilio/voice/drop-polite` | Polite disconnect TwiML | Twilio |
| POST | `/twilio/voice/vm-drop` | Play voicemail recording | Twilio |
| **SMS (F10)** |
| POST | `/twilio/sms/send` | Send outbound SMS | Frontend |
| POST | `/twilio/sms/inbound` | Receive inbound SMS | Twilio |
| POST | `/twilio/sms/status` | Delivery status | Twilio |
| **Auto-SMS (F10)** |
| POST | `/twilio/auto-sms/trigger` | Trigger auto-SMS for exhausted lead | Dialer engine |
| **Voicemail Templates (F11)** |
| GET | `/twilio/vm-templates` | List voicemail templates | Frontend |
| POST | `/twilio/vm-templates` | Create/upload voicemail | Frontend |
| DELETE | `/twilio/vm-templates/:id` | Delete voicemail template | Frontend |
| GET | `/twilio/audio/:id` | Serve voicemail audio file | Twilio `<Play>` |
| **Call Scripts (F12)** |
| GET | `/twilio/scripts` | List call scripts | Frontend |
| POST | `/twilio/scripts` | Create/update script | Frontend |
| DELETE | `/twilio/scripts/:id` | Delete script | Frontend |
| **Callback Queue (F13)** |
| GET | `/twilio/callbacks` | List pending callbacks | Frontend |
| POST | `/twilio/callbacks` | Schedule callback | Frontend |
| DELETE | `/twilio/callbacks/:id` | Cancel callback | Frontend |
| POST | `/twilio/callbacks/:id/complete` | Mark callback done | Frontend |
| **Number Health (F6)** |
| GET | `/twilio/numbers/health` | Health status for all numbers | Frontend |
| POST | `/twilio/numbers/health/check` | Trigger manual health check | Frontend |
| **CNAM (F9)** |
| GET | `/twilio/cnam` | Current CNAM config per number | Frontend |
| POST | `/twilio/cnam/update` | Update CNAM name | Frontend |
| **Analytics (F14-15)** |
| GET | `/twilio/analytics/dashboard` | Dashboard stats (today/week/month) | Frontend |
| GET | `/twilio/analytics/best-times` | Best time to call data | Frontend |
| GET | `/twilio/analytics/intelligence` | Full intelligence report | Frontend |
| POST | `/twilio/analytics/aggregate` | Trigger aggregation (cron) | Cron |
| **Call History** |
| GET | `/twilio/calls` | Call history (filterable) | Frontend |
| GET | `/twilio/calls/:id` | Single call detail | Frontend |
| GET | `/twilio/messages/:contactId` | SMS thread for contact | Frontend |
| **Recording** |
| POST | `/twilio/recording/status` | Recording complete callback | Twilio |
| POST | `/twilio/call/record-toggle` | Toggle recording mid-call | Frontend |
| **Disposition (wires to existing)** |
| POST | `/twilio/dialer/dispose` | Apply disposition + advance queue | Frontend |

### Key Route Implementations

#### Start Dialer Session

```javascript
// POST /twilio/dialer/start
app.post('/twilio/dialer/start', async (req, res) => {
  const { leads, config } = req.body;
  // config: { lines: 2, redial: 2, amd: true, callerIdMode: 'auto',
  //           vmDropTemplateId: null, autoSmsOnExhaust: true,
  //           smsTemplateId: 1, smartQueue: true, scriptTemplateId: 1 }

  if (currentDialerSession?.running) {
    return res.status(409).json({ error: 'Dialer session already active' });
  }

  let queue = leads; // Array of { id, name, phone, state, leadType, faceAmount, ... }

  // F5: Smart Queue Priority Scoring
  if (config.smartQueue) {
    queue = prioritizeQueue(queue);
  }

  // F14: Best Time to Call reordering (if enough data)
  const bestTimes = await getBestTimeData();
  if (bestTimes && Object.keys(bestTimes).length > 0) {
    queue = applyBestTimeScoring(queue, bestTimes);
  }

  const sessionId = crypto.randomUUID();
  currentDialerSession = new DialerSession({
    id: sessionId,
    queue,
    ...config,
  });

  // Log session start to D1
  await d1Exec(`INSERT INTO dialer_sessions (id, agent_id, started_at, config, queue_size, source)
    VALUES (?, 'boss', datetime('now'), ?, ?, ?)`,
    [sessionId, JSON.stringify(config), queue.length, config.source || 'manual']);

  currentDialerSession.running = true;
  currentDialerSession.dialNext(); // Start dialing

  res.json({ sessionId, queueSize: queue.length });
});
```

#### Auto-SMS Trigger (F10)

```javascript
// Called internally when a lead exhausts all redial attempts
async function triggerAutoSMS(lead, sessionConfig) {
  if (!sessionConfig.autoSmsOnExhaust) return;
  if (!a2pApproved) {
    console.log('[AUTO-SMS] Skipped â€” A2P not yet approved');
    return;
  }

  const template = await getTemplate(sessionConfig.smsTemplateId);
  if (!template) return;

  const body = fillTemplate(template.body, {
    Name: lead.name || lead.firstName || 'there',
    LeadType: lead.leadType || 'life insurance',
    State: lead.state || '',
    CalendarLink: 'https://cal.forgedfinancial.us/dano', // future
  });

  const fromNumber = selectNumberForLead(lead);

  try {
    const message = await twilioClient.messages.create({
      body,
      from: fromNumber,
      to: lead.phone,
      messagingServiceSid: process.env.TWILIO_MESSAGING_SERVICE_SID,
      statusCallback: `${BASE_URL}/twilio/sms/status`,
    });

    await d1Exec(`INSERT INTO sms_messages (twilio_sid, lead_id, direction, from_number, to_number, body, status, auto_sent)
      VALUES (?, ?, 'outbound', ?, ?, ?, 'sent', 1)`,
      [message.sid, lead.id, fromNumber, lead.phone, body]);

    console.log(`[AUTO-SMS] Sent to ${lead.name}: ${message.sid}`);
  } catch (err) {
    console.error(`[AUTO-SMS] Failed for ${lead.name}:`, err.message);
  }
}
```

#### Callback Scheduler (F13)

```javascript
// POST /twilio/callbacks
app.post('/twilio/callbacks', async (req, res) => {
  const { leadId, callbackTime, notes } = req.body;
  // callbackTime: ISO string, e.g. "2026-02-19T15:00:00-06:00"

  // Store in D1
  const id = crypto.randomUUID();
  await d1Exec(`INSERT INTO callback_queue (id, lead_id, callback_time, notes, status)
    VALUES (?, ?, ?, ?, 'pending')`,
    [id, leadId, callbackTime, notes || '']);

  // Create iCloud calendar event via CalDAV (F13)
  const lead = await getLeadById(leadId);
  const eventTime = new Date(callbackTime);
  const eventEnd = new Date(eventTime.getTime() + 15 * 60000); // 15 min duration

  try {
    await fetch(`${BASE_URL}/api/calendar/events`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        calendar: 'work', // iCloud Work calendar
        title: `ğŸ“ Callback: ${lead.name}`,
        description: `Lead: ${lead.name}\nPhone: ${lead.phone}\nType: ${lead.leadType}\n${notes || ''}`,
        startDate: eventTime.toISOString(),
        endDate: eventEnd.toISOString(),
        alarm: -5, // 5 minutes before
      }),
    });
  } catch (err) {
    console.error('[CALLBACK] CalDAV event creation failed:', err.message);
    // Non-fatal â€” callback still in queue even if calendar fails
  }

  // Schedule auto-queue: at callback_time, push lead to front of dialer queue
  scheduleCallbackReminder(id, leadId, callbackTime);

  res.json({ success: true, id, calendarEvent: true });
});

// In-memory scheduler for callback reminders
const callbackTimers = new Map();

function scheduleCallbackReminder(id, leadId, callbackTime) {
  const msUntil = new Date(callbackTime).getTime() - Date.now();
  if (msUntil <= 0) return; // Already past

  const timer = setTimeout(async () => {
    wsBroadcast('callback:due', { id, leadId, callbackTime });
    callbackTimers.delete(id);
  }, msUntil);

  callbackTimers.set(id, timer);
}

// On server start: reload pending callbacks
async function loadPendingCallbacks() {
  const rows = await d1Query(
    `SELECT id, lead_id, callback_time FROM callback_queue WHERE status = 'pending' AND callback_time > datetime('now')`
  );
  for (const row of rows) {
    scheduleCallbackReminder(row.id, row.lead_id, row.callback_time);
  }
}
```

---

## 5. D1 SCHEMA CHANGES

### New Tables

```sql
-- ============================================================
-- call_log: Every call (single click-to-call + dialer + inbound)
-- ============================================================
CREATE TABLE IF NOT EXISTS call_log (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  twilio_sid TEXT UNIQUE,
  lead_id TEXT NOT NULL,
  agent_id TEXT NOT NULL DEFAULT 'boss',
  direction TEXT NOT NULL,               -- 'outbound' | 'inbound'
  call_type TEXT NOT NULL,               -- 'single' | 'dialer' | 'inbound'
  from_number TEXT NOT NULL,
  to_number TEXT NOT NULL,
  status TEXT NOT NULL,                  -- 'completed' | 'no-answer' | 'busy' | 'failed' | 'voicemail' | 'voicemail-drop' | 'dropped-multiline'
  duration INTEGER DEFAULT 0,            -- seconds of talk time
  amd_result TEXT,                       -- 'human' | 'machine_start' | 'machine_end_beep' | etc | null
  recording_url TEXT,
  recording_duration INTEGER,
  disposition TEXT,                       -- matched disposition slug
  notes TEXT,
  dialer_session_id TEXT,                -- null for single calls
  attempt_number INTEGER DEFAULT 1,
  -- F14/F15: Analytics dimensions
  lead_state TEXT,                       -- denormalized for fast analytics
  lead_type TEXT,                        -- denormalized
  call_hour INTEGER,                     -- 0-23 UTC (computed on insert)
  call_day_of_week INTEGER,              -- 0=Sun, 6=Sat
  created_at TEXT DEFAULT (datetime('now')),
  updated_at TEXT DEFAULT (datetime('now'))
);

CREATE INDEX idx_call_log_lead ON call_log(lead_id);
CREATE INDEX idx_call_log_created ON call_log(created_at DESC);
CREATE INDEX idx_call_log_session ON call_log(dialer_session_id);
CREATE INDEX idx_call_log_analytics ON call_log(lead_state, lead_type, call_hour, call_day_of_week, status);
CREATE INDEX idx_call_log_number ON call_log(from_number, status);

-- ============================================================
-- sms_messages: All SMS (manual + auto-sent)
-- ============================================================
CREATE TABLE IF NOT EXISTS sms_messages (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  twilio_sid TEXT UNIQUE,
  lead_id TEXT,
  agent_id TEXT NOT NULL DEFAULT 'boss',
  direction TEXT NOT NULL,               -- 'outbound' | 'inbound'
  from_number TEXT NOT NULL,
  to_number TEXT NOT NULL,
  body TEXT NOT NULL,
  media_url TEXT,
  status TEXT DEFAULT 'queued',          -- queued | sent | delivered | failed | received
  segments INTEGER DEFAULT 1,
  error_code TEXT,
  auto_sent INTEGER DEFAULT 0,          -- 1 if sent by auto-SMS (F10)
  template_id INTEGER,                   -- which template was used
  created_at TEXT DEFAULT (datetime('now'))
);

CREATE INDEX idx_sms_lead ON sms_messages(lead_id, created_at DESC);
CREATE INDEX idx_sms_thread ON sms_messages(from_number, to_number, created_at);

-- ============================================================
-- dialer_sessions: Each power dialer run
-- ============================================================
CREATE TABLE IF NOT EXISTS dialer_sessions (
  id TEXT PRIMARY KEY,
  agent_id TEXT NOT NULL DEFAULT 'boss',
  started_at TEXT NOT NULL DEFAULT (datetime('now')),
  ended_at TEXT,
  config TEXT NOT NULL,                  -- JSON blob
  queue_size INTEGER NOT NULL,
  total_calls INTEGER DEFAULT 0,
  total_connects INTEGER DEFAULT 0,
  total_talk_time INTEGER DEFAULT 0,
  total_voicemails INTEGER DEFAULT 0,
  total_vm_drops INTEGER DEFAULT 0,
  total_auto_sms INTEGER DEFAULT 0,
  dispositions_summary TEXT,             -- JSON: { "Called": 5, "Sold": 2, ... }
  source TEXT,                           -- 'pipeline:new_lead' | 'manual' | 'callback_queue'
  created_at TEXT DEFAULT (datetime('now'))
);

-- ============================================================
-- voicemail_templates: Pre-recorded voicemail drops (F11)
-- ============================================================
CREATE TABLE IF NOT EXISTS voicemail_templates (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL,
  description TEXT,
  audio_url TEXT NOT NULL,               -- URL served by VPS /twilio/audio/:id
  audio_duration INTEGER,                -- seconds
  is_default INTEGER DEFAULT 0,
  created_at TEXT DEFAULT (datetime('now')),
  updated_at TEXT DEFAULT (datetime('now'))
);

-- ============================================================
-- call_scripts: Talk track templates (F12)
-- ============================================================
CREATE TABLE IF NOT EXISTS call_scripts (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL,
  category TEXT NOT NULL,                -- 'new_lead' | 'follow_up' | 'aged_lead' | 'callback'
  body TEXT NOT NULL,                    -- Plain text with {Variable} placeholders
  is_default INTEGER DEFAULT 0,
  sort_order INTEGER DEFAULT 0,
  created_at TEXT DEFAULT (datetime('now')),
  updated_at TEXT DEFAULT (datetime('now'))
);

-- ============================================================
-- sms_templates: SMS message templates (F10)
-- ============================================================
CREATE TABLE IF NOT EXISTS sms_templates (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL,
  body TEXT NOT NULL,
  category TEXT,                         -- 'missed_call' | 'intro' | 'appointment' | 'general'
  is_auto_send INTEGER DEFAULT 0,       -- 1 = used for auto-SMS after exhausted attempts
  created_at TEXT DEFAULT (datetime('now')),
  updated_at TEXT DEFAULT (datetime('now'))
);

-- ============================================================
-- callback_queue: Scheduled callbacks (F13)
-- ============================================================
CREATE TABLE IF NOT EXISTS callback_queue (
  id TEXT PRIMARY KEY,
  lead_id TEXT NOT NULL,
  agent_id TEXT NOT NULL DEFAULT 'boss',
  callback_time TEXT NOT NULL,
  notes TEXT,
  status TEXT DEFAULT 'pending',         -- 'pending' | 'completed' | 'cancelled' | 'missed'
  caldav_event_id TEXT,                  -- iCloud calendar event reference
  created_from_call_id INTEGER,          -- which call prompted this callback
  created_at TEXT DEFAULT (datetime('now')),
  completed_at TEXT
);

CREATE INDEX idx_callback_time ON callback_queue(callback_time, status);
CREATE INDEX idx_callback_lead ON callback_queue(lead_id);

-- ============================================================
-- number_health: Health tracking per Twilio number (F6)
-- ============================================================
CREATE TABLE IF NOT EXISTS number_health (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  phone_number TEXT NOT NULL,
  check_date TEXT NOT NULL,
  total_calls INTEGER DEFAULT 0,
  total_connects INTEGER DEFAULT 0,
  connect_rate REAL DEFAULT 0,
  spam_score INTEGER DEFAULT 0,          -- 0-100, higher = worse
  spam_sources TEXT,                     -- JSON: ["hiya", "nomorobo"]
  health_status TEXT DEFAULT 'healthy',  -- 'healthy' | 'monitor' | 'flagged'
  created_at TEXT DEFAULT (datetime('now'))
);

CREATE INDEX idx_health_number ON number_health(phone_number, check_date DESC);

-- ============================================================
-- call_analytics: Pre-aggregated analytics (F14-15)
-- ============================================================
CREATE TABLE IF NOT EXISTS call_analytics (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  period_type TEXT NOT NULL,             -- 'hourly' | 'daily' | 'weekly'
  period_key TEXT NOT NULL,              -- '2026-02-19T14' | '2026-02-19' | '2026-W08'
  dimension TEXT NOT NULL,               -- 'overall' | 'state:NC' | 'type:FEX' | 'number:+1984...'
  total_calls INTEGER DEFAULT 0,
  total_connects INTEGER DEFAULT 0,
  connect_rate REAL DEFAULT 0,
  total_talk_time INTEGER DEFAULT 0,
  avg_call_duration REAL DEFAULT 0,
  total_sold INTEGER DEFAULT 0,
  total_appointments INTEGER DEFAULT 0,
  avg_attempts_to_connect REAL DEFAULT 0,
  created_at TEXT DEFAULT (datetime('now')),
  UNIQUE(period_type, period_key, dimension)
);

CREATE INDEX idx_analytics_lookup ON call_analytics(period_type, dimension, period_key DESC);
```

### Modifications to Existing `leads` Table

```sql
ALTER TABLE leads ADD COLUMN last_call_at TEXT DEFAULT NULL;
ALTER TABLE leads ADD COLUMN last_call_disposition TEXT DEFAULT NULL;
ALTER TABLE leads ADD COLUMN total_calls INTEGER DEFAULT 0;
ALTER TABLE leads ADD COLUMN total_talk_time INTEGER DEFAULT 0;
ALTER TABLE leads ADD COLUMN next_callback_at TEXT DEFAULT NULL;
ALTER TABLE leads ADD COLUMN preferred_twilio_number TEXT DEFAULT NULL;
```

---

## 6. SMART NUMBER ROUTING

### Number Map

```javascript
const TWILIO_NUMBERS = [
  { number: '+16304896325', areaCode: '630', state: 'IL', region: 'Chicago West', sid: 'PN...' },
  { number: '+18477448354', areaCode: '847', state: 'IL', region: 'Chicago North', sid: 'PN...' },
  { number: '+13238493632', areaCode: '323', state: 'CA', region: 'Los Angeles', sid: 'PN...' },
  { number: '+14692754702', areaCode: '469', state: 'TX', region: 'Dallas', sid: 'PN...' },
  { number: '+19846004966', areaCode: '984', state: 'NC', region: 'Raleigh', sid: 'PN...' },
];

const DEFAULT_NUMBER = '+16304896325'; // IL West â€” Boss's home turf
```

### Routing Algorithm (4-tier)

```javascript
function selectNumberForLead(lead, healthData = null) {
  const phone = lead.phone?.replace(/\D/g, '');
  if (!phone || phone.length < 10) return DEFAULT_NUMBER;

  const leadAreaCode = phone.startsWith('1') ? phone.substring(1, 4) : phone.substring(0, 3);

  // Tier 1: Exact area code match
  let match = TWILIO_NUMBERS.find(n => n.areaCode === leadAreaCode);
  if (match && isNumberHealthy(match.number, healthData)) return match.number;

  // Tier 2: Same state match
  const leadState = lead.state || AREA_CODE_STATE[leadAreaCode];
  if (leadState) {
    match = TWILIO_NUMBERS.find(n => n.state === leadState);
    if (match && isNumberHealthy(match.number, healthData)) return match.number;
  }

  // Tier 3: Health-weighted rotation for unmatched states
  // Pick the healthiest number to maximize answer rate
  if (healthData) {
    const healthy = TWILIO_NUMBERS
      .filter(n => isNumberHealthy(n.number, healthData))
      .sort((a, b) => getHealthScore(b.number, healthData) - getHealthScore(a.number, healthData));
    if (healthy.length > 0) return healthy[0].number;
  }

  // Tier 4: Default
  return DEFAULT_NUMBER;
}

function isNumberHealthy(number, healthData) {
  if (!healthData) return true;
  const h = healthData[number];
  return !h || h.health_status !== 'flagged';
}
```

### Area Code â†’ State Map (comprehensive)

```javascript
// Full US area code â†’ state mapping (~350 entries)
// Loaded from a JSON file on VPS: /home/clawd/sync-server/data/area-codes.json
// Only showing states where Boss has numbers:
const AREA_CODE_STATE = {
  // Illinois
  '217': 'IL', '224': 'IL', '309': 'IL', '312': 'IL', '331': 'IL',
  '618': 'IL', '630': 'IL', '708': 'IL', '773': 'IL', '779': 'IL',
  '815': 'IL', '847': 'IL', '872': 'IL',
  // California
  '209': 'CA', '213': 'CA', '310': 'CA', '323': 'CA', '408': 'CA',
  '415': 'CA', '424': 'CA', '510': 'CA', '530': 'CA', '559': 'CA',
  '562': 'CA', '619': 'CA', '626': 'CA', '650': 'CA', '661': 'CA',
  '707': 'CA', '714': 'CA', '747': 'CA', '760': 'CA', '805': 'CA',
  '818': 'CA', '831': 'CA', '858': 'CA', '909': 'CA', '916': 'CA',
  '925': 'CA', '949': 'CA', '951': 'CA',
  // Texas
  '210': 'TX', '214': 'TX', '254': 'TX', '281': 'TX', '325': 'TX',
  '346': 'TX', '361': 'TX', '409': 'TX', '430': 'TX', '432': 'TX',
  '469': 'TX', '512': 'TX', '682': 'TX', '713': 'TX', '726': 'TX',
  '737': 'TX', '806': 'TX', '817': 'TX', '830': 'TX', '832': 'TX',
  '903': 'TX', '915': 'TX', '936': 'TX', '940': 'TX', '956': 'TX',
  '972': 'TX', '979': 'TX',
  // North Carolina
  '252': 'NC', '336': 'NC', '704': 'NC', '743': 'NC', '828': 'NC',
  '910': 'NC', '919': 'NC', '980': 'NC', '984': 'NC',
  // ... full map loaded from JSON file for all 50 states
};
```

### Coverage Analysis

| Lead Location | Number Used | Match Type |
|---------------|------------|------------|
| Chicago 312/773 | (630) 489-6325 or (847) 744-8354 | State match (IL) |
| Chicago 630 | (630) 489-6325 | Exact area code |
| Chicago 847 | (847) 744-8354 | Exact area code |
| Any CA area code | (323) 849-3632 | State match |
| Any TX area code | (469) 275-4702 | State match |
| Any NC area code | (984) 600-4966 | State match |
| FL, NY, OH, etc. | (630) 489-6325 | Default (or healthiest) |

---

## 7. AUTO-REDIAL STATE MACHINE

### State Diagram

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  QUEUED  â”‚ â† Lead loaded into queue
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                         â”‚ slot available
                         â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ DIALING  â”‚ â† REST calls.create() with AMD
                    â”‚ Att. N/M â”‚   M = max attempts (1-3)
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                         â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼          â–¼          â–¼          â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ HUMAN  â”‚ â”‚MACHINE â”‚ â”‚NO ANS. â”‚ â”‚ BUSY   â”‚
         â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
             â”‚          â”‚          â”‚           â”‚
             â–¼          â”‚          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚                â”‚
        â”‚CONNECTEDâ”‚     â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ to Boss â”‚     â”‚    â”‚ N < M?               â”‚
        â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â”‚    â”‚ YES â†’ REDIAL_QUEUE   â”‚
            â”‚           â”‚    â”‚ NO  â†’ EXHAUSTED       â”‚
            â–¼           â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚               â”‚
       â”‚CALL ENDS â”‚     â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚ EXHAUSTED            â”‚
           â”‚            â”‚    â”‚ â†’ F10: Auto-SMS      â”‚
           â–¼            â”‚    â”‚ â†’ Log final status   â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ DISPOSITIONâ”‚    â”‚
      â”‚ PROMPT     â”‚    â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                        â”‚
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ VM Drop (F11)? â”‚
               â”‚ YES â†’ play rec â”‚
               â”‚ NO  â†’ hangup   â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
               (same N < M check)
```

### Redial Strategy

When a lead enters the redial queue:
- **"End of queue" mode (default):** Lead goes to back of redial queue. Fresh leads dialed first, then redials. Natural ~5-15 min gap.
- **"5s delay" mode:** Lead waits 5 seconds, then re-enters at front of queue. Fast but aggressive.
- **"30s delay" mode:** Lead waits 30 seconds, then re-enters. Middle ground.

```javascript
// Inside DialerSession
handleCallResult(callSid, result) {
  const line = this.activeLines.get(callSid);
  if (!line) return;
  this.activeLines.delete(callSid);

  if (result === 'no-answer' || result === 'busy' || result === 'voicemail') {
    if (line.attempt < this.maxRedial) {
      const nextAttempt = { ...line.lead, _attempt: line.attempt + 1 };

      switch (this.redialDelay) {
        case 'end':
          this.redialQueue.push(nextAttempt);
          break;
        case '5s':
          setTimeout(() => this.queue.unshift(nextAttempt), 5000);
          break;
        case '30s':
          setTimeout(() => this.queue.unshift(nextAttempt), 30000);
          break;
      }
    } else {
      // All attempts exhausted
      triggerAutoSMS(line.lead, this.config); // F10
    }
  }

  // Try to dial next
  if (this.running) {
    setTimeout(() => this.dialNext(), 1000);
  }
}
```

---

## 8. MULTI-LINE CALL MANAGEMENT

### First-Connect-Wins Protocol

```
Boss starts 2-line dialer:

T=0s:   Call Lead A (Line 1) â†’ RINGING
T=0s:   Call Lead B (Line 2) â†’ RINGING

T=6s:   Lead A â†’ AMD: machine â†’ VM drop â†’ line freed
T=6s:   Queue Lead C on Line 1 â†’ RINGING

T=10s:  Lead B â†’ AMD: human â†’ BRIDGE to Boss
T=10s:  Lead C still ringing â†’ DISCONNECT (re-queue, no attempt burned)

T=10s:  Boss connected to Lead B
        Lines paused until Boss finishes call

T=14m:  Boss ends call with Lead B â†’ Disposition prompt
T=14m:  Boss selects "Follow-Up" â†’ logs, schedules callback

T=14m:  Lines resume: Call Lead C (Line 1) + Lead D (Line 2)
```

### Race Condition: Two Humans Answer Simultaneously

```javascript
// Mutex pattern in AMD handler
handleHumanDetected(callSid, lineInfo) {
  // Use atomic flag â€” single-threaded Node.js makes this safe
  if (this.bossConnectedTo) {
    // Boss already connected â€” polite drop this one
    this.politeDropAndRequeue(callSid, lineInfo);
    return;
  }

  // Claim the connection
  this.bossConnectedTo = callSid;

  // Bridge + drop others
  this.bridgeToBoss(callSid, lineInfo.lead);
  this.dropAllExcept(callSid);
}
```

**What the dropped lead hears:**
- If dropped before they answered: nothing (call just stops ringing)
- If dropped after answering (race condition): TwiML plays "We'll call you right back, thank you" â†’ hangup. Lead re-queued at front.

### Line Count Guidance

| Lines | Throughput | Answer Waste | Best For |
|-------|-----------|--------------|----------|
| 1 | ~15-20 calls/hr | 0% | Follow-up calls, known responsive leads |
| 2 | ~25-35 calls/hr | ~15% | **Recommended default** â€” balanced |
| 3 | ~35-45 calls/hr | ~25% | Cold lists with low answer rates |

---

## 9. NUMBER HEALTH MONITORING (F6)

### What We Check

| Source | What It Tells Us | API/Method | Cost |
|--------|-----------------|------------|------|
| **Internal connect rate** | Our own data â€” answer rate per number | D1 query on `call_log` | Free |
| **Twilio Trust Hub** | Twilio's SHAKEN/STIR attestation level | Twilio API | Free |
| **Free Caller Registry** | If number is registered as legitimate | fcr.gov lookup | Free |
| **Nomorobo** | Robocall/spam scoring | nomorobo.com API | Free tier, then $0.01/lookup |
| **Hiya** | Carrier-level spam labels ("Spam Likely") | hiya.com/products/connect API | Enterprise pricing â€” manual check initially |
| **Should I Answer** | Community-reported spam | shouldianswer.com API | Free limited |

### Practical Implementation

Given cost constraints, we'll use a **hybrid approach**:

1. **Internal analytics (primary):** Track connect rate per number from `call_log`. If rate drops >30% week-over-week, flag as "monitor."
2. **Free Caller Registry:** Automated API check to ensure numbers are registered. Free.
3. **Manual spam check:** For flagged numbers, VPS runs a headless check against free spam lookup sites. Not real-time but good enough for daily health checks.
4. **Twilio SHAKEN/STIR:** Check via Twilio API that all numbers have A-attestation.

### Health Scoring Algorithm

```javascript
async function calculateNumberHealth(phoneNumber) {
  // 1. Internal connect rate (last 7 days)
  const stats = await d1Query(`
    SELECT
      COUNT(*) as total,
      SUM(CASE WHEN status IN ('completed', 'voicemail', 'voicemail-drop') THEN 1 ELSE 0 END) as answered,
      SUM(CASE WHEN status = 'completed' AND amd_result = 'human' THEN 1 ELSE 0 END) as humans
    FROM call_log
    WHERE from_number = ? AND created_at > datetime('now', '-7 days')
  `, [phoneNumber]);

  const connectRate = stats.total > 0 ? stats.humans / stats.total : 0;

  // 2. Week-over-week trend
  const prevWeek = await d1Query(`
    SELECT COUNT(*) as total,
      SUM(CASE WHEN status = 'completed' AND amd_result = 'human' THEN 1 ELSE 0 END) as humans
    FROM call_log
    WHERE from_number = ? AND created_at BETWEEN datetime('now', '-14 days') AND datetime('now', '-7 days')
  `, [phoneNumber]);
  const prevRate = prevWeek.total > 0 ? prevWeek.humans / prevWeek.total : connectRate;
  const trend = prevRate > 0 ? (connectRate - prevRate) / prevRate : 0;

  // 3. External spam check (cached, run daily)
  const spamScore = await getCachedSpamScore(phoneNumber);

  // Compute health status
  let status = 'healthy';
  let score = 100;

  if (spamScore > 50) { status = 'flagged'; score -= 50; }
  else if (spamScore > 20) { status = 'monitor'; score -= 20; }

  if (connectRate < 0.10 && stats.total > 20) { status = 'monitor'; score -= 20; }
  if (trend < -0.30 && stats.total > 20) { status = 'monitor'; score -= 15; }

  return {
    phoneNumber,
    connectRate: Math.round(connectRate * 100),
    trend: Math.round(trend * 100),
    spamScore,
    healthStatus: status,
    healthScore: Math.max(0, score),
    totalCalls: stats.total,
  };
}
```

### Health Check Cron

```javascript
// Runs every 12 hours via node-cron
cron.schedule('0 */12 * * *', async () => {
  for (const num of TWILIO_NUMBERS) {
    const health = await calculateNumberHealth(num.number);
    await d1Exec(`INSERT INTO number_health (phone_number, check_date, total_calls, total_connects, connect_rate, spam_score, health_status)
      VALUES (?, datetime('now'), ?, ?, ?, ?, ?)`,
      [num.number, health.totalCalls, Math.round(health.connectRate * health.totalCalls / 100),
       health.connectRate / 100, health.spamScore, health.healthStatus]);

    if (health.healthStatus === 'flagged') {
      console.warn(`[HEALTH] âš ï¸ ${num.number} flagged â€” spam score ${health.spamScore}`);
      // Could notify Boss via WebSocket or Telegram
    }
  }
});
```

### Number Rotation for Health

When `selectNumberForLead` finds multiple matching numbers (e.g., two IL numbers), it picks the one with the better health score. If all are equal, it round-robins to spread volume:

```javascript
// Round-robin counter per number
const callCounts = new Map(); // number â†’ count today

function selectBestFromCandidates(candidates, healthData) {
  // Filter out flagged numbers
  const viable = candidates.filter(n =>
    !healthData?.[n.number] || healthData[n.number].health_status !== 'flagged'
  );
  if (viable.length === 0) return candidates[0]; // all flagged, use any

  // Sort by health score desc, then by today's call count asc (spread volume)
  viable.sort((a, b) => {
    const ha = healthData?.[a.number]?.healthScore ?? 100;
    const hb = healthData?.[b.number]?.healthScore ?? 100;
    if (ha !== hb) return hb - ha;
    return (callCounts.get(a.number) || 0) - (callCounts.get(b.number) || 0);
  });

  return viable[0];
}
```

---

## 10. INTELLIGENCE & ANALYTICS (F14 + F15)

### What We Track (Raw Data)

Every call log row includes denormalized dimensions: `lead_state`, `lead_type`, `call_hour`, `call_day_of_week`, `from_number`, `status`, `disposition`, `duration`.

### Aggregation (Hourly Cron)

```javascript
// Runs every hour â€” aggregates last hour's data
cron.schedule('5 * * * *', async () => {
  const hour = new Date().toISOString().slice(0, 13); // "2026-02-19T14"
  const today = new Date().toISOString().slice(0, 10);
  const week = getISOWeek(new Date());

  // Aggregate by multiple dimensions
  const dimensions = [
    { key: 'overall', where: '1=1' },
    // Per state
    ...['IL', 'CA', 'TX', 'NC'].map(s => ({ key: `state:${s}`, where: `lead_state = '${s}'` })),
    // Per lead type
    ...['FEX', 'Veterans', 'Mortgage Protection'].map(t => ({ key: `type:${t}`, where: `lead_type = '${t}'` })),
    // Per number
    ...TWILIO_NUMBERS.map(n => ({ key: `number:${n.number}`, where: `from_number = '${n.number}'` })),
  ];

  for (const dim of dimensions) {
    const stats = await d1Query(`
      SELECT
        COUNT(*) as total_calls,
        SUM(CASE WHEN amd_result = 'human' THEN 1 ELSE 0 END) as connects,
        SUM(duration) as talk_time,
        AVG(CASE WHEN duration > 0 THEN duration END) as avg_duration,
        SUM(CASE WHEN disposition = 'sold' THEN 1 ELSE 0 END) as sold,
        SUM(CASE WHEN disposition = 'appointment_booked' THEN 1 ELSE 0 END) as appointments,
        AVG(attempt_number) as avg_attempts
      FROM call_log
      WHERE ${dim.where} AND created_at >= datetime('now', '-1 hour')
    `);

    if (stats.total_calls > 0) {
      await d1Exec(`INSERT OR REPLACE INTO call_analytics
        (period_type, period_key, dimension, total_calls, total_connects, connect_rate,
         total_talk_time, avg_call_duration, total_sold, total_appointments, avg_attempts_to_connect)
        VALUES ('hourly', ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,
        [hour, dim.key, stats.total_calls, stats.connects,
         stats.connects / stats.total_calls, stats.talk_time || 0,
         stats.avg_duration || 0, stats.sold, stats.appointments, stats.avg_attempts]);
    }
  }
});
```

### Best Time to Call (F14)

After 2+ weeks of data, we analyze call outcomes by hour and day:

```javascript
async function getBestTimeData() {
  // Need at least 100 calls to have meaningful data
  const totalCalls = await d1Query(`SELECT COUNT(*) as n FROM call_log WHERE created_at > datetime('now', '-14 days')`);
  if (totalCalls.n < 100) return null;

  const data = await d1Query(`
    SELECT
      lead_state,
      call_hour,
      call_day_of_week,
      COUNT(*) as attempts,
      SUM(CASE WHEN amd_result = 'human' THEN 1 ELSE 0 END) as connects,
      ROUND(CAST(SUM(CASE WHEN amd_result = 'human' THEN 1 ELSE 0 END) AS FLOAT) / COUNT(*) * 100, 1) as connect_pct
    FROM call_log
    WHERE created_at > datetime('now', '-14 days')
      AND direction = 'outbound'
    GROUP BY lead_state, call_hour, call_day_of_week
    HAVING attempts >= 5
    ORDER BY connect_pct DESC
  `);

  // Group into actionable insights
  const insights = {};
  for (const row of data) {
    const key = row.lead_state || 'ALL';
    if (!insights[key]) insights[key] = [];
    insights[key].push({
      hour: row.call_hour,
      day: row.call_day_of_week,
      rate: row.connect_pct,
      sample: row.attempts,
    });
  }

  return insights;
}
```

### Smart Queue Reordering Using Best Time Data

```javascript
function applyBestTimeScoring(queue, bestTimes) {
  const currentHour = new Date().getHours(); // Boss's local hour (CT)
  const currentDay = new Date().getDay();

  return queue.map(lead => {
    const stateData = bestTimes[lead.state] || bestTimes['ALL'] || [];
    const hourMatch = stateData.find(d => d.hour === currentHour && d.day === currentDay);
    lead._bestTimeScore = hourMatch ? hourMatch.rate : 50; // default 50
    return lead;
  }).sort((a, b) => {
    // Primary sort by priority (from F5), secondary by best time score
    if (a._priorityScore !== b._priorityScore) return b._priorityScore - a._priorityScore;
    return b._bestTimeScore - a._bestTimeScore;
  });
}
```

### F5: Smart Queue Priority Scoring

```javascript
function prioritizeQueue(leads) {
  const now = Date.now();

  return leads.map(lead => {
    let score = 0;

    // NEW leads: highest base priority
    if (lead.stage === 'new_lead' || !lead.last_call_at) score += 100;

    // Scheduled callbacks due now: very high
    if (lead.next_callback_at && new Date(lead.next_callback_at).getTime() <= now) score += 150;

    // Follow-ups: medium-high
    if (lead.disposition === 'follow_up') score += 80;

    // Hot leads (high face amount): medium
    const face = parseInt(lead.faceAmount) || 0;
    if (face >= 50000) score += 60;
    else if (face >= 25000) score += 40;

    // Aged leads (no contact in 7+ days): lower priority
    if (lead.last_call_at) {
      const daysSince = (now - new Date(lead.last_call_at).getTime()) / 86400000;
      if (daysSince > 7) score += 20;
      else score += 30;
    }

    lead._priorityScore = score;
    return lead;
  }).sort((a, b) => b._priorityScore - a._priorityScore);
}
```

### F15: Clawd Intelligence Suite â€” Metrics

| Metric | Source | Query Pattern |
|--------|--------|--------------|
| Connection Rate by Number | `call_log` grouped by `from_number` | Which of 5 numbers gets answered most |
| Call-to-Close by Lead Type | `call_log` WHERE disposition='sold' grouped by `lead_type` | FEX vs Veterans vs MP conversion |
| Avg Attempts to Connect | `call_log` grouped by `lead_type`, `lead_state` | How many redials per segment |
| Talk Time vs Idle Time | `dialer_sessions` total_talk_time vs session duration | Efficiency metric |
| Lead Source ROI | `call_log` + `leads.source` grouped by source | Which sources produce "Sold" |

### Weekly Intelligence Brief (F15)

Sent every Monday at 7:00 AM CT (13:00 UTC) via Telegram:

```javascript
// Monday 7am CT = Monday 13:00 UTC
cron.schedule('0 13 * * 1', async () => {
  const report = await generateWeeklyBrief();
  // Send via OpenClaw Telegram
  await sendTelegramMessage(report);
});

async function generateWeeklyBrief() {
  const stats = await d1Query(`
    SELECT
      COUNT(*) as total_calls,
      SUM(CASE WHEN amd_result = 'human' THEN 1 ELSE 0 END) as connects,
      SUM(duration) as talk_time,
      SUM(CASE WHEN disposition = 'sold' THEN 1 ELSE 0 END) as sold,
      SUM(CASE WHEN disposition = 'appointment_booked' THEN 1 ELSE 0 END) as appointments,
      SUM(CASE WHEN disposition = 'follow_up' THEN 1 ELSE 0 END) as follow_ups
    FROM call_log
    WHERE created_at > datetime('now', '-7 days') AND direction = 'outbound'
  `);

  const byNumber = await d1Query(`
    SELECT from_number, COUNT(*) as calls,
      SUM(CASE WHEN amd_result = 'human' THEN 1 ELSE 0 END) as connects
    FROM call_log
    WHERE created_at > datetime('now', '-7 days') AND direction = 'outbound'
    GROUP BY from_number ORDER BY connects DESC
  `);

  const byType = await d1Query(`
    SELECT lead_type, COUNT(*) as calls,
      SUM(CASE WHEN disposition = 'sold' THEN 1 ELSE 0 END) as sold
    FROM call_log
    WHERE created_at > datetime('now', '-7 days') AND direction = 'outbound' AND lead_type IS NOT NULL
    GROUP BY lead_type ORDER BY sold DESC
  `);

  const bestTimes = await d1Query(`
    SELECT lead_state, call_hour,
      ROUND(CAST(SUM(CASE WHEN amd_result = 'human' THEN 1 ELSE 0 END) AS FLOAT) / COUNT(*) * 100) as rate
    FROM call_log
    WHERE created_at > datetime('now', '-7 days') AND direction = 'outbound'
    GROUP BY lead_state, call_hour HAVING COUNT(*) >= 3
    ORDER BY rate DESC LIMIT 5
  `);

  const talkHrs = Math.floor((stats.talk_time || 0) / 3600);
  const talkMin = Math.floor(((stats.talk_time || 0) % 3600) / 60);
  const connectRate = stats.total_calls > 0 ? Math.round(stats.connects / stats.total_calls * 100) : 0;

  let brief = `ğŸ“Š **Weekly Dialer Intelligence Brief**\n`;
  brief += `Week of ${new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}\n\n`;

  brief += `**Summary**\n`;
  brief += `â€¢ ${stats.total_calls} calls â†’ ${stats.connects} connects (${connectRate}%)\n`;
  brief += `â€¢ Talk time: ${talkHrs}h ${talkMin}m\n`;
  brief += `â€¢ ğŸ‰ ${stats.sold} sold Â· ğŸ“‹ ${stats.appointments} appointments Â· ğŸ“… ${stats.follow_ups} follow-ups\n\n`;

  brief += `**ğŸ“± Number Performance**\n`;
  for (const n of byNumber) {
    const rate = n.calls > 0 ? Math.round(n.connects / n.calls * 100) : 0;
    const label = TWILIO_NUMBERS.find(t => t.number === n.from_number)?.region || n.from_number;
    brief += `â€¢ ${label}: ${rate}% connect (${n.calls} calls)\n`;
  }

  brief += `\n**ğŸ“ˆ By Lead Type**\n`;
  for (const t of byType) {
    brief += `â€¢ ${t.lead_type}: ${t.sold} sold / ${t.calls} calls\n`;
  }

  if (bestTimes.length > 0) {
    brief += `\n**â° Best Call Windows**\n`;
    for (const bt of bestTimes) {
      brief += `â€¢ ${bt.lead_state || 'All'} leads: ${bt.call_hour}:00 (${bt.rate}% connect)\n`;
    }
  }

  return brief;
}
```

---

## 11. CALDAV INTEGRATION FOR SCHEDULED CALLBACKS (F13)

### How It Works

1. During disposition, Boss selects "Follow-Up" or "Appt Booked"
2. Inline date/time picker appears in dialer panel
3. On confirm:
   - `callback_queue` row created in D1
   - CalDAV event created on iCloud Work calendar via existing `/api/calendar/events`
   - In-memory timer set for WebSocket notification when callback is due
4. When callback time arrives:
   - WebSocket `callback:due` event fires
   - Dialer panel shows "â° Callback due: Mary Johnson" with [Call Now] button
   - If dialer is running, lead auto-inserted at front of queue

### Callback Due Timer Display

In the dialer panel (State B), pending callbacks show with countdown:

```
â”Œâ”€â”€â”€â”€ Callbacks Due â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â° Mary Johnson â€” in 12 min (3:00 PM)    â”‚  â† amber when < 30 min
â”‚ â° Bob Williams â€” in 2h 15min (5:15 PM)  â”‚  â† neutral when > 30 min
â”‚                                            â”‚
â”‚ [Call Next Due] [View All (5)]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CalDAV Event Format

```javascript
{
  calendar: 'work',
  title: 'ğŸ“ Callback: Mary Johnson',
  description: 'Lead: Mary Johnson\nPhone: (630) 555-5678\nType: FEX\nState: IL\nNotes: Interested, needs to talk to wife first',
  startDate: '2026-02-19T15:00:00-06:00',
  endDate: '2026-02-19T15:15:00-06:00',
  alarm: -5  // 5 min before (Apple Watch + iPhone notification)
}
```

This means Boss gets a reminder on his Apple Watch 5 minutes before each scheduled callback, even if CC v7 isn't open.

---

## 12. COMPLIANCE

### Illinois Two-Party Consent (720 ILCS 5/14-2)

- **Recording OFF by default** for all outbound calls
- When recording is ON: TwiML plays "This call may be recorded for quality purposes" AFTER AMD confirms human, BEFORE Boss is bridged
- Toggle in call UI to enable/disable recording per-call
- Announcement timestamp logged in `call_log`

### Do Not Call

- DNC flag from disposition system â†’ dialer skips DNC leads
- Bad Number flag â†’ dialer skips
- `skip_dnc` and `skip_bad_number` checked on every `dialNext()` iteration

### TCPA

- Power dialer is **agent-assisted**, NOT auto-dialing (Boss initiates session, speaks on connection)
- This is NOT an ATDS under TCPA â€” it's technology-assisted human dialing
- Document this classification in system

### A2P 10DLC

- Voice: works now, no restrictions
- SMS: blocked until A2P campaign approved (~10-15 days from Feb 19)
- Auto-SMS (F10) gated behind `a2pApproved` flag in VPS config
- UI shows "âš ï¸ SMS pending A2P approval" until flag is true
- Messaging Service SID: `MGd5d41336ff45895b06005d2ab3a6995d`

---

## 13. BUILD SEQUENCE

### Phase 1: Foundation â€” Single Click-to-Call + Number Routing (Week 1)
**Features covered:** F1 (Local Presence), basic voice infrastructure

| # | Task | Est. Hours |
|---|------|-----------|
| 1.1 | Twilio Console setup: TwiML App, API Key, number webhooks | 1 |
| 1.2 | VPS env vars from `.twilio-creds` | 0.5 |
| 1.3 | VPS routes: `/twilio/token`, `/twilio/voice`, `/twilio/status` | 4 |
| 1.4 | Cloudflare Worker proxy for `/twilio/*` | 1 |
| 1.5 | D1: create `call_log` table | 0.5 |
| 1.6 | Frontend: install `@twilio/voice-sdk`, build TwilioManager class | 4 |
| 1.7 | Frontend: ğŸ“ click-to-call on pipeline cards | 2 |
| 1.8 | Frontend: floating call bar (timer, mute, hold, end) | 3 |
| 1.9 | VPS: `selectNumberForLead()` with area code â†’ state â†’ default | 1.5 |
| 1.10 | VPS: call logging to D1 | 1 |
| 1.11 | VPS: inbound call handling + WebSocket events | 3 |
| **Total** | | **~22 hrs** |

**Acceptance Criteria:**
- [ ] Click ğŸ“ on pipeline card â†’ lead's phone rings within 3s
- [ ] Caller ID shows smart-matched Twilio number (IL lead â†’ 630/847, TX â†’ 469, etc.)
- [ ] Active call shows floating bar with timer, mute, hold, end
- [ ] Call logged to D1 with duration, status, from/to numbers, lead_state, lead_type
- [ ] Inbound calls show notification + ringing UI in browser
- [ ] Token auto-refreshes before expiry

---

### Phase 2: Power Dialer Core (Week 2-3)
**Features covered:** F2 (AMD), F3 (Multi-Line), F4 (Auto-Redial), F7 (Disposition Flow), F11 (Voicemail Drop)

| # | Task | Est. Hours |
|---|------|-----------|
| 2.1 | VPS: `DialerSession` class (queue, multi-line, redial state machine) | 8 |
| 2.2 | VPS routes: `/twilio/dialer/start`, `/stop`, `/status` | 2 |
| 2.3 | VPS: AMD callback handler (`/twilio/amd`) | 3 |
| 2.4 | VPS: Bridge TwiML + polite drop TwiML | 2 |
| 2.5 | VPS: VM drop TwiML (`/twilio/voice/vm-drop`) | 1 |
| 2.6 | D1: create `dialer_sessions`, `voicemail_templates` tables | 0.5 |
| 2.7 | VPS: voicemail template CRUD routes + audio serving | 3 |
| 2.8 | Frontend: Dialer panel (States A-E) | 10 |
| 2.9 | Frontend: Queue loading from pipeline stage/filters/manual | 3 |
| 2.10 | Frontend: Config panel (lines, redial, AMD, VM drop, caller ID) | 3 |
| 2.11 | Frontend: Multi-line status display (ringing/connected/AMD) | 3 |
| 2.12 | Frontend: Inline disposition prompt (post-call, 13 tiles) | 4 |
| 2.13 | Frontend: Mini-player (collapsed active call) | 2 |
| 2.14 | Frontend: VM template management in Settings | 3 |
| 2.15 | VPS: WebSocket events for all dialer states | 2 |
| 2.16 | Integration: Auto-accept bridged calls in TwilioManager | 1 |
| **Total** | | **~50 hrs** |

**Acceptance Criteria:**
- [ ] Load leads from pipeline stage into dialer queue
- [ ] Configure 1-3 lines and 1-3x redial
- [ ] "Start Dialing" initiates calls on configured lines
- [ ] AMD detects voicemail < 3s â†’ auto-hangup or VM drop
- [ ] Human detected â†’ bridged to Boss's browser within 2s
- [ ] Other lines auto-disconnect on first human connect
- [ ] Dropped leads re-queued without burning attempt
- [ ] Redial queue works per configured delay strategy
- [ ] Inline disposition tiles appear after call ends
- [ ] One-click disposition â†’ logged + stage moved + auto-advance
- [ ] "Sold" disposition â†’ opens policy form
- [ ] VM templates recordable from browser, playable via `<Play>` TwiML
- [ ] Session stats visible in panel footer

---

### Phase 3: Automation + Agent Support (Week 3-4)
**Features covered:** F5 (Smart Queue), F8 (Live Dashboard), F10 (Auto-SMS), F12 (Call Scripts), F13 (Callbacks)

| # | Task | Est. Hours |
|---|------|-----------|
| 3.1 | VPS: Smart queue priority scoring algorithm | 2 |
| 3.2 | D1: create `call_scripts`, `sms_templates`, `callback_queue` tables | 0.5 |
| 3.3 | VPS: Call script CRUD routes | 2 |
| 3.4 | VPS: SMS template CRUD routes | 2 |
| 3.5 | VPS: Callback queue routes + CalDAV integration | 4 |
| 3.6 | VPS: In-memory callback timer scheduler | 2 |
| 3.7 | VPS: Auto-SMS trigger on exhausted leads | 2 |
| 3.8 | VPS: SMS send/receive routes (`/twilio/sms/*`) | 3 |
| 3.9 | Frontend: Call script display in dialer panel (auto-fills lead context) | 4 |
| 3.10 | Frontend: Script management in Settings | 3 |
| 3.11 | Frontend: SMS template management in Settings | 2 |
| 3.12 | Frontend: Callback countdown timers in dialer panel | 2 |
| 3.13 | Frontend: Callback scheduling from disposition flow | 2 |
| 3.14 | Frontend: Live dashboard (mini-stats + full analytics page) | 6 |
| 3.15 | Frontend: Smart queue toggle in config | 1 |
| 3.16 | Frontend: SMS thread view in Lead Detail | 4 |
| **Total** | | **~40 hrs** |

**Acceptance Criteria:**
- [ ] Smart Queue sorts: NEW â†’ callbacks due â†’ follow-ups â†’ hot â†’ aged (toggleable)
- [ ] Call scripts auto-fill with lead context during active call
- [ ] Scripts manageable in Settings (CRUD)
- [ ] "Follow-Up" disposition â†’ date/time picker â†’ CalDAV event created
- [ ] Callback countdown visible in dialer panel
- [ ] WebSocket notification fires when callback is due
- [ ] Auto-SMS sends after all redial attempts exhausted (gated behind A2P flag)
- [ ] SMS templates support {Name}, {LeadType}, {State} variables
- [ ] Live mini-stats: calls, connects, rate, talk time, calls/hr
- [ ] Full dashboard page with period filtering

---

### Phase 4: Intelligence + Number Health + CNAM (Week 4-5)
**Features covered:** F6 (Number Health), F9 (CNAM), F14 (Best Time to Call)

| # | Task | Est. Hours |
|---|------|-----------|
| 4.1 | D1: create `number_health`, `call_analytics` tables | 0.5 |
| 4.2 | VPS: Number health scoring algorithm + cron (12hr) | 4 |
| 4.3 | VPS: Health-aware number routing integration | 1 |
| 4.4 | VPS: CNAM management routes | 2 |
| 4.5 | VPS: Analytics aggregation cron (hourly) | 4 |
| 4.6 | VPS: Best-time-to-call query + queue reordering | 3 |
| 4.7 | Frontend: Number health display in Settings | 3 |
| 4.8 | Frontend: CNAM editor per number in Settings | 2 |
| 4.9 | Frontend: Best time insights on dashboard | 3 |
| 4.10 | Frontend: Number performance on dashboard | 2 |
| **Total** | | **~25 hrs** |

**Acceptance Criteria:**
- [ ] Number health checked every 12 hours
- [ ] Health status (green/yellow/red) visible per number in Settings
- [ ] Flagged numbers deprioritized in smart routing
- [ ] CNAM name settable/changeable per number
- [ ] Analytics aggregate hourly by state, lead type, number, hour, day
- [ ] After 2 weeks of data: best-time insights visible on dashboard
- [ ] Smart queue optionally reorders by best time to call

---

### Phase 5: Intelligence Suite + Polish (Week 5-6)
**Features covered:** F15 (Auto-Intelligence Suite), polish across all features

| # | Task | Est. Hours |
|---|------|-----------|
| 5.1 | VPS: Weekly intelligence brief generator | 4 |
| 5.2 | VPS: Monday 7am CT cron â†’ Telegram delivery | 2 |
| 5.3 | VPS: Connection rate by number analytics | 1 |
| 5.4 | VPS: Call-to-close by lead type analytics | 1 |
| 5.5 | VPS: Avg attempts to connect analytics | 1 |
| 5.6 | VPS: Talk time vs idle time metric | 1 |
| 5.7 | VPS: Lead source ROI metric | 1 |
| 5.8 | Frontend: Full intelligence report page | 4 |
| 5.9 | Frontend: Recording toggle + playback | 3 |
| 5.10 | Frontend: Dialer session history | 2 |
| 5.11 | Full regression testing all 15 features | 6 |
| 5.12 | Performance optimization (WebSocket reconnect, token refresh, error recovery) | 4 |
| **Total** | | **~30 hrs** |

**Acceptance Criteria:**
- [ ] Weekly intelligence brief arrives on Telegram every Monday 7am CT
- [ ] Brief includes: summary, number performance, by lead type, best windows
- [ ] Full intelligence report viewable in-app with all F15 metrics
- [ ] Recording toggle works; recordings playable from Activity tab
- [ ] Past dialer sessions viewable with stats
- [ ] All 15 features functional end-to-end
- [ ] Graceful error recovery (WebSocket reconnect, token refresh, VPS restart)

### Total Estimated Build Time

| Phase | Hours | Calendar |
|-------|-------|----------|
| Phase 1: Foundation | ~22 | Week 1 |
| Phase 2: Dialer Core | ~50 | Week 2-3 |
| Phase 3: Automation + Support | ~40 | Week 3-4 |
| Phase 4: Intelligence + Health | ~25 | Week 4-5 |
| Phase 5: Suite + Polish | ~30 | Week 5-6 |
| **Total** | **~167 hrs** | **~6 weeks** |

---

## 14. COST ESTIMATES

### Twilio Usage at Moderate Volume

**Assumptions:** 2-line dialer, 50 leads/session, 2x redial, ~25% answer rate, 2 sessions/day, 22 days/month.

#### Per Dialer Session
| Item | Quantity | Unit Cost | Cost |
|------|----------|-----------|------|
| Outbound call attempts | ~100 (50 Ã— 2 avg attempts) | â€” | â€” |
| Ring time (no answer, 25s avg) | ~75 calls Ã— 25s = 31 min | $0.014/min | $0.43 |
| Talk time (25 connects Ã— 5 min) | 125 min | $0.014/min | $1.75 |
| AMD detection | ~100 calls Ã— ~3s = 5 min | Included | $0 |
| VM drop (play recording) | ~20 drops Ã— 30s = 10 min | $0.014/min | $0.14 |
| **Per session total** | | | **$2.32** |

#### Monthly Cost
| Item | Quantity | Cost |
|------|----------|------|
| Dialer sessions | 44 (2/day Ã— 22 days) | $102 |
| Single click-to-call | ~30/month Ã— 4 min avg | $1.68 |
| Inbound calls | ~20/month Ã— 3 min avg | $0.84 |
| Phone numbers (5) | 5 Ã— $1.15/mo | $5.75 |
| CNAM registration (5) | 5 Ã— $0.01/mo | $0.05 |
| SMS (when A2P active) | ~200 Ã— $0.0079 | $1.58 |
| Recording storage | ~60 min/month | ~$0.50 |
| **Monthly total** | | **~$112** |

#### Annual Estimate
| Volume Level | Monthly | Annual |
|-------------|---------|--------|
| Light (1 session/day) | ~$60 | ~$720 |
| **Moderate (2 sessions/day)** | **~$112** | **~$1,344** |
| Heavy (4 sessions/day) | ~$220 | ~$2,640 |

---

## 15