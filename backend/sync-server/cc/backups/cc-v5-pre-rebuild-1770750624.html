<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Forged Financial — Command Center</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0B0E14;--surface:#12161F;--surface-alt:#181D28;--border:#1E2433;--border-hover:#2A3145;
  --accent:#E8713A;--accent-glow:rgba(232,113,58,.15);--accent-dim:rgba(232,113,58,.06);
  --online:#34D399;--working:#60A5FA;--idle:#FBBF24;--offline:#EF4444;--review-purple:#C084FC;
  --kanban-new:#64748B;--kanban-progress:#60A5FA;--kanban-review:#C084FC;--kanban-done:#34D399;--kanban-sched:#FBBF24;--kanban-clawd:#EF4444;
  --pri-critical:#EF4444;--pri-high:#F97316;--pri-medium:#FBBF24;--pri-low:#64748B;
  --cat-insurance:#F97316;--cat-ai:#34D399;--cat-marketing:#F97066;--cat-drhq:#64748B;--cat-crm:#C084FC;
  --op-danny:#E8713A;--op-openclaw:#34D399;--op-claude:#C084FC;--op-shary:#F97066;--op-john:#FBBF24;
  --text:#E2E8F0;--text-sec:#8B95A8;--text-muted:#4A5568;--text-on-accent:#FFF;
  --radius:10px;--radius-sm:6px;--radius-lg:14px;
  --font-main:'Plus Jakarta Sans',sans-serif;
  --glass-blur:0px;--glass-opacity:1;--anim-speed:1;
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:var(--font-main);background:var(--bg);color:var(--text);min-height:100vh;overflow:hidden}
::-webkit-scrollbar{width:5px;height:5px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
button{cursor:pointer;font-family:inherit;border:none;background:none}input,textarea,select{font-family:inherit;outline:none}

/* LAYOUT */
.sidebar{position:fixed;left:0;top:0;bottom:0;width:220px;background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column;z-index:200}
.main{margin-left:220px;height:100vh;display:flex;flex-direction:column;overflow:hidden}
.sb-brand{padding:16px 18px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:10px}
.sb-logo{width:36px;height:36px;background:var(--accent);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:900;color:#fff;box-shadow:0 0 20px var(--accent-glow)}
.sb-brand h1{font-size:14px;font-weight:800;letter-spacing:1.5px}.sb-brand span{font-size:9px;color:var(--text-muted);text-transform:uppercase;letter-spacing:1px;display:block}
.sb-nav{flex:1;padding:14px 10px;overflow-y:auto}
.nav-sec{margin-bottom:18px}.nav-sec-label{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:1.8px;color:var(--text-muted);padding:0 8px;margin-bottom:5px}
.nav-item{display:flex;align-items:center;gap:9px;padding:8px 12px;border-radius:var(--radius-sm);color:var(--text-sec);font-size:13px;font-weight:500;cursor:pointer;transition:all .15s;position:relative}
.nav-item:hover{background:var(--accent-dim);color:var(--text)}.nav-item.active{background:var(--accent-glow);color:var(--accent)}
.nav-item.active::before{content:'';position:absolute;left:0;top:4px;bottom:4px;width:3px;background:var(--accent);border-radius:0 2px 2px 0}
.nav-badge{margin-left:auto;background:var(--accent);color:#fff;font-size:9px;font-weight:700;padding:2px 7px;border-radius:10px}
.nav-unread{margin-left:auto;background:#F97316;color:#fff;font-size:9px;font-weight:700;min-width:16px;height:16px;padding:0 5px;border-radius:10px;display:flex;align-items:center;justify-content:center;box-shadow:0 0 8px rgba(249,115,22,.4);animation:unreadPulse 2s infinite}.nav-unread:empty,.nav-unread[data-count="0"]{display:none}
@keyframes unreadPulse{0%,100%{box-shadow:0 0 8px rgba(249,115,22,.4)}50%{box-shadow:0 0 14px rgba(249,115,22,.6)}}
/* LIVE AGENT TRACKER — Claude card above nav */
.agent-tracker{border-bottom:1px solid var(--border);display:flex;flex-direction:column;flex-shrink:0;padding:14px 14px 12px;background:var(--surface)}
.at-card{display:flex;flex-direction:column;gap:6px}
.at-top{display:flex;align-items:center;gap:10px}
.at-icon-wrap{position:relative;width:48px;height:48px;flex-shrink:0}
.at-icon-wrap .at-ring{position:absolute;inset:-3px;border-radius:50%;border:2.5px solid transparent}
.at-icon-wrap .at-ring.st-working{border-color:var(--online);animation:orbspin 2s linear infinite}
.at-icon-wrap .at-ring.st-thinking{border-color:var(--idle);border-style:dashed;animation:orbspin 3s linear infinite}
.at-icon-wrap .at-ring.st-idle{border-color:var(--offline);opacity:.6}
.at-info{flex:1;min-width:0;display:flex;flex-direction:column;gap:2px}
.at-name{font-size:13px;font-weight:800;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.at-status{display:flex;align-items:center;gap:5px;font-size:10px;font-weight:700}
.at-status .at-sdot{width:6px;height:6px;border-radius:50%;flex-shrink:0;animation:pdot 1.5s infinite}
.at-status.st-working .at-sdot{background:var(--online)}.at-status.st-working{color:var(--online)}
.at-status.st-thinking .at-sdot{background:var(--idle)}.at-status.st-thinking{color:var(--idle)}
.at-status.st-idle .at-sdot{background:var(--offline)}.at-status.st-idle{color:var(--offline)}
.at-task{font-size:10px;color:var(--text-sec);padding:6px 8px;background:var(--surface-alt);border:1px solid var(--border);border-radius:var(--radius-sm);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:2px}
.at-subs{display:flex;flex-direction:column;gap:3px;margin-top:2px}
.at-sub{display:flex;align-items:center;gap:5px;font-size:9px;color:var(--online);padding:3px 8px;background:rgba(52,211,153,.08);border:1px solid rgba(52,211,153,.15);border-radius:var(--radius-sm)}
.at-sub .at-sub-dot{width:5px;height:5px;border-radius:50%;background:var(--online);flex-shrink:0;animation:pdot 1.5s infinite}
.at-sub-name{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
/* status icon circle — larger for single agent */
.at-st-ico{width:48px;height:48px;border-radius:50%;background:var(--surface-alt);display:flex;align-items:center;justify-content:center;flex-shrink:0;position:relative;z-index:2;border:2px solid var(--border)}
.at-st-ico svg{width:24px;height:24px;fill:var(--text)}
.at-st-ico.st-working{background:var(--accent);border-color:var(--accent)}
.at-st-ico.st-working svg{fill:#fff}
.at-st-ico.st-thinking{background:var(--idle);border-color:var(--idle)}
.at-st-ico.st-thinking svg{fill:#1A1A2E}
.at-st-ico.st-idle{background:var(--offline);border-color:var(--offline)}
.at-st-ico.st-idle svg{fill:#fff}

.sb-footer{padding:10px 14px;border-top:1px solid var(--border)}
.sb-conn{display:flex;align-items:center;gap:7px;font-size:11px;color:var(--text-sec)}
.sb-dot{width:7px;height:7px;border-radius:50%;background:var(--online);box-shadow:0 0 8px rgba(52,211,153,.5);animation:pdot 2s infinite}
@keyframes pdot{0%,100%{opacity:1}50%{opacity:.5}}
.sb-version{font-size:9px;color:var(--text-muted);margin-top:4px}

/* HEADER with AI Status */
.hdr{padding:8px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;background:var(--surface);flex-shrink:0;z-index:100;gap:8px}
.hdr-left{display:flex;align-items:center;gap:14px}
.hdr-left h2{font-size:16px;font-weight:700}.hdr-sub{font-size:11px;color:var(--text-muted);margin-top:1px}
.hdr-right{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
/* Live AI orb in header */
.ai-hdr{display:flex;align-items:center;gap:10px;padding:4px 14px 4px 6px;border:1px solid var(--border);border-radius:20px;background:var(--surface-alt);margin-left:10px;flex-shrink:0}
.ai-orb-sm{position:relative;width:32px;height:32px;flex-shrink:0}
.ai-orb-sm .orb{width:32px;height:32px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:900;color:#fff;position:relative;z-index:2;transition:all .4s}
.ai-orb-sm .orb.st-working{background:var(--accent);box-shadow:0 0 14px var(--accent-glow)}
.ai-orb-sm .orb.st-thinking{background:var(--idle);box-shadow:0 0 14px rgba(251,191,36,.25)}
.ai-orb-sm .orb.st-idle{background:var(--text-muted);box-shadow:none}
.ai-orb-sm .ring{position:absolute;inset:-3px;border-radius:11px;border:2px solid transparent;z-index:1}
.ai-orb-sm .ring.st-working{border-color:var(--online);animation:orbspin 2s linear infinite}
.ai-orb-sm .ring.st-thinking{border-color:var(--idle);border-style:dashed;animation:orbspin 3s linear infinite}
.ai-orb-sm .ring.st-idle{border-color:var(--text-muted);opacity:.35}
@keyframes orbspin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
.ai-hdr-info{display:flex;flex-direction:column;gap:0;min-width:0}
.ai-hdr-st{font-size:10px;font-weight:700;display:flex;align-items:center;gap:4px}
.ai-hdr-st .sdot{width:5px;height:5px;border-radius:50%;animation:pdot 1.5s infinite}
.ai-hdr-task{font-size:9px;color:var(--text-sec);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:200px}
.ai-hdr-subs{font-size:8px;color:var(--text-muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:200px}
.hdr-pill{display:flex;align-items:center;gap:5px;padding:4px 11px;border-radius:20px;font-size:11px;font-weight:600}
.hdr-pill.health{background:rgba(52,211,153,.1);color:var(--online);border:1px solid rgba(52,211,153,.2)}
.hdr-pill.hb{background:var(--accent-dim);color:var(--accent);border:1px solid rgba(232,113,58,.2);font-family:'JetBrains Mono',monospace}
.hdr-pill .dot{width:6px;height:6px;border-radius:50%;background:currentColor;animation:pdot 2s infinite}
.hdr-clock{font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--text-sec)}
.qa-wrap{display:flex;align-items:center;gap:4px;padding-left:8px;border-left:1px solid var(--border)}
.qa-btn{padding:4px 9px;border:1px solid var(--border);border-radius:var(--radius-sm);color:var(--text-sec);font-size:10px;font-weight:600;transition:all .15s;white-space:nowrap}
.qa-btn:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-dim)}

.mem-bar{display:flex;align-items:center;gap:8px;padding:8px 20px;border-bottom:1px solid var(--border);background:var(--surface);flex-shrink:0}
.mem-bar-label{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:1.2px;color:var(--text-muted);margin-right:4px}
.mem-chip{display:flex;align-items:center;gap:5px;padding:3px 9px;border-radius:12px;font-size:10px;font-weight:600;border:1px solid}
.mem-chip.daily{border-color:rgba(96,165,250,.3);color:var(--working);background:rgba(96,165,250,.05)}
.mem-chip.longterm{border-color:rgba(232,113,58,.3);color:var(--accent);background:rgba(232,113,58,.05)}
.mem-chip.project{border-color:rgba(192,132,252,.3);color:var(--review-purple);background:rgba(192,132,252,.05)}

.content{flex:1;overflow:hidden;position:relative}
.page{display:none;height:100%;overflow-y:auto}.page.active{display:block}

#pg-overview.active{padding:0;overflow:hidden;display:flex;flex-direction:column}
.tab-bar{display:flex;gap:4px;padding:6px 18px;border-bottom:1px solid var(--border);background:var(--surface);overflow-x:auto;flex-shrink:0}
.tab-btn{display:flex;align-items:center;gap:4px;padding:3px 9px;border-radius:12px;font-size:10px;font-weight:600;border:1px solid var(--border);color:var(--text-sec);transition:all .15s;white-space:nowrap;flex-shrink:0}
.tab-btn:hover{border-color:var(--border-hover);color:var(--text)}
.tab-btn.on{background:var(--accent-glow);border-color:var(--accent);color:var(--accent)}
.tab-btn.off{opacity:.45;border-style:dashed}
.tab-btn .tdot{width:5px;height:5px;border-radius:50%;flex-shrink:0}
.tab-btn.on .tdot{background:var(--online)}.tab-btn.off .tdot{background:var(--text-muted)}
.tab-reset{padding:3px 9px;border-radius:12px;font-size:10px;font-weight:600;color:var(--accent);border:1px solid transparent;transition:all .15s;margin-left:auto;flex-shrink:0}
.tab-reset:hover{border-color:var(--accent);background:var(--accent-dim)}

#ovScroll{flex:1;overflow:auto;position:relative}
.ov-locked{padding:14px 18px 0;position:relative;z-index:1}
.scard-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:12px}
.scard{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-sm);padding:12px 14px;position:relative;overflow:hidden;backdrop-filter:blur(var(--glass-blur))}
.scard::before{content:'';position:absolute;top:0;left:0;right:0;height:3px}
.scard.c-status::before{background:var(--working)}.scard.c-task::before{background:var(--accent)}
.scard.c-agents::before{background:var(--review-purple)}.scard.c-health::before{background:var(--online)}
.scard .sc-label{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:1.2px;color:var(--text-muted);margin-bottom:4px}
.scard .sc-val{font-size:18px;font-weight:800;margin-bottom:2px}.scard .sc-det{font-size:11px;color:var(--text-sec)}
.work-dot{display:inline-block;width:7px;height:7px;border-radius:50%;margin-right:4px;animation:wpulse 1.5s infinite}
@keyframes wpulse{0%,100%{opacity:1}50%{opacity:.5}}
@keyframes fiu{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

.op-strip{display:flex;gap:8px;overflow-x:auto;margin-bottom:6px}
.op-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-sm);padding:8px 12px;min-width:150px;flex-shrink:0;display:flex;align-items:center;gap:8px}
.op-av{width:26px;height:26px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:11px;color:#fff;flex-shrink:0}
.op-nm{font-size:11px;font-weight:700;display:flex;align-items:center;gap:4px}
.op-dot{width:5px;height:5px;border-radius:50%;display:inline-block}
.op-task{font-size:10px;color:var(--text-muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

/* FREE-FORM WINDOWS */
#winCanvas{position:relative;min-height:1200px;margin:0 18px 18px}
.win{position:absolute;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);display:flex;flex-direction:column;overflow:hidden;transition:box-shadow .15s;min-width:220px;min-height:80px;animation:fiu .25s ease both;backdrop-filter:blur(var(--glass-blur))}
.win:hover{box-shadow:0 4px 20px rgba(0,0,0,.3)}.win.dragging{box-shadow:0 8px 32px rgba(0,0,0,.5);opacity:.9;transition:none}.win.hidden-win{display:none!important}
.win-bar{display:flex;align-items:center;padding:6px 10px;background:var(--surface-alt);border-bottom:1px solid var(--border);cursor:grab;flex-shrink:0;gap:5px;user-select:none}
.win-bar:active{cursor:grabbing}
.win-grip{color:var(--text-muted);font-size:10px;letter-spacing:1px;flex-shrink:0}
.win-title{font-size:11px;font-weight:700;flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.win-ctrl{display:flex;gap:2px;flex-shrink:0}
.win-btn{width:18px;height:18px;border-radius:3px;display:flex;align-items:center;justify-content:center;font-size:9px;color:var(--text-muted);transition:all .12s}
.win-btn:hover{background:var(--accent-dim);color:var(--accent)}.win-btn.close:hover{background:rgba(239,68,68,.2);color:var(--offline)}
.win-body{flex:1;overflow:auto;position:relative}
.win-rs{position:absolute;bottom:0;right:0;width:16px;height:16px;cursor:nwse-resize;z-index:5}
.win-rs::after{content:'';position:absolute;bottom:3px;right:3px;width:8px;height:8px;border-right:2px solid var(--text-muted);border-bottom:2px solid var(--text-muted);opacity:.3;transition:opacity .15s}
.win:hover .win-rs::after{opacity:.7}
.win-rs-r{position:absolute;top:30px;right:-3px;bottom:16px;width:6px;cursor:ew-resize;z-index:5}
.win-rs-b{position:absolute;bottom:-3px;left:0;right:16px;height:6px;cursor:ns-resize;z-index:5}

/* KANBAN */
.kanban{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;padding:10px 12px;height:100%}
.kanban.full-kb{grid-template-columns:repeat(4,1fr) minmax(160px,1fr) minmax(160px,1fr)}
.kb-col{min-height:60px;display:flex;flex-direction:column}
.kb-col-hdr{display:flex;align-items:center;gap:6px;margin-bottom:8px;padding-bottom:6px;border-bottom:2px solid}
.kb-col-hdr.new_task{border-color:var(--kanban-new)}.kb-col-hdr.progress{border-color:var(--kanban-progress)}
.kb-col-hdr.review{border-color:var(--kanban-review)}.kb-col-hdr.done{border-color:var(--kanban-done)}.kb-col-hdr.scheduled{border-color:var(--kanban-sched)}.kb-col-hdr.clawd_sugg{border-color:var(--kanban-clawd)}
.kb-col-hdr .ct{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.8px}
.kb-col-hdr.new_task .ct{color:var(--kanban-new)}.kb-col-hdr.progress .ct{color:var(--kanban-progress)}
.kb-col-hdr.review .ct{color:var(--kanban-review)}.kb-col-hdr.done .ct{color:var(--kanban-done)}.kb-col-hdr.scheduled .ct{color:var(--kanban-sched)}.kb-col-hdr.clawd_sugg .ct{color:var(--kanban-clawd)}
.kb-col-hdr .cc{font-size:9px;font-weight:600;background:var(--surface-alt);padding:1px 6px;border-radius:8px;color:var(--text-muted)}
.kb-cards{min-height:30px;flex:1}.kb-cards.drag-over{background:var(--accent-dim);border-radius:var(--radius-sm)}
.add-inp{width:100%;padding:6px 9px;border:1px dashed var(--border-hover);border-radius:var(--radius-sm);background:transparent;color:var(--text);font-size:11px;transition:all .15s;margin-bottom:6px}
.add-inp:focus{border-style:solid;border-color:var(--accent);background:var(--surface-alt)}.add-inp::placeholder{color:var(--text-muted)}
.kb-filters{display:flex;gap:4px;padding:8px 12px;border-bottom:1px solid var(--border);flex-wrap:wrap;align-items:center}
.kf{font-size:10px;font-weight:600;padding:3px 8px;border-radius:12px;border:1px solid var(--border);color:var(--text-sec);transition:all .15s}
.kf:hover{border-color:var(--border-hover);color:var(--text)}.kf.active{background:var(--accent-glow);border-color:var(--accent);color:var(--accent)}
.kf-search{padding:3px 8px;border:1px solid var(--border);border-radius:12px;background:var(--surface-alt);color:var(--text);font-size:10px;width:130px;margin-left:auto}.kf-search:focus{border-color:var(--accent)}

/* TASK CARDS */
.tc{background:var(--surface-alt);border:1px solid var(--border);border-radius:var(--radius-sm);padding:9px 10px;margin-bottom:6px;cursor:grab;transition:all .15s;position:relative;overflow:hidden}
.tc:hover{border-color:var(--border-hover);transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,.3)}
.tc:active{cursor:grabbing}.tc.dragging{opacity:.5;transform:rotate(2deg)}
.tc::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px}
.tc[data-p="critical"]::before{background:var(--pri-critical)}.tc[data-p="high"]::before{background:var(--pri-high)}
.tc[data-p="medium"]::before{background:var(--pri-medium)}.tc[data-p="low"]::before{background:var(--pri-low)}
.tc-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;gap:3px;padding-right:18px}
.tc-pri{font-size:8px;font-weight:700;text-transform:uppercase;letter-spacing:.6px;padding:2px 5px;border-radius:3px}
.pri-c{background:rgba(239,68,68,.15);color:var(--pri-critical)}.pri-h{background:rgba(249,115,22,.15);color:var(--pri-high)}
.pri-m{background:rgba(251,191,36,.15);color:var(--pri-medium)}.pri-l{background:rgba(100,116,139,.15);color:var(--pri-low)}
.tc-cat{font-size:8px;font-weight:600;padding:2px 5px;border-radius:3px}
.cat-ins{background:rgba(249,115,22,.12);color:var(--cat-insurance)}.cat-ai{background:rgba(52,211,153,.12);color:var(--cat-ai)}
.cat-mkt{background:rgba(249,112,102,.12);color:var(--cat-marketing)}.cat-drh{background:rgba(100,116,139,.12);color:var(--cat-drhq)}.cat-crm{background:rgba(192,132,252,.12);color:var(--cat-crm)}
.tc-title{font-size:11px;font-weight:600;line-height:1.35;margin-bottom:3px}
.tc-desc{font-size:10px;color:var(--text-sec);line-height:1.3;margin-bottom:5px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.tc-meta{display:flex;align-items:center;justify-content:space-between;gap:3px}
.tc-who{display:flex;align-items:center;gap:3px;font-size:9px;color:var(--text-sec)}
.tc-av-sm{width:14px;height:14px;border-radius:3px;display:flex;align-items:center;justify-content:center;font-size:7px;color:#fff}
.tc-time{font-size:9px;color:var(--text-muted);font-family:'JetBrains Mono',monospace}
.tc.comp{opacity:.6}.tc.comp .tc-title{text-decoration:line-through;color:var(--text-sec)}
.tc-del{position:absolute;top:6px;right:6px;width:16px;height:16px;border-radius:3px;display:flex;align-items:center;justify-content:center;font-size:10px;color:var(--text-muted);opacity:0;transition:all .12s;z-index:2;cursor:pointer}
.tc:hover .tc-del{opacity:1}.tc-del:hover{background:rgba(239,68,68,.2);color:var(--offline)}
.tc-sched{font-size:9px;font-family:'JetBrains Mono',monospace;color:var(--idle);font-weight:600;display:flex;align-items:center;gap:3px;margin-top:3px}

/* LOG, NOTES, DELIVERABLES, WIDGETS */
.le{display:flex;gap:8px;padding:7px 12px;border-bottom:1px solid var(--border);align-items:flex-start;cursor:pointer;transition:background .1s}.le:hover{background:var(--surface-alt)}.le:last-child{border-bottom:none}
.le-ts{font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--text-muted);min-width:50px;padding-top:2px}
.le-ico{width:18px;height:18px;border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:9px;flex-shrink:0}
.le-ico.system{background:rgba(96,165,250,.15);color:var(--working)}.le-ico.business{background:rgba(232,113,58,.15);color:var(--accent)}
.le-ico.comms{background:rgba(192,132,252,.15);color:var(--review-purple)}.le-ico.research{background:rgba(251,191,36,.15);color:var(--idle)}.le-ico.success{background:rgba(52,211,153,.15);color:var(--online)}
.le-c{flex:1;min-width:0}.le-op{font-size:9px;font-weight:700;margin-right:2px}
.le-op.danny{color:var(--op-danny)}.le-op.openclaw{color:var(--op-openclaw)}.le-op.claude{color:var(--op-claude)}.le-op.shary{color:var(--op-shary)}.le-op.john{color:var(--op-john)}.le-op.system{color:var(--text-muted)}
.le-txt{font-size:11px;color:var(--text);line-height:1.35}.le-sub{font-size:10px;color:var(--text-muted);margin-top:2px;display:none}.le.exp .le-sub{display:block}
.note-input-area{display:flex;gap:6px;margin-bottom:8px}.note-input{flex:1;background:var(--surface-alt);border:1px solid var(--border);border-radius:var(--radius-sm);padding:7px 10px;color:var(--text);font-size:11px;resize:none}.note-input:focus{border-color:var(--accent)}.note-send{background:var(--accent);color:#fff;border-radius:var(--radius-sm);padding:7px 12px;font-size:11px;font-weight:600;transition:all .15s}.note-send:hover{filter:brightness(1.1)}
.ni{background:var(--surface-alt);border:1px solid var(--border);border-radius:var(--radius-sm);padding:8px 10px;margin-bottom:6px;position:relative}
.ni-del{position:absolute;top:6px;right:6px;width:20px;height:20px;border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:12px;color:var(--text-muted);opacity:0;transition:all .15s;cursor:pointer;background:transparent;border:1px solid transparent;z-index:2}
.ni:hover .ni-del{opacity:1}.ni-del:hover{background:rgba(239,68,68,.2);color:var(--offline);border-color:var(--offline)}.ni-from{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:.6px;margin-bottom:2px}.ni-from.danny{color:var(--accent)}.ni-from.ai{color:var(--working)}.ni-txt{font-size:11px;color:var(--text-sec);line-height:1.35}.ni-time{font-size:9px;color:var(--text-muted);font-family:'JetBrains Mono',monospace;margin-top:3px}.ni-st{font-size:8px;font-weight:700;padding:1px 5px;border-radius:3px;display:inline-block}.ni-st.pend{background:rgba(251,191,36,.15);color:var(--idle)}.ni-st.seen{background:rgba(52,211,153,.15);color:var(--online)}
.del-item{display:flex;align-items:center;gap:9px;padding:8px 10px;background:var(--surface-alt);border:1px solid var(--border);border-radius:var(--radius-sm);margin-bottom:6px;cursor:pointer;transition:all .15s}.del-item:hover{border-color:var(--border-hover)}
.del-ico{width:28px;height:28px;border-radius:5px;display:flex;align-items:center;justify-content:center;font-size:13px;flex-shrink:0}.del-ico.report{background:rgba(232,113,58,.15)}.del-nm{font-size:11px;font-weight:600}.del-mt{font-size:9px;color:var(--text-muted)}
.wf-item{display:flex;align-items:center;gap:9px;padding:8px 10px;background:var(--surface-alt);border:1px solid var(--border);border-radius:var(--radius-sm);margin-bottom:5px}.wf-time{font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:600;color:var(--accent);min-width:50px}.wf-nm{font-size:11px;font-weight:600}.wf-st{margin-left:auto;font-size:9px;font-weight:600;padding:2px 8px;border-radius:10px;white-space:nowrap}.wf-st.comp{background:rgba(52,211,153,.1);color:var(--online)}.wf-st.pend{background:rgba(251,191,36,.1);color:var(--idle)}.wf-st.act{background:rgba(96,165,250,.1);color:var(--working)}.wf-st.loop{background:var(--accent-dim);color:var(--accent)}
.bf-sec{margin-bottom:10px}.bf-label{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--text-muted);margin-bottom:3px}.bf-item{font-size:11px;color:var(--text-sec);padding:2px 0;display:flex;align-items:center;gap:5px}.bf-metric{font-weight:700;color:var(--text)}.bf-up{color:var(--online)}
.smt-grid{display:flex;flex-wrap:wrap;gap:7px;padding:10px 12px;height:100%;box-sizing:border-box;align-content:flex-start}.smt-card{background:var(--surface-alt);border:1px solid var(--border);border-radius:var(--radius-sm);padding:8px 10px;min-width:0;flex:1 1 90px;cursor:pointer;transition:all .15s;overflow:hidden;position:relative}.smt-card:hover{border-color:var(--accent);transform:translateY(-1px)}.smt-del{position:absolute;top:3px;right:3px;background:none;border:none;color:var(--text-muted);font-size:10px;cursor:pointer;opacity:0;transition:opacity .15s;padding:2px 4px;border-radius:3px}.smt-card:hover .smt-del{opacity:1}.smt-del:hover{color:var(--offline);background:rgba(239,68,68,.15)}.smt-ico{font-size:14px;margin-bottom:3px}.smt-nm{font-size:10px;font-weight:600;margin-bottom:1px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.smt-d{font-size:9px;color:var(--text-muted);line-height:1.25;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.smt-add{background:var(--surface-alt);border:1px dashed var(--border);border-radius:var(--radius-sm);padding:8px 10px;min-width:0;flex:1 1 90px;cursor:pointer;transition:all .15s;display:flex;flex-direction:column;align-items:center;justify-content:center;color:var(--accent)}.smt-add:hover{border-color:var(--accent);background:var(--accent-dim)}.smt-add-ico{font-size:16px;margin-bottom:2px}.smt-add-txt{font-size:9px;font-weight:600;text-align:center}

/* FULL PAGE STYLES */
.page-pad{padding:18px 22px}
.docs-lay{display:grid;grid-template-columns:260px 1fr;height:calc(100vh - 96px);overflow:hidden}
.docs-sb{border-right:1px solid var(--border);background:var(--surface);display:flex;flex-direction:column;overflow:hidden}
.docs-search{padding:10px}.docs-search input{width:100%;padding:6px 9px;border:1px solid var(--border);border-radius:var(--radius-sm);background:var(--surface-alt);color:var(--text);font-size:11px}.docs-search input:focus{border-color:var(--accent)}
.docs-ft{display:flex;gap:4px;padding:0 10px 8px;flex-wrap:wrap}.docs-list{flex:1;overflow-y:auto}
.d-item{display:flex;align-items:center;gap:8px;padding:9px 10px;cursor:pointer;transition:background .1s;border-bottom:1px solid var(--border)}.d-item:hover,.d-item.act{background:var(--surface-alt)}.d-item.act{border-left:2px solid var(--accent)}
.d-ico{width:26px;height:26px;border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:12px;flex-shrink:0}.d-tit{font-size:11px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.d-meta{display:flex;gap:5px;align-items:center;margin-top:2px}.d-type{font-size:8px;font-weight:700;text-transform:uppercase;padding:1px 4px;border-radius:3px;background:var(--surface-alt);color:var(--text-sec)}.d-date{font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--text-muted)}
.docs-view{display:flex;flex-direction:column;overflow:hidden}.docs-vhdr{padding:10px 14px;border-bottom:1px solid var(--border);background:var(--surface);display:flex;align-items:center;justify-content:space-between}.docs-vtitle{font-size:13px;font-weight:700}
.docs-vbody{flex:1;overflow-y:auto;padding:14px;font-size:12px;line-height:1.7}.docs-vbody h1{font-size:18px;font-weight:800;margin:12px 0 6px}.docs-vbody h2{font-size:15px;font-weight:700;color:var(--accent);margin:10px 0 5px}.docs-vbody h3{font-size:13px;font-weight:700;margin:8px 0 3px}
.doc-empty{display:flex;align-items:center;justify-content:center;height:100%;color:var(--text-muted);font-size:12px}
.doc-editor{width:100%;height:100%;background:var(--surface-alt);color:var(--text);border:1px solid var(--border);border-radius:var(--radius-sm);padding:10px;font-family:'JetBrains Mono',monospace;font-size:11px;line-height:1.5;resize:none}.doc-editor:focus{border-color:var(--accent)}
.da-btn{padding:4px 10px;border:1px solid var(--border);border-radius:var(--radius-sm);background:var(--surface-alt);color:var(--text-sec);font-size:10px;font-weight:500;transition:all .15s}.da-btn:hover{border-color:var(--accent);color:var(--accent)}.da-btn.save{background:var(--accent);color:#fff;border-color:var(--accent)}
.mem-identity-sec{border-bottom:1px solid var(--border);padding:0}.mem-id-hdr{padding:8px 12px;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1.2px;color:var(--text-muted)}
.mem-id-item{display:flex;align-items:center;gap:8px;padding:9px 10px;cursor:pointer;transition:background .1s;border-bottom:1px solid var(--border)}.mem-id-item:hover,.mem-id-item.act{background:var(--surface-alt)}.mem-id-item.act{border-left:2px solid var(--accent)}
.mem-lay{display:grid;grid-template-columns:220px 1fr;height:calc(100vh - 96px);overflow:hidden}
.conn-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:10px}
.conn-card{background:var(--surface-alt);border:1px solid var(--border);border-radius:var(--radius);padding:14px 16px;transition:border-color .2s,background .2s,box-shadow .2s;cursor:default;position:relative;z-index:1}
.conn-card:hover{border-color:var(--accent);background:var(--surface);box-shadow:0 0 20px var(--accent-dim);z-index:10}
.conn-top{display:flex;align-items:center;gap:10px}
.conn-ico{font-size:22px;width:40px;height:40px;display:flex;align-items:center;justify-content:center;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-sm);flex-shrink:0}
.conn-info{flex:1;min-width:0}
.conn-nm{font-size:13px;font-weight:700;display:flex;align-items:center;gap:6px;margin-bottom:2px}
.conn-st{font-size:9px;font-weight:700;padding:2px 8px;border-radius:10px;margin-left:auto;text-transform:uppercase;letter-spacing:.5px}
.conn-st.on{background:rgba(52,211,153,.15);color:var(--online)}.conn-st.off{background:rgba(239,68,68,.15);color:var(--offline)}.conn-st.ro{background:rgba(251,191,36,.15);color:var(--idle)}
.conn-desc{font-size:10px;color:var(--text-sec);margin-top:1px}
.conn-access{font-size:9px;font-weight:600;margin-top:4px;display:flex;align-items:center;gap:4px}
.conn-chevron{margin-left:auto;font-size:10px;color:var(--text-muted);transition:transform .2s;flex-shrink:0}
.conn-card:hover .conn-chevron{transform:rotate(180deg);color:var(--accent)}
.conn-detail{max-height:0;overflow:hidden;transition:max-height .3s ease,opacity .2s;opacity:0;position:relative}
.conn-card:hover .conn-detail{max-height:400px;opacity:1}
.conn-detail-inner{padding-top:12px;margin-top:12px;border-top:1px solid var(--border);display:flex;flex-direction:column;gap:8px}
.conn-dl{display:flex;align-items:flex-start;gap:8px;font-size:10px}
.conn-dl-label{color:var(--text-muted);font-weight:600;min-width:80px;flex-shrink:0;text-transform:uppercase;letter-spacing:.5px;font-size:9px}
.conn-dl-val{color:var(--text-sec);word-break:break-all}
.conn-dl-val a{color:var(--accent);text-decoration:none}.conn-dl-val a:hover{text-decoration:underline}
.conn-action-pill{display:inline-flex;align-items:center;gap:5px;font-size:9px;padding:4px 10px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-sm);color:var(--text-sec)}
.conn-action-pill .conn-act-dot{width:5px;height:5px;border-radius:50%;background:var(--online);flex-shrink:0}
.conn-stat-row{display:flex;gap:8px;flex-wrap:wrap}
.conn-stat{flex:1;min-width:70px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-sm);padding:8px 10px;text-align:center}
.conn-stat-val{font-size:14px;font-weight:800;color:var(--text)}
.conn-stat-lbl{font-size:8px;color:var(--text-muted);text-transform:uppercase;letter-spacing:.5px;margin-top:2px}
/* Suggestions section */
.conn-sug-sec{margin-top:20px;padding:16px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);position:relative}
.conn-sug-hdr{font-size:14px;font-weight:800;margin-bottom:4px;display:flex;align-items:center;gap:8px}
.conn-sug-sub{font-size:10px;color:var(--text-sec);margin-bottom:14px}
.conn-sug-grid{display:flex;flex-direction:column;gap:8px}
.conn-sug-card{display:flex;align-items:flex-start;gap:12px;padding:12px 14px;background:var(--surface-alt);border:1px solid var(--border);border-radius:var(--radius-sm);transition:all .2s}
.conn-sug-card:hover{border-color:var(--accent);background:var(--surface)}
.conn-sug-ico{font-size:20px;width:38px;height:38px;display:flex;align-items:center;justify-content:center;background:var(--accent-dim);border:1px solid rgba(232,113,58,.2);border-radius:var(--radius-sm);flex-shrink:0}
.conn-sug-info{flex:1;min-width:0}
.conn-sug-nm{font-size:12px;font-weight:700;margin-bottom:2px}
.conn-sug-reason{font-size:10px;color:var(--text-sec);line-height:1.4;margin-bottom:6px}
.conn-sug-tags{display:flex;gap:4px;flex-wrap:wrap}
.conn-sug-tag{font-size:8px;font-weight:700;padding:2px 7px;border-radius:8px;text-transform:uppercase;letter-spacing:.4px}
.conn-sug-tag.speed{background:rgba(96,165,250,.12);color:var(--working)}
.conn-sug-tag.goals{background:rgba(52,211,153,.12);color:var(--online)}
.conn-sug-tag.data{background:rgba(192,132,252,.12);color:var(--review-purple)}
.conn-sug-tag.auto{background:rgba(232,113,58,.12);color:var(--accent)}
/* Connect/Disconnect toggle button */
.conn-toggle-btn{padding:4px 12px;border-radius:var(--radius-sm);font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;cursor:pointer;transition:all .2s;border:1px solid;display:inline-flex;align-items:center;gap:4px}
.conn-toggle-btn.on{background:rgba(52,211,153,.12);color:var(--online);border-color:rgba(52,211,153,.3)}
.conn-toggle-btn.on:hover{background:rgba(239,68,68,.12);color:var(--offline);border-color:rgba(239,68,68,.3)}
.conn-toggle-btn.off{background:rgba(239,68,68,.12);color:var(--offline);border-color:rgba(239,68,68,.3)}
.conn-toggle-btn.off:hover{background:rgba(52,211,153,.12);color:var(--online);border-color:rgba(52,211,153,.3)}
/* Access level dropdown */
.conn-access-wrap{position:relative;display:inline-flex}
.conn-access-dd{display:none;position:absolute;top:100%;left:0;z-index:50;min-width:140px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-sm);box-shadow:0 8px 24px rgba(0,0,0,.4);padding:4px;margin-top:4px}
.conn-access-wrap:hover .conn-access-dd{display:block}
.conn-access-opt{display:flex;align-items:center;gap:6px;padding:6px 10px;font-size:10px;font-weight:600;border-radius:4px;cursor:pointer;transition:all .15s;color:var(--text-sec)}
.conn-access-opt:hover{background:var(--accent-dim);color:var(--accent)}
.conn-access-opt.active{color:var(--accent);background:var(--accent-dim)}
.conn-access-opt .acc-dot{width:6px;height:6px;border-radius:50%;flex-shrink:0}
.conn-access-opt .acc-dot.none{background:var(--offline)}
.conn-access-opt .acc-dot.read{background:var(--idle)}
.conn-access-opt .acc-dot.rw{background:var(--online)}
/* Suggestion connect link */
.conn-sug-connect{display:inline-flex;align-items:center;gap:4px;padding:4px 10px;font-size:9px;font-weight:700;color:var(--accent);border:1px solid var(--accent);border-radius:var(--radius-sm);text-decoration:none;transition:all .15s;margin-top:6px}
.conn-sug-connect:hover{background:var(--accent);color:#fff}
/* From Claude badge */
.doc-from-claude{display:inline-flex;align-items:center;gap:3px;font-size:8px;font-weight:700;padding:1px 6px;border-radius:8px;background:rgba(192,132,252,.12);color:var(--review-purple);margin-left:6px;vertical-align:middle}
.wf-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px}.wf-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:12px 14px;transition:all .15s}.wf-card:hover{border-color:var(--border-hover)}.wf-card-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:5px}.wf-card-nm{font-size:12px;font-weight:700}.wf-badge{font-size:8px;font-weight:700;padding:2px 7px;border-radius:8px;text-transform:uppercase}.wf-badge.on{background:rgba(52,211,153,.15);color:var(--online)}.wf-badge.off{background:rgba(251,191,36,.15);color:var(--idle)}.wf-card-freq{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--accent);margin-bottom:3px}.wf-card-desc{font-size:10px;color:var(--text-sec);line-height:1.3;margin-bottom:5px}.wf-card-acts{display:flex;gap:6px;align-items:center}.wf-tog{position:relative;width:30px;height:16px;border-radius:8px;transition:background .3s;cursor:pointer}.wf-tog.on{background:var(--online)}.wf-tog.off{background:var(--text-muted)}.wf-tog::after{content:'';position:absolute;top:2px;left:2px;width:12px;height:12px;border-radius:50%;background:#fff;transition:transform .3s}.wf-tog.on::after{transform:translateX(14px)}.wf-run-btn{padding:3px 8px;border:1px solid var(--border);border-radius:var(--radius-sm);color:var(--text-sec);font-size:10px;font-weight:600;transition:all .15s}.wf-run-btn:hover{border-color:var(--accent);color:var(--accent)}

/* AESTHETICS */
.ae-sec{margin-bottom:20px}.ae-sec-t{font-size:13px;font-weight:700;margin-bottom:10px;padding-bottom:5px;border-bottom:1px solid var(--border)}
.ae-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:6px}
.ae-swatch{display:flex;align-items:center;gap:7px;padding:6px 8px;background:var(--surface-alt);border:1px solid var(--border);border-radius:var(--radius-sm);transition:all .15s}.ae-swatch:hover{border-color:var(--border-hover)}
.ae-cprev{width:24px;height:24px;border-radius:5px;flex-shrink:0;border:1px solid rgba(255,255,255,.1);cursor:pointer;position:relative;overflow:hidden}.ae-cprev input[type=color]{position:absolute;inset:-4px;width:calc(100%+8px);height:calc(100%+8px);border:none;cursor:pointer;opacity:0}
.ae-label{font-size:9px;font-weight:600}.ae-var{font-size:7px;color:var(--text-muted);font-family:'JetBrains Mono',monospace}
.ae-hex{width:64px;padding:2px 4px;border:1px solid var(--border);border-radius:3px;background:var(--bg);color:var(--text);font-size:8px;font-family:'JetBrains Mono',monospace;text-align:center}.ae-hex:focus{border-color:var(--accent)}
.theme-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:8px}.theme-card{background:var(--surface-alt);border:2px solid var(--border);border-radius:var(--radius-sm);padding:10px;cursor:pointer;transition:all .15s;text-align:center}.theme-card:hover{border-color:var(--border-hover)}.theme-card.active{border-color:var(--accent);box-shadow:0 0 12px var(--accent-glow)}.theme-card .prev{display:flex;gap:3px;justify-content:center;margin-bottom:6px}.theme-card .prev span{width:14px;height:14px;border-radius:3px;border:1px solid rgba(255,255,255,.08)}.theme-card .tnm{font-size:10px;font-weight:600}
.ae-slider-row{display:flex;align-items:center;gap:10px;margin-bottom:8px}.ae-slider-row label{font-size:10px;font-weight:600;min-width:100px}.ae-slider-row input[type=range]{width:140px;max-width:140px;flex:none;accent-color:var(--accent)}.ae-slider-val{font-size:10px;font-family:'JetBrains Mono',monospace;color:var(--text-sec);min-width:40px}
.ae-num-input{width:52px;padding:3px 4px;border:1px solid var(--border);border-radius:var(--radius-sm);background:var(--surface-alt);color:var(--text);font-size:11px;font-family:'JetBrains Mono',monospace;text-align:center;-moz-appearance:textfield}.ae-num-input::-webkit-inner-spin-button,.ae-num-input::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}.ae-num-input:focus{border-color:var(--accent);outline:none}
.ae-toggle-row{display:flex;align-items:center;justify-content:space-between;padding:6px 0;border-bottom:1px solid var(--border)}.ae-toggle-label{font-size:11px;font-weight:500}.ae-toggle-desc{font-size:9px;color:var(--text-muted)}
.ae-upload-row{display:flex;align-items:center;gap:12px;padding:8px 0;border-bottom:1px solid var(--border)}.ae-upload-info{flex:1;min-width:0}.ae-upload-label{font-size:11px;font-weight:600}.ae-upload-desc{font-size:9px;color:var(--text-muted)}
.ae-upload-box{width:48px;height:48px;border:2px dashed var(--border);border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .15s;overflow:hidden;flex-shrink:0}.ae-upload-box:hover{border-color:var(--accent);background:var(--accent-dim)}
.ae-upload-preview{width:100%;height:100%;object-fit:cover}.ae-upload-placeholder{font-size:9px;color:var(--text-muted);text-align:center;line-height:1.2}
.ae-upload-clear{width:22px;height:22px;border-radius:50%;border:1px solid var(--border);background:var(--surface-alt);color:var(--text-muted);font-size:10px;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0}.ae-upload-clear:hover{border-color:var(--critical);color:var(--critical)}

/* SECURITY */
.sec-score-ring{position:relative;display:inline-flex;align-items:center;justify-content:center}

/* COMPACT MODE */
body.compact .nav-item{padding:5px 10px;font-size:12px}body.compact .scard{padding:8px 10px}body.compact .tc{padding:6px 8px;margin-bottom:4px}body.compact .win-bar{padding:4px 8px}body.compact .hdr{padding:5px 16px}body.compact .scard .sc-val{font-size:15px}body.compact .scard .sc-label{font-size:8px}body.compact .le{padding:5px 10px}body.compact .kb-col-hdr{margin-bottom:5px;padding-bottom:4px}

/* ANALYTICS */
.an-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:16px}.an-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:14px;text-align:center;position:relative}.an-card-ico{font-size:24px;margin-bottom:6px}.an-card-val{font-size:22px;font-weight:800;margin-bottom:2px}.an-card-label{font-size:10px;color:var(--text-sec);font-weight:600;text-transform:uppercase;letter-spacing:.5px}
.an-chart{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:14px;margin-bottom:12px}.an-chart-t{font-size:12px;font-weight:700;margin-bottom:10px}.an-bar-row{display:flex;align-items:center;gap:8px;margin-bottom:6px}.an-bar-label{font-size:10px;font-weight:600;min-width:80px;text-align:right}.an-bar-track{flex:1;height:18px;background:var(--surface-alt);border-radius:4px;overflow:hidden}.an-bar-fill{height:100%;border-radius:4px;transition:width .5s;display:flex;align-items:center;padding-left:6px;font-size:9px;font-weight:700;color:#fff}
.an-row2{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px}
.an-coming{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:20px;text-align:center}.an-coming-t{font-size:16px;font-weight:700;margin-bottom:4px;background:linear-gradient(135deg,var(--accent),var(--online));-webkit-background-clip:text;-webkit-text-fill-color:transparent}.an-coming-d{font-size:11px;color:var(--text-sec);margin-bottom:14px}.an-coming-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}.an-coming-item{background:var(--surface-alt);border:1px solid var(--border);border-radius:var(--radius-sm);padding:12px 8px}.an-coming-item .ico{font-size:18px;margin-bottom:4px}.an-coming-item .nm{font-size:11px;font-weight:600;margin-bottom:2px}.an-coming-item .desc{font-size:9px;color:var(--text-muted)}

/* AI RADAR */
.rec-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}.rec-sec{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:14px}.rec-sec-t{font-size:12px;font-weight:700;margin-bottom:10px}
.rec-item{display:flex;gap:8px;padding:8px;background:var(--surface-alt);border:1px solid var(--border);border-radius:var(--radius-sm);margin-bottom:6px;cursor:pointer;transition:all .15s}.rec-item:hover{border-color:var(--accent);transform:translateX(2px)}
.rec-ico{width:28px;height:28px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:13px;flex-shrink:0}.rec-nm{font-size:11px;font-weight:600;margin-bottom:1px}.rec-desc{font-size:9px;color:var(--text-sec);line-height:1.3}
.rec-tag{font-size:7px;font-weight:700;padding:1px 5px;border-radius:8px;text-transform:uppercase;margin-top:3px;display:inline-block}.rec-tag.eff{background:rgba(52,211,153,.15);color:var(--online)}.rec-tag.auto{background:rgba(96,165,250,.15);color:var(--working)}.rec-tag.grow{background:rgba(232,113,58,.15);color:var(--accent)}.rec-tag.news{background:rgba(192,132,252,.15);color:var(--review-purple)}
.news-item{padding:10px;background:var(--surface-alt);border:1px solid var(--border);border-radius:var(--radius-sm);margin-bottom:6px;transition:all .15s}.news-item:hover{border-color:var(--accent)}.news-src{font-size:8px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;color:var(--review-purple);margin-bottom:2px}.news-title{font-size:11px;font-weight:600;line-height:1.35;margin-bottom:3px}.news-title a{color:var(--text);text-decoration:none;transition:color .15s}.news-title a:hover{color:var(--accent);text-decoration:underline}.news-excerpt{font-size:10px;color:var(--text-sec);line-height:1.3;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.news-date{font-size:8px;color:var(--text-muted);font-family:'JetBrains Mono',monospace;margin-top:4px}.news-link{display:inline-flex;align-items:center;gap:3px;font-size:8px;font-weight:600;color:var(--accent);text-decoration:none;margin-top:4px;transition:opacity .15s}.news-link:hover{opacity:.8;text-decoration:underline}
.rec-item a.rec-link{display:inline-flex;align-items:center;gap:3px;font-size:8px;font-weight:600;color:var(--accent);text-decoration:none;margin-top:2px;transition:opacity .15s}.rec-item a.rec-link:hover{opacity:.8;text-decoration:underline}

/* GOALS */
.goal-del{position:absolute;top:10px;right:10px;width:28px;height:28px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:14px;color:var(--text-muted);opacity:0;transition:all .15s;cursor:pointer;z-index:2;background:var(--surface-alt);border:1px solid var(--border)}.goal-card:hover .goal-del{opacity:1}.goal-del:hover{background:rgba(239,68,68,.2);color:var(--offline);border-color:var(--offline)}
.goal-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin-bottom:12px;position:relative;overflow:hidden}
.goal-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px}
.goal-card.g-active::before{background:var(--accent)}.goal-card.g-done::before{background:var(--online)}.goal-card.g-plan::before{background:var(--working)}
.goal-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}.goal-title{font-size:14px;font-weight:700}.goal-badge{font-size:8px;font-weight:700;padding:2px 8px;border-radius:10px;text-transform:uppercase}
.goal-badge.active{background:rgba(232,113,58,.15);color:var(--accent)}.goal-badge.planning{background:rgba(96,165,250,.15);color:var(--working)}.goal-badge.achieved{background:rgba(52,211,153,.15);color:var(--online)}
.goal-desc{font-size:11px;color:var(--text-sec);line-height:1.4;margin-bottom:10px}
.goal-progress{margin-bottom:8px}.goal-prog-bar{height:8px;background:var(--surface-alt);border-radius:4px;overflow:hidden;margin-top:4px}.goal-prog-fill{height:100%;border-radius:4px;transition:width .5s}
.goal-prog-top{display:flex;justify-content:space-between;align-items:center}.goal-prog-label{font-size:9px;font-weight:600;color:var(--text-sec)}.goal-prog-pct{font-size:11px;font-weight:800;font-family:'JetBrains Mono',monospace}
.goal-milestones{margin-top:8px}.goal-ms{display:flex;align-items:center;gap:6px;padding:3px 0;font-size:10px}.goal-ms.done{color:var(--online)}.goal-ms.pend{color:var(--text-sec)}
.goal-encourage{margin-top:10px;padding:8px 12px;background:var(--accent-dim);border:1px solid rgba(232,113,58,.2);border-radius:var(--radius-sm);font-size:10px;color:var(--accent);font-weight:500;font-style:italic}
.goal-metrics{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:10px}.goal-metric{text-align:center;padding:6px;background:var(--surface-alt);border-radius:var(--radius-sm)}.goal-metric-val{font-size:16px;font-weight:800}.goal-metric-label{font-size:8px;color:var(--text-muted);text-transform:uppercase}
.goal-add-btn{padding:10px;border:2px dashed var(--border);border-radius:var(--radius);text-align:center;color:var(--text-muted);font-size:12px;font-weight:600;cursor:pointer;transition:all .15s}.goal-add-btn:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-dim)}

/* GOALS WINDOWED LAYOUT */
#pg-goals.active{padding:0;overflow:hidden;display:flex;flex-direction:column}
#goalTabBar{display:flex;gap:4px;padding:6px 18px;border-bottom:1px solid var(--border);background:var(--surface);overflow-x:auto;flex-shrink:0}
#goalScroll{flex:1;overflow:auto;position:relative}
#goalHeader{padding:14px 18px 0}
#goalCanvas{position:relative;min-height:600px;margin:0 18px 18px}

/* SETTINGS */
.set-wrap{max-width:600px;margin:0 auto}.set-sec{margin-bottom:18px}.set-sec-t{font-size:13px;font-weight:700;margin-bottom:8px;padding-bottom:5px;border-bottom:1px solid var(--border)}.set-row{display:flex;align-items:center;justify-content:space-between;padding:7px 0;border-bottom:1px solid var(--border)}.set-lbl{font-size:11px;font-weight:500}.set-desc{font-size:9px;color:var(--text-muted);margin-top:1px}.set-inp{padding:4px 8px;border:1px solid var(--border);border-radius:var(--radius-sm);background:var(--surface-alt);color:var(--text);font-size:11px;width:160px}.set-inp:focus{border-color:var(--accent)}.set-btn{padding:5px 12px;border:1px solid var(--border);border-radius:var(--radius-sm);background:var(--surface-alt);color:var(--text);font-size:11px;font-weight:500;transition:all .15s}.set-btn:hover{border-color:var(--accent);color:var(--accent)}.set-btn.danger{color:var(--offline)}.set-btn.danger:hover{border-color:var(--offline)}
.modal-ov{display:none;position:fixed;inset:0;background:rgba(0,0,0,.65);z-index:1000;align-items:center;justify-content:center;backdrop-filter:blur(4px)}.modal-ov.show{display:flex}
.modal{background:var(--surface);border:1px solid var(--border-hover);border-radius:var(--radius-lg);padding:18px;width:90%;max-width:420px;box-shadow:0 20px 60px rgba(0,0,0,.5)}
.mod-t{font-size:14px;font-weight:700;margin-bottom:12px}.mod-f{margin-bottom:8px}.mod-f label{display:block;font-size:9px;font-weight:600;color:var(--text-sec);margin-bottom:2px;text-transform:uppercase;letter-spacing:.5px}
.mod-f input,.mod-f select,.mod-f textarea{width:100%;padding:6px 9px;border:1px solid var(--border);border-radius:var(--radius-sm);background:var(--surface-alt);color:var(--text);font-size:11px}.mod-f input:focus,.mod-f select:focus,.mod-f textarea:focus{border-color:var(--accent)}.mod-f textarea{resize:vertical;min-height:40px}
.mod-acts{display:flex;gap:6px;justify-content:flex-end;margin-top:12px}.mod-btn{padding:6px 14px;border-radius:var(--radius-sm);font-weight:600;font-size:11px;transition:all .15s}.mod-btn.pri{background:var(--accent);color:#fff}.mod-btn.pri:hover{filter:brightness(1.1)}.mod-btn.sec{background:var(--surface-alt);color:var(--text-sec);border:1px solid var(--border)}
.mod-f-row{display:grid;grid-template-columns:1fr 1fr;gap:8px}

/* INSTRUCTIONS / USER MANUAL */
.ins-wrap{max-width:860px;margin:0 auto;padding-bottom:40px}
.ins-hero{text-align:center;padding:28px 0 20px;border-bottom:1px solid var(--border);margin-bottom:24px}
.ins-hero-ico{font-size:42px;margin-bottom:8px}
.ins-hero h2{font-size:22px;font-weight:900;margin-bottom:4px}
.ins-hero-sub{font-size:12px;color:var(--text-sec);line-height:1.5;max-width:550px;margin:0 auto}
.ins-toc{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:16px 20px;margin-bottom:24px}
.ins-toc-t{font-size:12px;font-weight:700;margin-bottom:8px;color:var(--accent)}
.ins-toc-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:4px}
.ins-toc-link{font-size:11px;color:var(--text-sec);padding:4px 8px;border-radius:var(--radius-sm);cursor:pointer;transition:all .15s;display:flex;align-items:center;gap:6px}
.ins-toc-link:hover{background:var(--accent-dim);color:var(--accent)}
.ins-section{margin-bottom:20px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden}
.ins-sec-hdr{display:flex;align-items:center;gap:10px;padding:14px 18px;cursor:pointer;transition:all .15s;user-select:none}
.ins-sec-hdr:hover{background:var(--surface-alt)}
.ins-sec-ico{font-size:20px;width:36px;height:36px;display:flex;align-items:center;justify-content:center;background:var(--accent-dim);border:1px solid rgba(232,113,58,.2);border-radius:var(--radius-sm);flex-shrink:0}
.ins-sec-title{font-size:14px;font-weight:800;flex:1}
.ins-sec-chev{font-size:10px;color:var(--text-muted);transition:transform .2s}
.ins-section.open .ins-sec-chev{transform:rotate(180deg);color:var(--accent)}
.ins-sec-body{max-height:0;overflow:hidden;transition:max-height .4s ease}
.ins-section.open .ins-sec-body{max-height:5000px}
.ins-sec-inner{padding:0 18px 18px;border-top:1px solid var(--border)}
.ins-purpose{font-size:11px;color:var(--text-sec);line-height:1.5;padding:12px 0 10px;border-bottom:1px solid var(--border);margin-bottom:12px}
.ins-feat{margin-bottom:14px}
.ins-feat-t{font-size:12px;font-weight:700;color:var(--accent);margin-bottom:4px;display:flex;align-items:center;gap:6px}
.ins-feat-desc{font-size:10px;color:var(--text-sec);line-height:1.5;margin-bottom:4px}
.ins-tip{display:flex;gap:8px;padding:8px 12px;background:var(--accent-dim);border:1px solid rgba(232,113,58,.15);border-radius:var(--radius-sm);margin-top:6px;margin-bottom:4px}
.ins-tip-ico{flex-shrink:0;font-size:12px;margin-top:1px}
.ins-tip-txt{font-size:10px;color:var(--accent);line-height:1.45;font-weight:500}
.ins-proto{display:flex;gap:8px;padding:8px 12px;background:rgba(52,211,153,.06);border:1px solid rgba(52,211,153,.12);border-radius:var(--radius-sm);margin-top:6px;margin-bottom:4px}
.ins-proto-ico{flex-shrink:0;font-size:12px;margin-top:1px}
.ins-proto-txt{font-size:10px;color:var(--online);line-height:1.45;font-weight:500}
.ins-key{font-size:10px;color:var(--text);line-height:1.5;padding:4px 0}
.ins-key strong{color:var(--accent);font-weight:700}
.ins-divider{height:1px;background:var(--border);margin:10px 0}
.ins-philosophy{background:linear-gradient(135deg,var(--surface),var(--surface-alt));border:1px solid var(--border);border-radius:var(--radius);padding:20px;margin-top:24px;text-align:center}
.ins-philosophy h3{font-size:14px;font-weight:800;margin-bottom:6px;background:linear-gradient(135deg,var(--accent),var(--online));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.ins-philosophy p{font-size:11px;color:var(--text-sec);line-height:1.6;max-width:600px;margin:0 auto}

/* ALL CONNECTIONS MODAL */
.allconn-modal{width:95%;max-width:720px;max-height:85vh;display:flex;flex-direction:column}
.td-modal{width:95%;max-width:560px;max-height:85vh;overflow-y:auto;padding:0}
.td-hdr{padding:18px 20px 14px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:flex-start;gap:12px}
.td-hdr-left{flex:1;min-width:0}
.td-title-row{display:flex;align-items:center;gap:10px}
.td-title{font-size:16px;font-weight:700;color:var(--text);word-break:break-word;flex:1}
.td-title-input{font-size:16px;font-weight:700;color:var(--text);background:var(--surface-hover);border:1px solid var(--border-hover);border-radius:var(--radius);padding:4px 8px;width:100%;font-family:inherit}
.td-close{background:none;border:none;color:var(--text-muted);font-size:18px;cursor:pointer;padding:4px 8px;border-radius:var(--radius);transition:all .15s}.td-close:hover{background:var(--surface-hover);color:var(--text)}
.td-body{padding:16px 20px}
.td-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px}
.td-field{display:flex;flex-direction:column;gap:4px}
.td-field.full{grid-column:1/-1}
.td-label{font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;color:var(--text-muted)}
.td-val{font-size:13px;color:var(--text);padding:6px 8px;background:var(--surface-hover);border-radius:var(--radius);min-height:28px;display:flex;align-items:center}
.td-val select,.td-val input,.td-val textarea{background:var(--surface-hover);border:1px solid transparent;color:var(--text);font-size:13px;font-family:inherit;width:100%;padding:2px 4px;border-radius:var(--radius)}.td-val select:focus,.td-val input:focus,.td-val textarea:focus{border-color:var(--accent);outline:none}
.td-val textarea{min-height:60px;resize:vertical}
.td-status-badge{display:inline-flex;align-items:center;gap:4px;padding:3px 10px;border-radius:12px;font-size:11px;font-weight:600}
.td-footer{padding:14px 20px;border-top:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
.td-timestamps{font-size:10px;color:var(--text-muted);display:flex;flex-direction:column;gap:2px}
.td-save{background:var(--accent);color:#fff;border:none;padding:7px 18px;border-radius:var(--radius);font-size:12px;font-weight:600;cursor:pointer;transition:all .15s}.td-save:hover{filter:brightness(1.15)}
.allconn-hdr{display:flex;align-items:center;justify-content:space-between;padding-bottom:14px;border-bottom:1px solid var(--border);margin-bottom:0;flex-shrink:0}
.allconn-hdr h3{font-size:16px;font-weight:800}.allconn-hdr .allconn-cnt{font-size:10px;color:var(--text-muted);font-weight:600;margin-left:8px}
.allconn-close{width:28px;height:28px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:14px;color:var(--text-muted);transition:all .15s;cursor:pointer;border:1px solid var(--border)}.allconn-close:hover{background:rgba(239,68,68,.15);color:var(--offline);border-color:var(--offline)}
.allconn-filters{display:flex;gap:4px;padding:10px 0;flex-wrap:wrap;flex-shrink:0;border-bottom:1px solid var(--border)}
.allconn-scroll{flex:1;overflow-y:auto;padding:10px 0}
.allconn-cat{margin-bottom:16px}
.allconn-cat-hdr{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:var(--text-muted);padding:4px 0 8px;display:flex;align-items:center;gap:6px}
.allconn-cat-hdr::after{content:'';flex:1;height:1px;background:var(--border)}
.allconn-item{display:flex;align-items:flex-start;gap:12px;padding:12px 14px;background:var(--surface-alt);border:1px solid var(--border);border-radius:var(--radius-sm);margin-bottom:6px;transition:all .15s}
.allconn-item:hover{border-color:var(--accent);background:var(--surface)}
.allconn-item-ico{font-size:20px;width:38px;height:38px;display:flex;align-items:center;justify-content:center;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-sm);flex-shrink:0}
.allconn-item-info{flex:1;min-width:0}
.allconn-item-nm{font-size:12px;font-weight:700;margin-bottom:2px;display:flex;align-items:center;gap:6px}
.allconn-item-nm .allconn-connected{font-size:8px;font-weight:700;padding:2px 6px;border-radius:8px;background:rgba(52,211,153,.12);color:var(--online);text-transform:uppercase}
.allconn-item-desc{font-size:10px;color:var(--text-sec);line-height:1.45}
.allconn-item-tags{display:flex;gap:4px;flex-wrap:wrap;margin-top:5px}
.allconn-view-btn{display:inline-flex;align-items:center;gap:5px;padding:6px 16px;border:1px solid var(--accent);border-radius:var(--radius-sm);color:var(--accent);font-size:11px;font-weight:700;background:var(--accent-dim);cursor:pointer;transition:all .15s;margin-top:8px}
.allconn-view-btn:hover{background:var(--accent);color:#fff}
</style>
</head>
<body>
<aside class="sidebar">
  <div class="sb-brand"><div class="sb-logo">FF</div><div><h1>FORGED</h1><span>Command Center</span></div></div>
  <div class="agent-tracker" id="agentTracker"></div>
  <nav class="sb-nav" id="sideNav">
    <div class="nav-sec"><div class="nav-sec-label">Command</div>
      <div class="nav-item active" data-page="overview"><span>📊</span> Overview</div>
      <div class="nav-item" data-page="notes"><span>💬</span> Notes <span class="nav-unread" id="ur-notes"></span></div></div>
    <div class="nav-sec"><div class="nav-sec-label">Operations</div>
      <div class="nav-item" data-page="taskboard"><span>📋</span> TaskBoard <span class="nav-unread" id="ur-taskboard"></span></div>
      <div class="nav-item" data-page="workflows"><span>⚡</span> Workflows <span class="nav-unread" id="ur-workflows"></span></div>
      <div class="nav-item" data-page="briefing"><span>📰</span> Daily Reports <span class="nav-unread" id="ur-briefing"></span></div>
      <div class="nav-item" data-page="analytics"><span>📈</span> Analytics</div>
      <div class="nav-item" data-page="goals"><span>🎯</span> Goals <span class="nav-unread" id="ur-goals"></span></div></div>
    <div class="nav-sec"><div class="nav-sec-label">Intelligence</div>
      <div class="nav-item" data-page="documents"><span>📄</span> Documents <span class="nav-unread" id="ur-documents"></span></div>
      <div class="nav-item" data-page="memory"><span>🧠</span> Memory <span class="nav-unread" id="ur-memory"></span></div>
      <div class="nav-item" data-page="radar"><span>🛰️</span> AI Radar</div></div>
    <div class="nav-sec"><div class="nav-sec-label">System</div>
      <div class="nav-item" data-page="systems"><span>🔌</span> Systems</div>
      <div class="nav-item" data-page="security"><span>🛡️</span> Security</div>
      <div class="nav-item" data-page="aesthetics"><span>🎨</span> Aesthetics</div>
      <div class="nav-item" data-page="settings"><span>⚙️</span> Settings</div></div>
    <div class="nav-sec"><div class="nav-sec-label">Help</div>
      <div class="nav-item" data-page="instructions"><span>📖</span> Instructions</div></div>
  </nav>
  <div class="sb-footer"><div class="sb-conn"><div class="sb-dot"></div><span>All systems connected</span></div><div class="sb-version">Forged Financial v5.0</div><div style="display:flex;gap:8px;margin-top:6px"><a onclick="if(confirm('Clear all cache and reload?')){localStorage.removeItem('ff_v41');localStorage.removeItem('ff_unread_seen');localStorage.removeItem('ff_sync_ts');caches&&caches.keys().then(k=>k.forEach(n=>caches.delete(n)));location.reload(true)}" style="font-size:9px;color:var(--text-muted);cursor:pointer;text-decoration:none;opacity:.6;transition:opacity .2s;padding:3px 8px;border:1px solid var(--border);border-radius:4px" onmouseover="this.style.opacity='1';this.style.color='var(--accent)'" onmouseout="this.style.opacity='.6';this.style.color='var(--text-muted)'">🧹 Clear Cache</a><a href="/logout" style="font-size:9px;color:var(--text-muted);text-decoration:none;opacity:.6;transition:opacity .2s;padding:3px 8px;border:1px solid var(--border);border-radius:4px" onmouseover="this.style.opacity='1';this.style.color='var(--offline)'" onmouseout="this.style.opacity='.6';this.style.color='var(--text-muted)'">🔒 Logout</a></div></div>
</aside>
<div class="main">
  <header class="hdr">
    <div class="hdr-left">
      <div><h2 id="greeting">Good morning, Danny 👋</h2><div class="hdr-sub" id="dateStr"></div></div>
    </div>
    <div class="hdr-right">
      <div class="hdr-pill health"><div class="dot"></div> Online</div>
      <div class="hdr-pill hb"><div class="dot"></div> <span id="hbTimer">29:45</span></div>
      <div class="hdr-clock" id="clock"></div>
      <div class="qa-wrap">
        <button class="qa-btn" onclick="openModal()">+ Task</button>
        <button class="qa-btn" onclick="fireHeartbeat()">💓</button>
        <button class="qa-btn" onclick="logPrompt()">📝</button>
      </div>
    </div>
  </header>
  <div class="mem-bar">
    <span class="mem-bar-label">Memory:</span>
    <div class="mem-chip daily" id="mcD">📅 Daily Log</div>
    <div class="mem-chip longterm" id="mcL">🧠 MEMORY.md</div>
    <div class="mem-chip project" id="mcP">📁 Projects</div>
  </div>
  <div class="content">
    <div class="page active" id="pg-overview"><div class="tab-bar" id="tabBar"></div><div id="ovScroll"><div class="ov-locked" id="ovLocked"></div><div id="winCanvas"></div></div></div>
    <div class="page" id="pg-notes"></div>
    <div class="page" id="pg-taskboard"></div>
    <div class="page" id="pg-workflows"></div>
    <div class="page" id="pg-briefing"></div>
    <div class="page" id="pg-analytics"></div>
    <div class="page" id="pg-goals"></div>
    <div class="page" id="pg-documents"></div>
    <div class="page" id="pg-memory"></div>
    <div class="page" id="pg-radar"></div>
    <div class="page" id="pg-systems"></div>
    <div class="page" id="pg-security"></div>
    <div class="page" id="pg-aesthetics"></div>
    <div class="page" id="pg-settings"></div>
    <div class="page" id="pg-instructions"></div>
  </div>
</div>
<div class="modal-ov" id="taskModal"><div class="modal">
  <div class="mod-t">Add New Task</div>
  <div class="mod-f"><label>Title</label><input type="text" id="mTitle"/></div>
  <div class="mod-f"><label>Description</label><textarea id="mDesc"></textarea></div>
  <div class="mod-f-row"><div class="mod-f"><label>Priority</label><select id="mPri"><option value="critical">🔴 Critical</option><option value="high">🟠 High</option><option value="medium" selected>🟡 Medium</option><option value="low">⚪ Low</option></select></div><div class="mod-f"><label>Category</label><select id="mCat"><option value="insurance">Insurance</option><option value="ai">AI</option><option value="marketing">Marketing</option><option value="drhq">DR HQ</option><option value="crm">CRM</option></select></div></div>
  <div class="mod-f-row"><div class="mod-f"><label>Assigned To</label><select id="mAssign"><option value="danny">Danny</option><option value="openclaw">Openclaw.ai</option><option value="claude">Claude</option><option value="shary">Shary</option><option value="john">John</option></select></div><div class="mod-f"><label>Deadline</label><input type="text" id="mDead" placeholder="e.g. Friday, next week, March 15, in 3 days"/></div></div>
  <div class="mod-f-row"><div class="mod-f"><label>Scheduled Start</label><input type="text" id="mSched" placeholder="e.g. tomorrow 9am, Monday at 2pm, in 1 hour"/></div><div class="mod-f"><label>Status</label><select id="mStatus"><option value="new_task">New Task</option><option value="scheduled">📅 Scheduled</option><option value="in_progress">In Progress</option><option value="review">Review</option><option value="clawd_suggestion">🤖 Clawd Suggestion</option></select></div></div>
  <div class="mod-acts"><button class="mod-btn sec" onclick="closeModal()">Cancel</button><button class="mod-btn pri" onclick="saveTask()">Add Task</button></div>
</div></div>
<div class="modal-ov" id="memFileModal"><div class="modal">
  <div class="mod-t">New Memory File</div>
  <div class="mod-f"><label>Name</label><input type="text" id="memFName" placeholder="e.g. CRM-Project.md"/></div>
  <div class="mod-f"><label>Type</label><select id="memFType"><option value="project">Project</option><option value="daily">Daily Log</option><option value="longterm">Long-Term</option></select></div>
  <div class="mod-acts"><button class="mod-btn sec" onclick="closeMemModal()">Cancel</button><button class="mod-btn pri" onclick="createMemFile()">Create</button></div>
</div></div>
<div class="modal-ov" id="goalModal"><div class="modal">
  <div class="mod-t">Add Goal</div>
  <div class="mod-f"><label>Goal Title</label><input type="text" id="gTitle"/></div>
  <div class="mod-f"><label>Description</label><textarea id="gDesc"></textarea></div>
  <div class="mod-f-row"><div class="mod-f"><label>Target Date</label><input type="date" id="gDeadline"/></div><div class="mod-f"><label>Category</label><select id="gCat"><option value="revenue">💰 Revenue</option><option value="growth">📈 Growth</option><option value="systems">⚙️ Systems</option><option value="personal">🧘 Personal</option></select></div></div>
  <div class="mod-f"><label>Milestones (one per line)</label><textarea id="gMilestones" rows="4" placeholder="Research phase&#10;Build prototype&#10;Launch"></textarea></div>
  <div class="mod-acts"><button class="mod-btn sec" onclick="closeGoalModal()">Cancel</button><button class="mod-btn pri" onclick="saveGoal()">Add Goal</button></div>
</div></div>
<div class="modal-ov" id="taskDetailModal" onclick="if(event.target===this)closeTaskDetail()"><div class="modal td-modal" id="taskDetailInner"></div></div>
<div class="modal-ov" id="allConnModal"><div class="modal allconn-modal" id="allConnInner"></div></div>
<script>
if(location.search.includes('reset=1')){localStorage.removeItem('ff_v41');localStorage.removeItem('ff_unread_seen');history.replaceState(null,'',location.pathname);location.reload()}
const KEY='ff_v41';const gid=()=>Date.now().toString(36)+Math.random().toString(36).substr(2,5);const ts=()=>new Date().toISOString();
const fmt=i=>new Date(i).toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit',hour12:true});
const fmtD=i=>{const d=new Date(i);return(d.getMonth()+1)+'/'+d.getDate()+'/'+(d.getFullYear()%100)};
const fmtDT=i=>{const d=new Date(i);return fmtD(i)+' - '+d.toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit',hour12:true}).toLowerCase()};const rel=i=>{const d=Date.now()-new Date(i).getTime();if(d<0){const fm=Math.floor(-d/6e4);if(fm<60)return'in '+fm+'m';const fh=Math.floor(fm/60);return fh<24?'in '+fh+'h':'in '+Math.floor(fh/24)+'d'}const m=Math.floor(d/6e4);if(m<1)return'now';if(m<60)return m+'m';const h=Math.floor(m/60);return h<24?h+'h':Math.floor(h/24)+'d'};

const COLS=[{id:'new_task',name:'New Task',css:'new_task'},{id:'in_progress',name:'In Progress',css:'progress'},{id:'review',name:'Review',css:'review'},{id:'done',name:'Completed',css:'done'}];
const SCHED_COL={id:'scheduled',name:'Scheduled',css:'scheduled'};const CLAWD_COL={id:'clawd_suggestion',name:'Clawd Suggestions',css:'clawd_sugg'};const ALL_COLS=[...COLS,SCHED_COL,CLAWD_COL];
const CATS=[{id:'insurance',name:'Insurance',css:'cat-ins'},{id:'ai',name:'AI',css:'cat-ai'},{id:'marketing',name:'Marketing',css:'cat-mkt'},{id:'drhq',name:'DR HQ',css:'cat-drh'},{id:'crm',name:'CRM',css:'cat-crm'}];
const OPS=[{id:'danny',name:'Danny',icon:'👤',css:'danny',hex:'#E8713A'},{id:'openclaw',name:'Openclaw.ai',icon:'🤖',css:'openclaw',hex:'#34D399'},{id:'claude',name:'Claude',icon:'🧠',css:'claude',hex:'#C084FC'},{id:'shary',name:'Shary',icon:'📢',css:'shary',hex:'#F97066'},{id:'john',name:'John',icon:'📊',css:'john',hex:'#FBBF24'}];
/* WIN_DEFS ordered by priority: tasks first, then activity, then comms, then intel, then quick-actions */
const WIN_DEFS=[{id:'taskboard',title:'📋 TaskBoard'},{id:'log',title:'📜 Activity Log'},{id:'wnotes',title:'📝 Notes'},{id:'clawdsugg',title:'🤖 Clawd Suggestions'},{id:'deliverables',title:'📦 Deliverables'},{id:'workflows',title:'⚡ Workflows'},{id:'briefing',title:'📰 Daily Reports'},{id:'smt',title:'💡 Save Me Time'}];
function defaultLayout(){const cw=document.getElementById('winCanvas')?.clientWidth||900;const g=10,half=Math.floor((cw-g)/2);
/* Stacked single-column layout: full-width windows at top, then 2-col pairs, no overlap possible */
const rows=[];let y=0;
/* Row 1: TaskBoard — full width, tallest (most important) */
rows.push({id:'taskboard',x:0,y,w:cw,h:370});y+=370+g;
/* Row 2: Activity Log — full width */
rows.push({id:'log',x:0,y,w:cw,h:260});y+=260+g;
/* Row 3: Notes (left) + Clawd Suggestions (right) — side by side */
const r3h=260;rows.push({id:'wnotes',x:0,y,w:half,h:r3h});rows.push({id:'clawdsugg',x:half+g,y,w:cw-half-g,h:r3h});y+=r3h+g;
/* Row 3b: Deliverables — full width */
rows.push({id:'deliverables',x:0,y,w:cw,h:200});y+=200+g;
/* Row 4: Workflows (left) + Daily Reports (right) — side by side */
const r4h=260;rows.push({id:'workflows',x:0,y,w:half,h:r4h});rows.push({id:'briefing',x:half+g,y,w:cw-half-g,h:r4h});y+=r4h+g;
/* Row 5: Save Me Time — full width, compact */
rows.push({id:'smt',x:0,y,w:cw,h:110});
const layout={};rows.forEach((r,i)=>{layout[r.id]={x:r.x,y:r.y,w:r.w,h:r.h,vis:true,z:i+1}});return layout}

/* 80 COLORS */
const COLOR_DEFS=[
  /* Core UI */
  {v:'--bg',label:'Background',def:'#0B0E14',g:'Core'},{v:'--surface',label:'Surface',def:'#12161F',g:'Core'},{v:'--surface-alt',label:'Surface Alt',def:'#181D28',g:'Core'},
  {v:'--border',label:'Border',def:'#1E2433',g:'Core'},{v:'--border-hover',label:'Border Hover',def:'#2A3145',g:'Core'},
  {v:'--text',label:'Text Primary',def:'#E2E8F0',g:'Core'},{v:'--text-sec',label:'Text Secondary',def:'#8B95A8',g:'Core'},{v:'--text-muted',label:'Text Muted',def:'#4A5568',g:'Core'},
  /* Brand */
  {v:'--accent',label:'Accent',def:'#E8713A',g:'Brand'},{v:'--accent-glow',label:'Accent Glow',def:'rgba(232,113,58,.15)',g:'Brand'},{v:'--accent-dim',label:'Accent Dim',def:'rgba(232,113,58,.06)',g:'Brand'},
  /* Status */
  {v:'--online',label:'Online / Done',def:'#34D399',g:'Status'},{v:'--working',label:'Working',def:'#60A5FA',g:'Status'},{v:'--idle',label:'Idle / Pending',def:'#FBBF24',g:'Status'},{v:'--offline',label:'Offline / Error',def:'#EF4444',g:'Status'},{v:'--review-purple',label:'Review',def:'#C084FC',g:'Status'},
  /* Kanban */
  {v:'--kanban-new',label:'Kanban New',def:'#64748B',g:'Kanban'},{v:'--kanban-progress',label:'Kanban Progress',def:'#60A5FA',g:'Kanban'},{v:'--kanban-review',label:'Kanban Review',def:'#C084FC',g:'Kanban'},{v:'--kanban-done',label:'Kanban Done',def:'#34D399',g:'Kanban'},{v:'--kanban-sched',label:'Kanban Scheduled',def:'#FBBF24',g:'Kanban'},{v:'--kanban-clawd',label:'Kanban Clawd',def:'#EF4444',g:'Kanban'},
  /* Priority */
  {v:'--pri-critical',label:'Critical',def:'#EF4444',g:'Priority'},{v:'--pri-high',label:'High',def:'#F97316',g:'Priority'},{v:'--pri-medium',label:'Medium',def:'#FBBF24',g:'Priority'},{v:'--pri-low',label:'Low',def:'#64748B',g:'Priority'},
  /* Categories */
  {v:'--cat-insurance',label:'Insurance',def:'#F97316',g:'Category'},{v:'--cat-ai',label:'AI',def:'#34D399',g:'Category'},{v:'--cat-marketing',label:'Marketing',def:'#F97066',g:'Category'},{v:'--cat-drhq',label:'DR HQ',def:'#64748B',g:'Category'},{v:'--cat-crm',label:'CRM',def:'#C084FC',g:'Category'},
  /* Operators */
  {v:'--op-danny',label:'Danny',def:'#E8713A',g:'Operator'},{v:'--op-openclaw',label:'Openclaw',def:'#34D399',g:'Operator'},{v:'--op-claude',label:'Claude',def:'#C084FC',g:'Operator'},{v:'--op-shary',label:'Shary',def:'#F97066',g:'Operator'},{v:'--op-john',label:'John',def:'#FBBF24',g:'Operator'},
  /* Extended Palette — Warm */
  {v:'--coral',label:'Coral',def:'#FF6B6B',g:'Warm'},{v:'--salmon',label:'Salmon',def:'#FA8072',g:'Warm'},{v:'--peach',label:'Peach',def:'#FFDAB9',g:'Warm'},{v:'--tangerine',label:'Tangerine',def:'#FF9966',g:'Warm'},{v:'--amber',label:'Amber',def:'#FFBF00',g:'Warm'},{v:'--gold',label:'Gold',def:'#FFD700',g:'Warm'},{v:'--honey',label:'Honey',def:'#EB9605',g:'Warm'},{v:'--rust',label:'Rust',def:'#B7410E',g:'Warm'},{v:'--terracotta',label:'Terracotta',def:'#E2725B',g:'Warm'},{v:'--cinnamon',label:'Cinnamon',def:'#D2691E',g:'Warm'},
  /* Extended Palette — Cool */
  {v:'--ice',label:'Ice Blue',def:'#A5F3FC',g:'Cool'},{v:'--sky',label:'Sky',def:'#38BDF8',g:'Cool'},{v:'--cobalt',label:'Cobalt',def:'#0047AB',g:'Cool'},{v:'--navy',label:'Navy',def:'#1E3A5F',g:'Cool'},{v:'--teal',label:'Teal',def:'#14B8A6',g:'Cool'},{v:'--mint',label:'Mint',def:'#98F5E1',g:'Cool'},{v:'--cyan',label:'Cyan',def:'#22D3EE',g:'Cool'},{v:'--aqua',label:'Aquamarine',def:'#7FFFD4',g:'Cool'},{v:'--lagoon',label:'Lagoon',def:'#1B998B',g:'Cool'},{v:'--steel',label:'Steel Blue',def:'#4682B4',g:'Cool'},
  /* Extended Palette — Vibrant */
  {v:'--magenta',label:'Magenta',def:'#FF00FF',g:'Vibrant'},{v:'--fuschia',label:'Fuschia',def:'#FF77FF',g:'Vibrant'},{v:'--hot-pink',label:'Hot Pink',def:'#FF69B4',g:'Vibrant'},{v:'--rose',label:'Rose',def:'#FB7185',g:'Vibrant'},{v:'--cherry',label:'Cherry',def:'#DE3163',g:'Vibrant'},{v:'--crimson',label:'Crimson',def:'#DC143C',g:'Vibrant'},{v:'--electric',label:'Electric Purple',def:'#BF40BF',g:'Vibrant'},{v:'--violet',label:'Violet',def:'#8B5CF6',g:'Vibrant'},{v:'--indigo',label:'Indigo',def:'#6366F1',g:'Vibrant'},{v:'--plum',label:'Plum',def:'#9F1D9F',g:'Vibrant'},
  /* Extended Palette — Earth & Nature */
  {v:'--forest',label:'Forest',def:'#228B22',g:'Earth'},{v:'--emerald',label:'Emerald',def:'#50C878',g:'Earth'},{v:'--lime',label:'Lime',def:'#84CC16',g:'Earth'},{v:'--sage',label:'Sage',def:'#87AE73',g:'Earth'},{v:'--olive',label:'Olive',def:'#808000',g:'Earth'},{v:'--moss',label:'Moss',def:'#4A7023',g:'Earth'},{v:'--sand',label:'Sand',def:'#C2B280',g:'Earth'},{v:'--clay',label:'Clay',def:'#B66A50',g:'Earth'},{v:'--slate',label:'Slate',def:'#708090',g:'Earth'},{v:'--charcoal',label:'Charcoal',def:'#36454F',g:'Earth'},
  /* Extended Palette — Neon */
  {v:'--neon-green',label:'Neon Green',def:'#39FF14',g:'Neon'},{v:'--neon-blue',label:'Neon Blue',def:'#00F5FF',g:'Neon'},{v:'--neon-pink',label:'Neon Pink',def:'#FF1493',g:'Neon'},{v:'--neon-orange',label:'Neon Orange',def:'#FF5F1F',g:'Neon'},{v:'--neon-yellow',label:'Neon Yellow',def:'#CCFF00',g:'Neon'},{v:'--neon-purple',label:'Neon Purple',def:'#BC13FE',g:'Neon'},
];
const THEMES=[{name:'Default',colors:{'--accent':'#E8713A','--accent-glow':'rgba(232,113,58,.15)','--accent-dim':'rgba(232,113,58,.08)'}},{name:'Midnight',colors:{'--accent':'#7C3AED','--accent-glow':'rgba(124,58,237,.15)','--accent-dim':'rgba(124,58,237,.08)'}},{name:'Forest',colors:{'--accent':'#10B981','--accent-glow':'rgba(16,185,129,.15)','--accent-dim':'rgba(16,185,129,.08)'}},{name:'Crimson',colors:{'--accent':'#EF4444','--accent-glow':'rgba(239,68,68,.15)','--accent-dim':'rgba(239,68,68,.08)'}},{name:'Ocean',colors:{'--accent':'#3B82F6','--accent-glow':'rgba(59,130,246,.15)','--accent-dim':'rgba(59,130,246,.08)'}},{name:'Sunset',colors:{'--accent':'#F59E0B','--accent-glow':'rgba(245,158,11,.15)','--accent-dim':'rgba(245,158,11,.08)'}},{name:'Neon',colors:{'--accent':'#FF00FF','--accent-glow':'rgba(255,0,255,.15)','--accent-dim':'rgba(255,0,255,.08)'}},{name:'Monochrome',colors:{'--accent':'#FFFFFF','--accent-glow':'rgba(255,255,255,.1)','--accent-dim':'rgba(255,255,255,.05)'}},{name:'Rose',colors:{'--accent':'#F43F5E','--accent-glow':'rgba(244,63,94,.15)','--accent-dim':'rgba(244,63,94,.08)'}},{name:'Teal',colors:{'--accent':'#14B8A6','--accent-glow':'rgba(20,184,166,.15)','--accent-dim':'rgba(20,184,166,.08)'}},{name:'Gold',colors:{'--accent':'#D4A017','--accent-glow':'rgba(212,160,23,.15)','--accent-dim':'rgba(212,160,23,.08)'}},{name:'Cyan',colors:{'--accent':'#06B6D4','--accent-glow':'rgba(6,182,212,.15)','--accent-dim':'rgba(6,182,212,.08)'}}];
const FONTS=['Plus Jakarta Sans','Inter','Space Grotesk','JetBrains Mono','system-ui'];

function seed(){const t=new Date(),y=new Date(t-864e5).toISOString(),t3=new Date(t-3*864e5).toISOString(),t4=new Date(t-4*864e5).toISOString(),td=t.toISOString().split('T')[0];const tom=new Date(t.getTime()+864e5);
return{hbInterval:30,winLayout:null,goalLayout:null,customColors:{},activeTheme:'Default',activeFont:'Plus Jakarta Sans',borderRadius:10,compactMode:false,bgMode:'dark',titleSize:18,iconSize:14,sidebarWidth:220,hdrIconOpacity:100,showHdrPills:true,fontScale:100,uiScale:100,sidebarLogo:null,clawdAvatar:null,clawdScale:100,clawdPad:14,showClawdMonitor:true,bgGradient:null,bgImage:null,lastSecurityAudit:null,securityAudits:[],
operators:{danny:{status:'idle',task:null,model:null,subs:[]},openclaw:{status:'idle',task:null,model:'openclaw-v2',subs:[]},claude:{status:'idle',task:null,model:'claude-opus-4-5',subs:[]},shary:{status:'idle',task:null,model:null,subs:[]},john:{status:'idle',task:null,model:null,subs:[]}},
connectedSystems:[
{id:'icloud-cal',name:'iCloud Calendar',icon:'📅',status:'connected',access:'read-write',desc:'Work & Personal calendars via CalDAV',account:'zombiekiller885@icloud.com',url:'https://www.icloud.com/calendar/',lastAction:'Awaiting first Clawd update...',lastActionTime:new Date().toISOString(),stats:{calendars:'—',upcomingEvents:'—',lastSync:'—'}},
{id:'vps-sync',name:'VPS Sync Bridge',icon:'🔄',status:'connected',access:'read-write',desc:'Two-way sync with Clawd @ 76.13.126.53',account:'76.13.126.53:443',url:'https://76.13.126.53:443',lastAction:'Awaiting first sync...',lastActionTime:new Date().toISOString(),stats:{pollInterval:'7s',protocol:'HTTP/JSON',totalUpdates:'—'}},
{id:'openclaw',name:'OpenClaw (Clawd)',icon:'🤖',status:'connected',access:'read-write',desc:'AI agent on VPS — task management, calendar, workflows',account:'openclaw.ai',url:'http://76.13.126.53',lastAction:'Awaiting Clawd heartbeat...',lastActionTime:new Date().toISOString(),stats:{status:'—',currentTask:'—',uptime:'—'}}
],
tasks:[],
logs:[],
notes:[],
documents:[],
workflows:[],
memoryFiles:[],
soulMd:'',
userMd:'',
goals:[]};}

let S,currentPage='overview';
function load(){try{const s=localStorage.getItem(KEY);if(s){S=JSON.parse(s);const d=seed();for(const k of Object.keys(d))if(!(k in S))S[k]=d[k];S.tasks.forEach(t=>{if(t.status==='inbox'||t.status==='notes')t.status='new_task';if(!('scheduledAt' in t))t.scheduledAt=null});if(!S.goals)S.goals=seed().goals;if(!S.customColors)S.customColors={};if(!S.activeFont)S.activeFont='Plus Jakarta Sans';/* v4.1.2 migration: reset to non-overlapping collision-blocked layout */
if(!S._layoutV3){S.winLayout=null;S._layoutV3=true}
/* v4.1.4 migration: add Clawd Suggestions window to layout */
if(!S._layoutV4){S.winLayout=null;S._layoutV4=true}
/* v4.1.3 migration: enrich connectedSystems with detail fields */
if(S.connectedSystems&&S.connectedSystems[0]&&!S.connectedSystems[0].account){S.connectedSystems=seed().connectedSystems}
/* v4.2 migration: replace fake systems with real connections */
if(!S._sysV2){S.connectedSystems=seed().connectedSystems;S._sysV2=true}
save()}else S=seed()}catch(e){S=seed()}applyCustomColors();applyFont();applyUISettings()}
let _lastServerHash='';
function loadFromServer(silent){const su=localStorage.getItem('ff_sync_url')||'https://76.13.126.53:443';fetch(su+'/api/cc-state').then(r=>r.json()).then(d=>{if(d.state){const h=JSON.stringify(d.state).length+'_'+JSON.stringify(d.state.tasks?.length)+'_'+JSON.stringify(d.state.documents?.length)+'_'+JSON.stringify(d.state.notes?.length);if(silent&&h===_lastServerHash)return;_lastServerHash=h;/* Preserve ALL per-device settings before overwrite */const _local={winLayout:S.winLayout,goalLayout:S.goalLayout,customColors:S.customColors,activeFont:S.activeFont,activeTheme:S.activeTheme,fontScale:S.fontScale,uiScale:S.uiScale,borderRadius:S.borderRadius,compactMode:S.compactMode,bgMode:S.bgMode,bgGradient:S.bgGradient,bgImage:S.bgImage,titleSize:S.titleSize,iconSize:S.iconSize,sidebarWidth:S.sidebarWidth,hdrIconOpacity:S.hdrIconOpacity,showHdrPills:S.showHdrPills,clawdScale:S.clawdScale,clawdPad:S.clawdPad,showClawdMonitor:S.showClawdMonitor,sidebarLogo:S.sidebarLogo,clawdAvatar:S.clawdAvatar,securityAudits:S.securityAudits,lastSecurityAudit:S.lastSecurityAudit,_layoutV3:S._layoutV3,_layoutV4:S._layoutV4,_sysV2:S._sysV2};S=d.state;const sd=seed();for(const k of Object.keys(sd))if(!(k in S))S[k]=sd[k];/* Restore per-device settings */for(const[k,v]of Object.entries(_local)){if(v!==undefined&&v!==null)S[k]=v}localStorage.setItem(KEY,JSON.stringify(S));applyCustomColors();applyFont();applyUISettings();if(renders[currentPage])renders[currentPage]();if(!silent)console.log('[SYNC] Loaded state from server')}}).catch(()=>{if(!silent)console.log('[SYNC] Server state not available, using local')})}
setInterval(()=>loadFromServer(true),10000);
setInterval(()=>location.reload(),300000);
function save(){try{localStorage.setItem(KEY,JSON.stringify(S))}catch(e){}pushStateToServer()}
let _pushDebounce=null;
function pushStateToServer(){clearTimeout(_pushDebounce);_pushDebounce=setTimeout(()=>{const sk=localStorage.getItem('ff_sync_key')||'';const su=localStorage.getItem('ff_sync_url')||'https://76.13.126.53:443';const h={'Content-Type':'application/json'};if(sk)h['Authorization']='Bearer '+sk;fetch(su+'/api/cc-state',{method:'POST',headers:h,body:JSON.stringify({state:S})}).catch(()=>{})},1000)}
function addLog(type,op,txt,sub='',ico='system'){S.logs.push({id:gid(),ts:ts(),type,op,txt,sub,ico});save()}

/* === RENDER MAP (defined early so navTo works) === */
const renders={overview:renderOverview,notes:renderNotesPage,taskboard:renderTaskboard,workflows:renderWorkflows,briefing:renderBriefingPage,analytics:renderAnalytics,goals:renderGoals,documents:renderDocuments,memory:renderMemory,radar:renderRadar,systems:renderSystems,security:renderSecurity,aesthetics:renderAesthetics,settings:renderSettings,instructions:renderInstructions};

/* NAV — event delegation on sidebar for reliability */
function navTo(pg){document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));document.querySelector(`[data-page="${pg}"]`)?.classList.add('active');document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.getElementById('pg-'+pg)?.classList.add('active');currentPage=pg;if(renders[pg])renders[pg]()}
document.getElementById('sideNav').addEventListener('click',e=>{const ni=e.target.closest('.nav-item');if(ni&&ni.dataset.page)navTo(ni.dataset.page)});

/* CLOCK */
function updateClock(){const now=new Date();document.getElementById('clock').textContent=now.toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:true,timeZone:'America/Chicago'});const h=now.getHours(),g=h<12?'Good morning':h<17?'Good afternoon':'Good evening';document.getElementById('greeting').textContent=g+', Danny 👋';document.getElementById('dateStr').textContent=now.toLocaleDateString('en-US',{weekday:'long',month:'short',day:'numeric',year:'numeric'})+' — CST'}setInterval(updateClock,1000);updateClock();
let hbSec;function resetHb(){hbSec=S.hbInterval*60}function hbTick(){hbSec--;if(hbSec<=0){resetHb();fireHeartbeat()}document.getElementById('hbTimer').textContent=String(Math.floor(hbSec/60)).padStart(2,'0')+':'+String(hbSec%60).padStart(2,'0')}
function fireHeartbeat(){addLog('scheduled','system','Heartbeat','','system');S.notes.filter(n=>!n.seen).forEach(n=>{n.seen=true;n.seenBy='claude';n.seenAt=ts();n.reply='Processing.'});save();if(currentPage==='overview')renderOverview()}
function logPrompt(){const m=prompt('Log entry:');if(m){addLog('task','danny',m,'','business');if(currentPage==='overview')renderOverview()}}

/* === LIVE AI ICON — header === */
function updateAIWidget(){/* Claude status now rendered in sidebar agent tracker */renderAgentTracker()}

/* === LIVE AGENT TRACKER === */
const AT_SVG={
idle:`<svg viewBox="0 0 24 24"><circle cx="7" cy="10" r="2.5"/><rect x="3" y="13" width="18" height="3" rx="1.5"/><path d="M9.5 11.5c.5-.3 1.2-.5 2-.5h3c1 0 1.8.4 2.3 1" fill="none" stroke="currentColor" stroke-width="1.2"/><rect x="8" y="12" width="8" height="2.5" rx="1"/><text x="14" y="8" font-size="5" font-weight="bold" fill="currentColor">z</text><text x="16" y="6" font-size="4" font-weight="bold" fill="currentColor">z</text><text x="17.5" y="4.5" font-size="3" font-weight="bold" fill="currentColor">z</text></svg>`,
thinking:`<svg viewBox="0 0 24 24"><circle cx="12" cy="5" r="2.5"/><path d="M10 7.5v2.5l-1.5 3.5v4h1.5l.5 2h3l.5-2h1.5v-4L14 10V7.5" fill="currentColor"/><line x1="8" y1="19.5" x2="10" y2="19.5" stroke="currentColor" stroke-width="1"/><line x1="14" y1="19.5" x2="16" y2="19.5" stroke="currentColor" stroke-width="1"/><path d="M15 4c.5-.8 1.5-1.2 2.5-1 .5.1.8.5.8.8 0 .5-.5.8-1 .9" fill="none" stroke="currentColor" stroke-width=".8"/><circle cx="16.5" cy="2.5" r=".5" fill="currentColor"/><circle cx="17.5" cy="1.5" r=".4" fill="currentColor"/></svg>`,
working:`<svg viewBox="0 0 24 24"><circle cx="14" cy="4" r="2.5"/><path d="M11 7l-4 5.5h3l-1 5.5 6-7h-3.5l2-4" fill="currentColor"/><path d="M16 13l2.5 4.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/><path d="M8.5 12.5l-3 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/><path d="M13 17.5l1 4" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/><path d="M9 11l-2 1" stroke="currentColor" stroke-width="1" stroke-linecap="round"/></svg>`
};
function renderAgentTracker(){const el=document.getElementById('agentTracker');if(!el)return;
const op=S.operators.claude;if(!op)return;
const st=op.status==='working'||op.status==='active'?'working':op.status==='thinking'?'thinking':'idle';
const stLabel={working:'🟢 Working',thinking:'🟡 Thinking…',idle:'🔴 Idle'}[st];
const activeSubs=(op.subs||[]).filter(s=>s.status==='active');
let h=`<div class="at-card">`;
h+=`<div class="at-top">`;
h+=`<div class="at-icon-wrap"><div class="at-ring st-${st}"></div><div class="at-st-ico st-${st}">${AT_SVG[st]}</div></div>`;
h+=`<div class="at-info"><div class="at-name" style="color:var(--review-purple)">🧠 Clawd</div>`;
h+=`<div class="at-status st-${st}"><span class="at-sdot"></span>${stLabel}</div>`;
h+=`</div></div>`;
if(op.task)h+=`<div class="at-task">📌 ${op.task}</div>`;
else h+=`<div class="at-task" style="opacity:.4">Awaiting instructions…</div>`;
if(activeSubs.length){h+=`<div class="at-subs">`;activeSubs.forEach(s=>{h+=`<div class="at-sub"><span class="at-sub-dot active"></span><span class="at-sub-name">⚡ ${s.name}</span>${s.job?`<span style="font-size:9px;color:var(--text-muted);margin-left:4px">— ${s.job}</span>`:''}</div>`});h+=`</div>`}
h+=`</div>`;
el.innerHTML=h}

/* === WINDOWS === */
function getLayout(){if(!S.winLayout)S.winLayout=defaultLayout();return S.winLayout}
function buildTabBar(){const L=getLayout();let h='';WIN_DEFS.forEach(d=>{const vis=L[d.id]?.vis!==false;h+=`<button class="tab-btn ${vis?'on':'off'}" onclick="toggleWinVis('${d.id}')"><span class="tdot"></span>${d.title}</button>`});h+=`<button class="tab-reset" onclick="resetLayout()">↺ Reset</button>`;document.getElementById('tabBar').innerHTML=h}
function toggleWinVis(id){const L=getLayout();L[id].vis=!L[id].vis;document.getElementById('win-'+id)?.classList.toggle('hidden-win',!L[id].vis);save();buildTabBar()}
function resetLayout(){S.winLayout=null;save();renderOverview()}
function createShells(){const c=document.getElementById('winCanvas');c.innerHTML='';WIN_DEFS.forEach(d=>{const w=document.createElement('div');w.id='win-'+d.id;w.className='win';w.innerHTML=`<div class="win-bar" data-wid="${d.id}"><span class="win-grip">⋮⋮</span><span class="win-title">${d.title}</span><div class="win-ctrl"><button class="win-btn close" onclick="toggleWinVis('${d.id}')">✕</button></div></div><div class="win-body" id="wb-${d.id}"></div><div class="win-rs" data-wid="${d.id}" data-mode="corner"></div><div class="win-rs-r" data-wid="${d.id}" data-mode="right"></div><div class="win-rs-b" data-wid="${d.id}" data-mode="bottom"></div>`;c.appendChild(w)})}
function applyPositions(){const L=getLayout();const cw=canvasW();let mx=0;WIN_DEFS.forEach(d=>{const el=document.getElementById('win-'+d.id);if(!el)return;const p=L[d.id];if(!p)return;/* Ensure within bounds */
p.w=Math.max(220,Math.min(p.w,cw));p.x=Math.max(0,Math.min(p.x,cw-p.w));p.y=Math.max(0,p.y);p.h=Math.max(80,p.h);el.style.cssText=`left:${p.x}px;top:${p.y}px;width:${p.w}px;height:${p.h}px;z-index:${p.z||1};position:absolute`;el.classList.toggle('hidden-win',p.vis===false);if(p.vis!==false)mx=Math.max(mx,p.y+p.h)});document.getElementById('winCanvas').style.minHeight=Math.max(800,mx+40)+'px'}
let _drag=null,_resize=null;
function canvasW(){const c=document.getElementById('winCanvas');return c?c.clientWidth:900}
/* Check if rect r overlaps any visible window except 'skipId' */
function hitsOther(r,skipId){const L=getLayout();for(const d of WIN_DEFS){if(d.id===skipId)continue;const p=L[d.id];if(!p||p.vis===false)continue;if(r.x<p.x+p.w&&r.x+r.w>p.x&&r.y<p.y+p.h&&r.y+r.h>p.y)return true}return false}
/* Clamp rect inside canvas */
function clampRect(r){const cw=canvasW();r.x=Math.max(0,Math.min(r.x,cw-r.w));r.y=Math.max(0,r.y);r.w=Math.max(220,Math.min(r.w,cw-r.x));r.h=Math.max(80,r.h)}
function dragStart(e,id){if(e.button!==0)return;e.preventDefault();const p=getLayout()[id];_drag={id,smx:e.pageX,smy:e.pageY,sx:p.x,sy:p.y,lastGoodX:p.x,lastGoodY:p.y};document.getElementById('win-'+id).classList.add('dragging')}
function resizeStart(e,id,mode){if(e.button!==0)return;e.preventDefault();e.stopPropagation();const p=getLayout()[id];_resize={id,mode,sx:e.pageX,sy:e.pageY,sw:p.w,sh:p.h,lastGoodW:p.w,lastGoodH:p.h}}
document.addEventListener('mousemove',e=>{
if(_drag){const L=getLayout();const p=L[_drag.id];const nx=_drag.sx+(e.pageX-_drag.smx);const ny=_drag.sy+(e.pageY-_drag.smy);const cand={x:nx,y:ny,w:p.w,h:p.h};clampRect(cand);/* Only move if the new position doesn't overlap anything */
if(!hitsOther(cand,_drag.id)){p.x=cand.x;p.y=cand.y;_drag.lastGoodX=cand.x;_drag.lastGoodY=cand.y}else{/* Try moving on just one axis at a time */
const candX={x:cand.x,y:_drag.lastGoodY,w:p.w,h:p.h};clampRect(candX);if(!hitsOther(candX,_drag.id)){p.x=candX.x;p.y=candX.y;_drag.lastGoodX=candX.x;_drag.lastGoodY=candX.y}else{const candY={x:_drag.lastGoodX,y:cand.y,w:p.w,h:p.h};clampRect(candY);if(!hitsOther(candY,_drag.id)){p.x=candY.x;p.y=candY.y;_drag.lastGoodX=candY.x;_drag.lastGoodY=candY.y}}}
const el=document.getElementById('win-'+_drag.id);el.style.left=p.x+'px';el.style.top=p.y+'px'}
if(_resize){const L=getLayout();const p=L[_resize.id];let nw=_resize.mode!=='bottom'?Math.max(220,_resize.sw+(e.pageX-_resize.sx)):p.w;let nh=_resize.mode!=='right'?Math.max(80,_resize.sh+(e.pageY-_resize.sy)):p.h;const cw=canvasW();nw=Math.min(nw,cw-p.x);const cand={x:p.x,y:p.y,w:nw,h:nh};if(!hitsOther(cand,_resize.id)){p.w=nw;p.h=nh;_resize.lastGoodW=nw;_resize.lastGoodH=nh}
const el=document.getElementById('win-'+_resize.id);el.style.width=p.w+'px';el.style.height=p.h+'px'}});
document.addEventListener('mouseup',()=>{if(_drag){document.getElementById('win-'+_drag.id)?.classList.remove('dragging');_drag=null;save();updateCanvasH()}if(_resize){_resize=null;save();updateCanvasH()}});
function updateCanvasH(){const L=getLayout();let mx=0;WIN_DEFS.forEach(d=>{const p=L[d.id];if(p?.vis!==false)mx=Math.max(mx,p.y+p.h)});document.getElementById('winCanvas').style.minHeight=Math.max(800,mx+40)+'px'}
requestAnimationFrame(()=>{document.getElementById('winCanvas')?.addEventListener('mousedown',e=>{const bar=e.target.closest('.win-bar');if(bar&&!e.target.closest('.win-btn')){dragStart(e,bar.dataset.wid);return}const rs=e.target.closest('[data-mode]');if(rs)resizeStart(e,rs.dataset.wid,rs.dataset.mode)})});
/* On browser resize, shrink windows to fit */
window.addEventListener('resize',()=>{const L=getLayout();const cw=canvasW();WIN_DEFS.forEach(d=>{const p=L[d.id];if(!p)return;p.w=Math.min(p.w,cw);p.x=Math.max(0,Math.min(p.x,cw-p.w))});applyPositions();save()});

/* === OVERVIEW === */
function renderOverview(){buildTabBar();updateAIWidget();const op=S.operators,ip=S.tasks.filter(t=>t.status==='in_progress');const subs=Object.values(op).reduce((a,o)=>(o.subs||[]).filter(s=>s.status==='active').length+a,0);const conn=S.connectedSystems.filter(s=>s.status==='connected').length;
let lh='<div class="scard-grid">';lh+=`<div class="scard c-status"><div class="sc-label">AI Status</div><div class="sc-val" style="color:var(--working)"><span class="work-dot" style="background:var(--working)"></span>Working</div><div class="sc-det">${ip.length} in progress</div></div>`;lh+=`<div class="scard c-task"><div class="sc-label">Current Task</div><div class="sc-val" style="font-size:13px">${ip[0]?.title||'Idle'}</div><div class="sc-det">${ip[0]?.desc?.substring(0,40)||'—'}</div></div>`;lh+=`<div class="scard c-agents"><div class="sc-label">Sub-Agents</div><div class="sc-val" style="color:var(--review-purple)">${subs} Active</div><div class="sc-det">${Object.values(op).flatMap(o=>(o.subs||[]).filter(s=>s.status==='active')).map(s=>s.name).join(' · ')||'None'}</div></div>`;lh+=`<div class="scard c-health"><div class="sc-label">Health</div><div class="sc-val" style="color:var(--online)">All Clear</div><div class="sc-det">${conn}/${S.connectedSystems.length} systems</div></div></div>`;
lh+='<div class="op-strip">';OPS.forEach(o=>{const st=op[o.id]||{};const dot=st.status==='working'||st.status==='active'?'var(--online)':st.status==='thinking'?'var(--idle)':'var(--text-muted)';lh+=`<div class="op-card"><div class="op-av" style="background:${o.hex}">${o.icon}</div><div style="flex:1;min-width:0"><div class="op-nm"><span class="op-dot" style="background:${dot}"></span>${o.name}</div><div class="op-task">${st.task||'Idle'}</div></div></div>`});lh+='</div>';
document.getElementById('ovLocked').innerHTML=lh;createShells();applyPositions();WIN_DEFS.forEach(d=>{if(getLayout()[d.id]?.vis!==false)fillWin(d.id)});updateBadge();updateMemChips()}
function fillWin(id){const el=document.getElementById('wb-'+id);if(!el)return;switch(id){case'taskboard':el.innerHTML=rKB();break;case'log':el.innerHTML=rLog();break;case'wnotes':el.innerHTML=rNotes();break;case'clawdsugg':el.innerHTML=rClawdSugg();break;case'deliverables':el.innerHTML=rDel();break;case'workflows':el.innerHTML=rWF();break;case'briefing':el.innerHTML=rBrief();break;case'smt':el.innerHTML=rSMT();break}}
function rKB(){return`<div class="kanban">${COLS.map(col=>{const all=S.tasks.filter(t=>t.status===col.id),ct=all.slice(0,6),extra=all.length-6;return`<div class="kb-col"><div class="kb-col-hdr ${col.css}"><span class="ct">${col.name}</span><span class="cc">${all.length}</span></div>${col.id==='new_task'?`<input class="add-inp" placeholder="+ New task..." onkeydown="if(event.key==='Enter'&&this.value.trim()){openModal(this.value);this.value=''}"/>`:''}<div class="kb-cards" data-col="${col.id}" ondragover="cDOver(event)" ondragleave="cDLeave(event)" ondrop="cDDrop(event)">${ct.map(renderCard).join('')}${extra>0?`<div style="text-align:center;font-size:10px;color:var(--text-muted);padding:4px;cursor:pointer" onclick="navTo('taskboard')">+${extra} more</div>`:''}</div></div>`}).join('')}</div>`}
function rLog(){const backendTypes=['system','automation','api','webscrape','cron','backend','sync'];const frontendTypes=['business','success','comms'];const securityTypes=['security','alert'];const sorted=[...S.logs].sort((a,b)=>new Date(b.ts)-new Date(a.ts));const frontend=sorted.filter(l=>frontendTypes.includes(l.ico)||frontendTypes.includes(l.type));const backend=sorted.filter(l=>backendTypes.includes(l.ico)||backendTypes.includes(l.type));const security=sorted.filter(l=>securityTypes.includes(l.ico)||securityTypes.includes(l.type));const actions=sorted.filter(l=>!frontendTypes.includes(l.ico)&&!frontendTypes.includes(l.type)&&!backendTypes.includes(l.ico)&&!backendTypes.includes(l.type)&&!securityTypes.includes(l.ico)&&!securityTypes.includes(l.type));const renderEntry=l=>`<div class="le" onclick="this.classList.toggle('exp')"><span class="le-ts">${fmt(l.ts)}</span><div class="le-ico ${l.ico}"></div><div class="le-c"><span class="le-op ${l.op}">${l.op==='system'?'System':(OPS.find(o=>o.id===l.op)?.name||l.op)}</span> <span class="le-txt">${l.txt}</span><div class="le-sub">${l.sub}</div></div></div>`;const colStyle='overflow-y:auto;overflow-x:hidden;max-height:100%;scrollbar-width:thin;scrollbar-color:var(--border) transparent';const hdrStyle='font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px;padding:0 4px;position:sticky;top:0;background:var(--surface);z-index:1;padding-top:4px;padding-bottom:4px';const countBadge=(n)=>`<span style="font-size:9px;font-weight:400;color:var(--text-muted);margin-left:4px">(${n})</span>`;const emptyMsg=(t)=>`<div style="text-align:center;font-size:11px;color:var(--text-muted);padding:12px">No ${t} logs yet</div>`;return`<div style="display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:8px;padding:4px 8px;height:100%;min-height:0"><div style="${colStyle}"><div style="${hdrStyle};color:var(--idle)">📋 Actions${countBadge(actions.length)}</div>${actions.length?actions.map(renderEntry).join(''):emptyMsg('action')}</div><div style="${colStyle}"><div style="${hdrStyle};color:var(--online)">🖥️ Frontend${countBadge(frontend.length)}</div>${frontend.length?frontend.map(renderEntry).join(''):emptyMsg('frontend')}</div><div style="${colStyle}"><div style="${hdrStyle};color:var(--review-purple)">⚙️ Backend${countBadge(backend.length)}</div>${backend.length?backend.map(renderEntry).join(''):emptyMsg('backend')}</div><div style="${colStyle}"><div style="${hdrStyle};color:var(--offline)">🛡️ Security${countBadge(security.length)}</div>${security.length?security.map(renderEntry).join(''):emptyMsg('security')}</div></div>`}
function rNotes(){let h=`<div style="padding:10px 12px"><div class="note-input-area"><textarea class="note-input" id="ovNI" placeholder="Note for the AI..." rows="2"></textarea><button class="note-send" onclick="sendNote('ovNI')">Send</button></div>`;[...S.notes].reverse().slice(0,5).forEach(n=>{h+=`<div class="ni"><button class="ni-del" onclick="deleteNote('${n.id}')" title="Delete note">🗑️</button><div class="ni-from danny">Danny</div><div class="ni-txt">${n.content}</div><div class="ni-time">${fmt(n.createdAt)} ${n.seen?'<span class="ni-st seen">✅</span>':'<span class="ni-st pend">⏳</span>'}</div></div>`;if(n.reply)h+=`<div class="ni"><div class="ni-from ai">AI</div><div class="ni-txt">${n.reply}</div></div>`});return h+'</div>'}
function rClawdSugg(){const suggs=S.tasks.filter(t=>t.status==='clawd_suggestion');let h='<div style="padding:10px 12px">';if(suggs.length===0){h+='<div style="text-align:center;padding:30px 10px;color:var(--text-muted);font-size:12px"><div style="font-size:24px;margin-bottom:8px">🤖</div>No suggestions yet.<br>Clawd will push tasks here.</div>'}suggs.slice(0,8).forEach(t=>{const pri={critical:'pri-c',high:'pri-h',medium:'pri-m',low:'pri-l'}[t.priority];const pn={critical:'Critical',high:'High',medium:'Medium',low:'Low'}[t.priority];h+=`<div class="ni" style="cursor:pointer" onclick="navTo('taskboard')"><div class="ni-from ai" style="color:var(--kanban-clawd)">🤖 Clawd</div><div class="ni-txt">${t.title}</div><div style="display:flex;gap:6px;align-items:center;margin-top:4px"><span class="tc-pri ${pri}" style="font-size:9px">${pn}</span><span style="font-size:9px;color:var(--text-muted)">${rel(t.createdAt)}</span></div></div>`});if(suggs.length>8)h+=`<div style="text-align:center;font-size:10px;color:var(--text-muted);padding:6px;cursor:pointer" onclick="navTo('taskboard')">+${suggs.length-8} more</div>`;return h+'</div>'}
function rDel(){let h='<div style="padding:10px 12px">';[...S.documents].sort((a,b)=>new Date(b.at)-new Date(a.at)).slice(0,5).forEach(d=>{h+=`<div class="del-item" onclick="navTo('documents')"><div class="del-ico report">${{report:'📊',deliverable:'📋',template:'📝'}[d.type]||'📄'}</div><div><div class="del-nm">${d.title}</div><div class="del-mt">${fmtD(d.at)}</div></div></div>`});return h+'</div>'}
function rWF(){let h='<div style="padding:10px 12px">';S.workflows.filter(w=>w.active).slice(0,6).forEach(w=>{const done=w.lastRun&&new Date(w.lastRun).toDateString()===new Date().toDateString();const cls=w.freq.includes('Continuous')?'act':w.freq.includes('Every')?'loop':(done?'comp':'pend');const txt=w.freq.includes('Continuous')?'● Active':w.freq.includes('Every')?'↻ Loop':(done?'✓ Done':'Pending');h+=`<div class="wf-item"><div class="wf-time">${w.freq.replace('Daily @ ','').replace('Every ','')}</div><div><div class="wf-nm">${w.name}</div></div><div class="wf-st ${cls}">${txt}</div></div>`});return h+'</div>'}
function rBrief(){const briefs=S.documents.filter(d=>d.title&&(d.title.includes('Morning Brief')||d.title.includes('MORNING BRIEF')||d.tags&&d.tags.includes('morning-brief'))).sort((a,b)=>new Date(b.at)-new Date(a.at));if(!briefs.length)return`<div style="padding:10px 12px;text-align:center;color:var(--text-muted);font-size:12px"><div style="font-size:24px;margin-bottom:8px">📰</div>No briefs yet.<br>Clawd delivers daily at 9am CT.</div>`;const latest=briefs[0];return`<div style="padding:10px 12px"><div style="font-size:10px;font-weight:700;color:var(--accent);margin-bottom:4px">${fmtDT(latest.at)}</div><div style="font-size:11px;line-height:1.5;color:var(--text-sec);max-height:200px;overflow-y:auto">${renderMd(latest.content.substring(0,600))}</div><div style="margin-top:6px;text-align:center"><button class="qa-btn" onclick="navTo('briefing')" style="font-size:10px">View Full Brief →</button></div></div>`}
function rSMT(){if(!S.smtItems)S.smtItems=[{i:'📧',n:'Email Triage',d:'AI drafts'},{i:'📊',n:'GHL Review',d:'Pipelines'},{i:'🔍',n:'Research',d:'AI gathers'},{i:'📋',n:'Reports',d:'Auto-gen'},{i:'📅',n:'Calendar',d:'Optimize'},{i:'💌',n:'Birthdays',d:'Outreach'}];let h='<div class="smt-grid">';S.smtItems.forEach((s,idx)=>{h+=`<div class="smt-card" onclick="smtAction('${s.n}')"><button class="smt-del" onclick="event.stopPropagation();smtDel(${idx})" title="Remove">🗑️</button><div class="smt-ico">${s.i}</div><div class="smt-nm">${s.n}</div><div class="smt-d">${s.d}</div></div>`});h+=`<div class="smt-add" onclick="smtGenerate()"><div class="smt-add-ico">✨</div><div class="smt-add-txt">AI Suggest</div></div>`;return h+'</div>'}
function smtDel(idx){if(!S.smtItems)return;S.smtItems.splice(idx,1);save();fillWin('smt')}
function smtGenerate(){const su=localStorage.getItem('ff_sync_url')||'https://76.13.126.53:443';const sk=localStorage.getItem('ff_sync_key')||'';const h={'Content-Type':'application/json'};if(sk)h['Authorization']='Bearer '+sk;fetch(su+'/api/push',{method:'POST',headers:h,body:JSON.stringify({type:'ai_request',action:'smt_generate',data:{currentItems:S.smtItems,tasks:S.tasks.map(t=>({title:t.title,status:t.status,category:t.category}))},source:'cc'})}).then(()=>{addLog('task','danny','Requested AI automation suggestions','','business');save();if(currentPage==='overview')fillWin('smt')}).catch(()=>{})}
function smtAction(n){S.tasks.unshift({id:gid(),title:'Set up: '+n,desc:'',priority:'medium',status:'new_task',category:'ai',assignee:'claude',createdAt:ts(),deadline:null,completedAt:null,scheduledAt:null});addLog('task','danny','Created: '+n,'','business');save();renderOverview()}

/* === CARD + DANNY-ONLY DELETE + DND === */
function renderCard(t){const op=OPS.find(o=>o.id===t.assignee)||OPS[0],cat=CATS.find(c=>c.id===t.category);const pc={critical:'pri-c',high:'pri-h',medium:'pri-m',low:'pri-l'}[t.priority];const pl={critical:'Critical',high:'High',medium:'Medium',low:'Low'}[t.priority];const done=t.status==='done';let extra='';if(t.status==='scheduled'&&t.scheduledAt)extra=`<div class="tc-sched">🕐 ${new Date(t.scheduledAt).toLocaleString('en-US',{month:'short',day:'numeric',hour:'numeric',minute:'2-digit',hour12:true})}</div>`;return`<div class="tc ${done?'comp':''}" data-tid="${t.id}" data-p="${t.priority}" draggable="true" ondragstart="cDStart(event)" onclick="if(!event.target.closest('.tc-del'))openTaskDetail('${t.id}')"><button class="tc-del" onclick="event.stopPropagation();deleteTask('${t.id}')" title="Delete (Danny only)">🗑️</button><div class="tc-top"><span class="tc-pri ${pc}">${pl}</span>${cat?`<span class="tc-cat ${cat.css}">${cat.name}</span>`:''}</div><div class="tc-title">${t.title}</div>${t.desc?`<div class="tc-desc">${t.desc}</div>`:''}${extra}<div class="tc-meta"><span class="tc-who"><span class="tc-av-sm" style="background:${op.hex}">${op.icon}</span>${op.name}</span><span class="tc-time">${t.deadline?fmtD(t.deadline):rel(t.createdAt)}</span></div></div>`}
function openTaskDetail(id){const t=S.tasks.find(x=>x.id===id);if(!t)return;const op=OPS.find(o=>o.id===t.assignee)||OPS[0];const cat=CATS.find(c=>c.id===t.category);const col=ALL_COLS.find(c=>c.id===t.status);const pc={critical:'🔴 Critical',high:'🟠 High',medium:'🟡 Medium',low:'⚪ Low'};const statusColors={new_task:'var(--kanban-new)',in_progress:'var(--kanban-prog)',review:'var(--kanban-rev)',done:'var(--kanban-done)',scheduled:'var(--kanban-sched,#60A5FA)',clawd_suggestion:'var(--kanban-clawd,#A78BFA)'};const sc=statusColors[t.status]||'var(--accent)';
const h=`<div class="td-hdr"><div class="td-hdr-left"><div class="td-title-row"><span class="td-status-badge" style="background:${sc}22;color:${sc};border:1px solid ${sc}44">${col?col.name:t.status}</span></div><div class="td-title" style="margin-top:8px">${t.title}</div></div><button class="td-close" onclick="closeTaskDetail()">✕</button></div>
<div class="td-body"><div class="td-grid">
<div class="td-field"><span class="td-label">Status</span><div class="td-val"><select id="tdStatus" onchange="tdChanged=true">${ALL_COLS.map(c=>`<option value="${c.id}"${c.id===t.status?' selected':''}>${c.name}</option>`).join('')}</select></div></div>
<div class="td-field"><span class="td-label">Priority</span><div class="td-val"><select id="tdPri" onchange="tdChanged=true"><option value="critical"${t.priority==='critical'?' selected':''}>🔴 Critical</option><option value="high"${t.priority==='high'?' selected':''}>🟠 High</option><option value="medium"${t.priority==='medium'?' selected':''}>🟡 Medium</option><option value="low"${t.priority==='low'?' selected':''}>⚪ Low</option></select></div></div>
<div class="td-field"><span class="td-label">Assignee</span><div class="td-val"><select id="tdAssign" onchange="tdChanged=true">${OPS.map(o=>`<option value="${o.id}"${o.id===t.assignee?' selected':''}>${o.icon} ${o.name}</option>`).join('')}</select></div></div>
<div class="td-field"><span class="td-label">Category</span><div class="td-val"><select id="tdCat" onchange="tdChanged=true">${CATS.map(c=>`<option value="${c.id}"${c.id===t.category?' selected':''}>${c.name}</option>`).join('')}</select></div></div>
<div class="td-field"><span class="td-label">Scheduled Start</span><div class="td-val"><input type="text" id="tdSched" value="${t.scheduledAt||''}" placeholder="e.g. tomorrow 9am, Monday at 2pm" oninput="tdChanged=true"/></div></div>
<div class="td-field"><span class="td-label">Deadline</span><div class="td-val"><input type="text" id="tdDead" value="${t.deadline||''}" placeholder="e.g. Friday, next week, March 15" oninput="tdChanged=true"/></div></div>
<div class="td-field full"><span class="td-label">Description</span><div class="td-val"><textarea id="tdDesc" oninput="tdChanged=true">${t.desc||''}</textarea></div></div>
<div class="td-field full"><span class="td-label">Expectations</span><div class="td-val"><textarea id="tdExpect" oninput="tdChanged=true" placeholder="What does success look like for this task?">${t.expectations||''}</textarea></div></div>
<div class="td-field full"><span class="td-label">Suggestions / Notes</span><div class="td-val"><textarea id="tdSugg" oninput="tdChanged=true" placeholder="Ideas, blockers, or recommendations...">${t.suggestions||''}</textarea></div></div>
</div></div>
<div class="td-footer"><div class="td-timestamps"><span>Created: ${t.createdAt?fmtDT(t.createdAt):'—'}</span>${t.completedAt?`<span>Completed: ${fmtDT(t.completedAt)}</span>`:''}${t.scheduledAt?`<span>Scheduled: ${fmtDT(t.scheduledAt)}</span>`:''}</div><button class="td-save" onclick="saveTaskDetail('${t.id}')">Save Changes</button></div>`;
document.getElementById('taskDetailInner').innerHTML=h;document.getElementById('taskDetailModal').classList.add('show');tdChanged=false}
let tdChanged=false;
function closeTaskDetail(){if(tdChanged&&!confirm('Unsaved changes — discard?'))return;document.getElementById('taskDetailModal').classList.remove('show');tdChanged=false}
function saveTaskDetail(id){const t=S.tasks.find(x=>x.id===id);if(!t)return;const oldStatus=t.status;t.status=document.getElementById('tdStatus').value;t.priority=document.getElementById('tdPri').value;t.assignee=document.getElementById('tdAssign').value;t.category=document.getElementById('tdCat').value;const svRaw=document.getElementById('tdSched').value.trim();const svDate=svRaw?parseFreeDate(svRaw):null;t.scheduledAt=svDate?svDate.toISOString():svRaw||null;const dlRaw=document.getElementById('tdDead').value.trim();const dlDate=dlRaw?parseFreeDate(dlRaw):null;t.deadline=dlDate?dlDate.toISOString().split('T')[0]:dlRaw||null;t.desc=document.getElementById('tdDesc').value.trim();t.expectations=document.getElementById('tdExpect').value.trim();t.suggestions=document.getElementById('tdSugg').value.trim();if(t.status==='done'&&!t.completedAt)t.completedAt=ts();if(t.status!=='done')t.completedAt=null;if(oldStatus!==t.status)addLog('task',t.assignee||'danny','Moved "'+t.title+'" → '+(ALL_COLS.find(c=>c.id===t.status)?.name||t.status),'','business');addLog('task','danny','Updated: "'+t.title+'"','','business');save();tdChanged=false;document.getElementById('taskDetailModal').classList.remove('show');if(renders[currentPage])renders[currentPage]();if(t.expectations||t.suggestions){if(typeof push==='undefined'){var h2={'Content-Type':'application/json'};var sk=localStorage.getItem('ff_sync_key')||'';var su=localStorage.getItem('ff_sync_url')||'https://76.13.126.53:443';if(sk)h2['Authorization']='Bearer '+sk;fetch(su+'/api/push',{method:'POST',headers:h2,body:JSON.stringify({type:'ai_request',action:'inspect',data:{taskId:t.id,title:t.title,status:t.status,priority:t.priority,assignee:t.assignee,category:t.category,desc:t.desc,expectations:t.expectations,suggestions:t.suggestions,deadline:t.deadline,scheduledAt:t.scheduledAt},source:'cc'})}).catch(function(){})}else{push('ai_request','inspect',{taskId:t.id,title:t.title,status:t.status,priority:t.priority,assignee:t.assignee,category:t.category,desc:t.desc,expectations:t.expectations,suggestions:t.suggestions,deadline:t.deadline,scheduledAt:t.scheduledAt})}}}
function deleteTask(id){const t=S.tasks.find(x=>x.id===id);if(!t)return;S.tasks=S.tasks.filter(x=>x.id!==id);addLog('task','danny','Deleted: "'+t.title+'"','Manually deleted by Danny.','business');save();if(renders[currentPage])renders[currentPage]()}
let cardDragId=null;function cDStart(e){cardDragId=e.target.closest('[data-tid]').dataset.tid;e.dataTransfer.effectAllowed='move';e.dataTransfer.setData('text/plain','card')}function cDOver(e){e.preventDefault();e.currentTarget.classList.add('drag-over')}function cDLeave(e){e.currentTarget.classList.remove('drag-over')}
function cDDrop(e){e.preventDefault();e.currentTarget.classList.remove('drag-over');if(e.dataTransfer.getData('text/plain')!=='card')return;const col=e.currentTarget.dataset.col;if(cardDragId&&col){const t=S.tasks.find(x=>x.id===cardDragId);if(t&&t.status!==col){t.status=col;if(col==='done'&&!t.completedAt)t.completedAt=ts();addLog('task',t.assignee||'danny','Moved "'+t.title+'" → '+(ALL_COLS.find(c=>c.id===col)?.name||col),'','business');save();if(currentPage==='overview')fillWin('taskboard');else renderKBCards()}}cardDragId=null}
function sendNote(iid){const inp=document.getElementById(iid),c=inp?.value?.trim();if(!c)return;S.notes.push({id:gid(),content:c,createdAt:ts(),from:'danny',seen:false,seenBy:null,seenAt:null,reply:null});addLog('note','danny','Note: "'+c.substring(0,40)+'"','','comms');inp.value='';save();if(currentPage==='overview')fillWin('wnotes');else if(currentPage==='notes')renderNotesPage()}
function deleteNote(id){const n=S.notes.find(x=>x.id===id);if(!n)return;S.notes=S.notes.filter(x=>x.id!==id);addLog('note','danny','Deleted note: "'+n.content.substring(0,40)+'"','','comms');save();if(currentPage==='overview')fillWin('wnotes');if(currentPage==='notes')renderNotesPage()}
function updateBadge(){const el=document.getElementById('taskBadge');if(el)el.textContent=S.tasks.filter(t=>t.status!=='done').length}
function updateMemChips(){document.getElementById('mcD').textContent='📅 '+fmtD(ts());document.getElementById('mcP').textContent='📁 '+S.memoryFiles.filter(m=>m.type==='project').length+' projects'}

/* === FULL TASKBOARD w/ Scheduled col === */
function renderTaskboard(){const el=document.getElementById('pg-taskboard');let h=`<div class="kb-filters"><button class="kf active" data-fc="all" onclick="kfClick(this)">All</button>`;CATS.forEach(c=>{h+=`<button class="kf" data-fc="${c.id}" onclick="kfClick(this)">${c.name}</button>`});h+=`<span style="width:1px;height:14px;background:var(--border);margin:0 3px"></span>`;OPS.forEach(o=>{h+=`<button class="kf" data-fo="${o.id}" onclick="this.classList.toggle('active');renderKBCards()">${o.icon} ${o.name}</button>`});h+=`<input class="kf-search" id="kbSrch" placeholder="🔍 Search..." oninput="renderKBCards()"/></div>`;h+=`<div class="kanban full-kb" id="fullKB" style="height:auto;padding:10px 12px">`;COLS.forEach(col=>{h+=`<div class="kb-col"><div class="kb-col-hdr ${col.css}"><span class="ct">${col.name}</span><span class="cc" id="cc-${col.id}">0</span></div>${col.id==='new_task'?'<input class="add-inp" placeholder="+ New task..." onkeydown="if(event.key===\'Enter\'&&this.value.trim()){openModal(this.value);this.value=\'\'}"/>':''}<div class="kb-cards" id="kcards-${col.id}" data-col="${col.id}" ondragover="cDOver(event)" ondragleave="cDLeave(event)" ondrop="cDDrop(event)"></div></div>`});h+=`<div class="kb-col"><div class="kb-col-hdr scheduled"><span class="ct">📅 Scheduled</span><span class="cc" id="cc-scheduled">0</span></div><div class="kb-cards" id="kcards-scheduled" data-col="scheduled" ondragover="cDOver(event)" ondragleave="cDLeave(event)" ondrop="cDDrop(event)"></div></div>`;h+=`<div class="kb-col"><div class="kb-col-hdr clawd_sugg"><span class="ct">🤖 Clawd Suggestions</span><span class="cc" id="cc-clawd_suggestion">0</span></div><div class="kb-cards" id="kcards-clawd_suggestion" data-col="clawd_suggestion" ondragover="cDOver(event)" ondragleave="cDLeave(event)" ondrop="cDDrop(event)"></div></div></div>`;el.innerHTML=h;renderKBCards()}
function kfClick(b){b.closest('.kb-filters').querySelectorAll('[data-fc]').forEach(x=>x.classList.remove('active'));b.classList.add('active');renderKBCards()}
function renderKBCards(){let tasks=[...S.tasks];const acf=document.querySelector('[data-fc].active');if(acf&&acf.dataset.fc!=='all')tasks=tasks.filter(t=>t.category===acf.dataset.fc);const afo=[...document.querySelectorAll('[data-fo].active')].map(b=>b.dataset.fo);if(afo.length)tasks=tasks.filter(t=>afo.includes(t.assignee));const s=document.getElementById('kbSrch')?.value?.toLowerCase()||'';if(s)tasks=tasks.filter(t=>t.title.toLowerCase().includes(s)||(t.desc||'').toLowerCase().includes(s));ALL_COLS.forEach(col=>{const ct=tasks.filter(t=>t.status===col.id);const el=document.getElementById('kcards-'+col.id),cc=document.getElementById('cc-'+col.id);if(el)el.innerHTML=ct.sort((a,b)=>(a.scheduledAt||'z').localeCompare(b.scheduledAt||'z')).map(renderCard).join('');if(cc)cc.textContent=ct.length});updateBadge()}

/* === PAGES === */
function renderNotesPage(){const el=document.getElementById('pg-notes');let h=`<div class="page-pad"><h2 style="font-size:18px;font-weight:800;margin-bottom:14px">📝 Notes — Async Communication</h2><div style="max-width:600px"><div class="note-input-area"><textarea class="note-input" id="fpNI" placeholder="Drop a note for the AI..." rows="3"></textarea><button class="note-send" onclick="sendNote('fpNI')">Send</button></div>`;[...S.notes].reverse().forEach(n=>{h+=`<div class="ni"><button class="ni-del" onclick="deleteNote('${n.id}')" title="Delete note">🗑️</button><div class="ni-from danny">Danny</div><div class="ni-txt">${n.content}</div><div class="ni-time">${fmt(n.createdAt)} ${n.seen?`<span class="ni-st seen">✅ ${OPS.find(o=>o.id===n.seenBy)?.name||'AI'}</span>`:`<span class="ni-st pend">⏳</span>`}</div></div>`;if(n.reply)h+=`<div class="ni"><div class="ni-from ai">AI</div><div class="ni-txt">${n.reply}</div></div>`});el.innerHTML=h+'</div></div>'}
function renderWorkflows(){const el=document.getElementById('pg-workflows');let h=`<div class="page-pad"><h2 style="font-size:18px;font-weight:800;margin-bottom:4px">⚡ Scheduled Workflows</h2><p style="font-size:12px;color:var(--text-sec);margin-bottom:16px">Recurring automations managed by your AI operators.</p><div class="wf-grid">`;S.workflows.forEach(w=>{h+=`<div class="wf-card"><div class="wf-card-top"><div class="wf-card-nm">🔄 ${w.name}</div><span class="wf-badge ${w.active?'on':'off'}">${w.active?'Active':'Paused'}</span></div><div class="wf-card-freq">${w.freq}</div><div class="wf-card-desc">${w.desc}</div><div style="font-size:10px;color:var(--text-muted);margin-bottom:6px">Operator: ${w.op}</div><div style="display:flex;gap:14px;font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text-muted);margin-bottom:8px"><span>Last: ${w.lastRun?fmtDT(w.lastRun):'Never'}</span><span>Next: ${w.nextRun?fmtDT(w.nextRun):'—'}</span></div><div class="wf-card-acts"><button class="wf-tog ${w.active?'on':'off'}" onclick="togWF('${w.id}')"></button><button class="wf-run-btn" onclick="runWF('${w.id}')">▶ Run Now</button></div></div>`});el.innerHTML=h+'</div></div>'}
function togWF(id){const w=S.workflows.find(x=>x.id===id);if(!w)return;w.active=!w.active;addLog('scheduled','danny',(w.active?'Activated':'Paused')+': '+w.name,'','system');save();renderWorkflows()}
function runWF(id){const w=S.workflows.find(x=>x.id===id);if(!w)return;w.lastRun=ts();addLog('scheduled','system','Manual run: '+w.name,'','system');save();renderWorkflows()}
function renderBriefingPage(){const el=document.getElementById('pg-briefing');const briefs=S.documents.filter(d=>d.title&&(d.title.includes('Morning Brief')||d.title.includes('MORNING BRIEF')||d.title.includes('Overnight Build')||(d.tags&&(d.tags.includes('morning-brief')||d.tags.includes('overnight'))))).sort((a,b)=>new Date(b.at)-new Date(a.at));if(!S.briefComments)S.briefComments=[];let h=`<div class="page-pad"><h2 style="font-size:18px;font-weight:800;margin-bottom:4px">📰 Daily Reports</h2><p style="font-size:12px;color:var(--text-sec);margin-bottom:16px">Morning briefs, overnight reports, and your feedback loop with Clawd.</p>`;if(!briefs.length){h+=`<div style="text-align:center;padding:40px;color:var(--text-muted)"><div style="font-size:36px;margin-bottom:10px">📰</div><div style="font-size:13px">No briefs yet. Clawd delivers daily at 9am CT.</div></div>`;el.innerHTML=h+'</div>';return}/* Brief selector tabs */h+=`<div style="display:flex;gap:4px;margin-bottom:14px;overflow-x:auto;padding-bottom:4px">`;briefs.forEach((b,i)=>{h+=`<button class="tab-btn ${i===(_activeBrief||0)?'on':''}" onclick="_activeBrief=${i};renderBriefingPage()" style="flex-shrink:0"><span class="tdot"></span>${fmtD(b.at)} — ${b.title.substring(0,30)}</button>`});h+=`</div>`;const brief=briefs[_activeBrief||0];if(brief){/* Brief content card */h+=`<div style="background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);margin-bottom:16px;overflow:hidden">`;h+=`<div style="padding:12px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between">`;h+=`<div><div style="font-size:14px;font-weight:700">${brief.title}</div><div style="font-size:10px;color:var(--text-muted);margin-top:2px">${fmtDT(brief.at)}${brief.source==='claude'?' · <span style="color:var(--review-purple)">🤖 Generated by Clawd</span>':''}</div></div>`;h+=`</div>`;h+=`<div style="padding:16px;font-size:12px;line-height:1.7;max-height:500px;overflow-y:auto" class="docs-vbody">${renderMd(brief.content)}</div>`;h+=`</div>`;/* Comments / Feedback section */h+=`<div style="background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:14px 16px">`;h+=`<div style="font-size:12px;font-weight:700;margin-bottom:10px;display:flex;align-items:center;gap:6px">💬 Notes & Feedback <span style="font-size:9px;color:var(--text-muted);font-weight:400">— Comments trigger Clawd directly</span></div>`;h+=`<div class="note-input-area" style="margin-bottom:10px"><textarea class="note-input" id="briefComment" placeholder="Add feedback, changes, or questions about this brief..." rows="2"></textarea><button class="note-send" onclick="sendBriefComment('${brief.id}')">Send to Clawd</button></div>`;/* Existing comments for this brief */const comments=(S.briefComments||[]).filter(c=>c.briefId===brief.id).sort((a,b)=>new Date(b.ts)-new Date(a.ts));if(comments.length){comments.forEach(c=>{h+=`<div class="ni" style="margin-bottom:6px"><div class="ni-from ${c.from==='danny'?'danny':'ai'}">${c.from==='danny'?'Danny':'Clawd'}</div><div class="ni-txt">${c.text}</div><div class="ni-time">${fmtDT(c.ts)}</div></div>`})}else{h+=`<div style="text-align:center;font-size:11px;color:var(--text-muted);padding:8px">No comments yet. Type above to send feedback to Clawd.</div>`}h+=`</div>`}el.innerHTML=h+'</div>'}let _activeBrief=0;function sendBriefComment(briefId){const inp=document.getElementById('briefComment');const text=inp?.value?.trim();if(!text)return;if(!S.briefComments)S.briefComments=[];const comment={id:gid(),briefId,from:'danny',text,ts:ts()};S.briefComments.push(comment);addLog('note','danny','Brief feedback: "'+text.substring(0,50)+'"','','comms');/* Push to Clawd as ai_request */const su=localStorage.getItem('ff_sync_url')||'https://76.13.126.53:443';const sk=localStorage.getItem('ff_sync_key')||'';const headers={'Content-Type':'application/json'};if(sk)headers['Authorization']='Bearer '+sk;fetch(su+'/api/push',{method:'POST',headers,body:JSON.stringify({type:'ai_request',action:'brief_feedback',data:{briefId,briefTitle:S.documents.find(d=>d.id===briefId)?.title||'Unknown',comment:text,from:'danny',ts:comment.ts},source:'cc'})}).catch(()=>{});inp.value='';save();renderBriefingPage()}

/* === ANALYTICS === */
function renderAnalytics(){const el=document.getElementById('pg-analytics');const total=S.tasks.length,done=S.tasks.filter(t=>t.status==='done').length,ip=S.tasks.filter(t=>t.status==='in_progress').length,rev=S.tasks.filter(t=>t.status==='review').length,nt=S.tasks.filter(t=>t.status==='new_task').length,sched=S.tasks.filter(t=>t.status==='scheduled').length;const pctDone=total?Math.round(done/total*100):0;const todayDone=S.tasks.filter(t=>t.status==='done'&&t.completedAt&&new Date(t.completedAt).toDateString()===new Date().toDateString()).length;const goalsDone=S.goals.filter(g=>g.progress>=100).length;const wfActive=S.workflows.filter(w=>w.active).length;
let h=`<div class="page-pad"><h2 style="font-size:18px;font-weight:800;margin-bottom:4px">📈 Analytics</h2><p style="font-size:12px;color:var(--text-sec);margin-bottom:16px">Performance dashboards, task velocity, and business metrics.</p>`;
/* Completed totals hero row */
h+=`<div style="display:grid;grid-template-columns:repeat(6,1fr);gap:10px;margin-bottom:16px">`;
h+=`<div class="an-card" style="border-top:3px solid var(--online)"><div class="an-card-ico">✅</div><div class="an-card-val" style="color:var(--online)">${done}</div><div class="an-card-label">Completed</div></div>`;
h+=`<div class="an-card" style="border-top:3px solid var(--accent)"><div class="an-card-ico">📊</div><div class="an-card-val" style="color:var(--accent)">${pctDone}%</div><div class="an-card-label">Done Rate</div></div>`;
h+=`<div class="an-card" style="border-top:3px solid var(--working)"><div class="an-card-ico">⚡</div><div class="an-card-val" style="color:var(--working)">${ip}</div><div class="an-card-label">In Progress</div></div>`;
h+=`<div class="an-card" style="border-top:3px solid var(--review-purple)"><div class="an-card-ico">👁️</div><div class="an-card-val" style="color:var(--review-purple)">${rev}</div><div class="an-card-label">In Review</div></div>`;
h+=`<div class="an-card" style="border-top:3px solid var(--kanban-new)"><div class="an-card-ico">📋</div><div class="an-card-val">${total}</div><div class="an-card-label">Total Tasks</div></div>`;
h+=`<div class="an-card" style="border-top:3px solid var(--idle)"><div class="an-card-ico">📅</div><div class="an-card-val" style="color:var(--idle)">${sched}</div><div class="an-card-label">Scheduled</div></div>`;
h+=`</div>`;
/* Today's summary strip */
h+=`<div style="display:flex;gap:10px;margin-bottom:16px">`;
h+=`<div style="flex:1;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:12px 16px"><div style="display:flex;align-items:center;gap:12px"><div style="font-size:24px">🔥</div><div><div style="font-size:13px;font-weight:700">Today's Progress</div><div style="font-size:11px;color:var(--text-sec)">${todayDone} tasks completed today · ${ip+rev} still active</div></div></div></div>`;
h+=`<div style="flex:1;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:12px 16px"><div style="display:flex;align-items:center;gap:12px"><div style="font-size:24px">🎯</div><div><div style="font-size:13px;font-weight:700">Goals</div><div style="font-size:11px;color:var(--text-sec)">${goalsDone}/${S.goals.length} achieved · ${S.goals.filter(g=>g.status==='active').length} active</div></div></div></div>`;
h+=`<div style="flex:1;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:12px 16px"><div style="display:flex;align-items:center;gap:12px"><div style="font-size:24px">⚡</div><div><div style="font-size:13px;font-weight:700">Workflows</div><div style="font-size:11px;color:var(--text-sec)">${wfActive}/${S.workflows.length} active · ${S.connectedSystems.filter(s=>s.status==='connected').length} systems connected</div></div></div></div>`;
h+=`</div>`;
/* Charts */
h+=`<div class="an-row2"><div class="an-chart"><div class="an-chart-t">👥 Operator Load</div>`;OPS.forEach(o=>{const c=S.tasks.filter(t=>t.assignee===o.id&&t.status!=='done').length,d=S.tasks.filter(t=>t.assignee===o.id&&t.status==='done').length;h+=`<div class="an-bar-row"><div class="an-bar-label">${o.icon} ${o.name}</div><div class="an-bar-track"><div class="an-bar-fill" style="width:${Math.max((c+d)/total*100,5)}%;background:${o.hex}">${c} active · ${d} done</div></div></div>`});h+=`</div><div class="an-chart"><div class="an-chart-t">📊 GoHighLevel Pipeline</div>`;[{l:'New Leads',v:12,c:'var(--online)'},{l:'Contacted',v:8,c:'var(--working)'},{l:'Quoted',v:5,c:'var(--idle)'},{l:'Applied',v:3,c:'var(--accent)'},{l:'Issued',v:2,c:'var(--review-purple)'}].forEach(g=>{h+=`<div class="an-bar-row"><div class="an-bar-label">${g.l}</div><div class="an-bar-track"><div class="an-bar-fill" style="width:${Math.max(g.v*4,5)}%;background:${g.c}">${g.v}</div></div></div>`});h+=`</div></div>`;
h+=`<div class="an-row2"><div class="an-chart"><div class="an-chart-t">📁 Category Breakdown</div>`;CATS.forEach(c=>{const ct=S.tasks.filter(t=>t.category===c.id).length,cd=S.tasks.filter(t=>t.category===c.id&&t.status==='done').length;h+=`<div class="an-bar-row"><div class="an-bar-label">${c.name}</div><div class="an-bar-track"><div class="an-bar-fill" style="width:${Math.max(ct/total*100,5)}%;background:var(--accent)">${cd}/${ct} done</div></div></div>`});h+=`</div><div class="an-chart"><div class="an-chart-t">📊 Task Velocity</div>`;ALL_COLS.forEach(col=>{const ct=S.tasks.filter(t=>t.status===col.id).length;const colors={new_task:'var(--kanban-new)',in_progress:'var(--kanban-progress)',review:'var(--kanban-review)',done:'var(--kanban-done)',scheduled:'var(--kanban-sched)'};h+=`<div class="an-bar-row"><div class="an-bar-label">${col.name}</div><div class="an-bar-track"><div class="an-bar-fill" style="width:${Math.max(ct/total*100,5)}%;background:${colors[col.id]}">${ct} (${total?Math.round(ct/total*100):0}%)</div></div></div>`});h+=`</div></div>`;
/* Priority distribution */
h+=`<div class="an-chart" style="margin-bottom:12px"><div class="an-chart-t">🚨 Priority Distribution</div>`;[{l:'Critical',k:'critical',c:'var(--pri-critical)'},{l:'High',k:'high',c:'var(--pri-high)'},{l:'Medium',k:'medium',c:'var(--pri-medium)'},{l:'Low',k:'low',c:'var(--pri-low)'}].forEach(p=>{const ct=S.tasks.filter(t=>t.priority===p.k).length;h+=`<div class="an-bar-row"><div class="an-bar-label">${p.l}</div><div class="an-bar-track"><div class="an-bar-fill" style="width:${Math.max(ct/total*100,5)}%;background:${p.c}">${ct}</div></div></div>`});h+=`</div>`;
el.innerHTML=h+'</div>'}

/* === GOALS — WINDOWED LAYOUT === */
const GCOLS={revenue:'var(--online)',growth:'var(--accent)',systems:'var(--working)',personal:'var(--review-purple)'};
const GICONS={revenue:'💰',growth:'📈',systems:'⚙️',personal:'🧘'};
const GENC=['🔥 You\'re building something real. Keep pushing.','💪 Consistency beats intensity. Show up every day.','🚀 Every task done is fuel for liftoff.','⭐ Small wins compound. You\'re closer than you think.','🎯 Eyes on the target. Hands on the wheel.','💎 Pressure creates diamonds. You\'re in the forge.'];
function goalWinDefs(){return S.goals.map((g,i)=>({id:'goal-'+i,title:(GICONS[g.cat]||'🎯')+' '+g.title,idx:i}))}
function defaultGoalLayout(){const cv=document.getElementById('goalCanvas');const cw=cv?cv.clientWidth:900;const gap=10;let y=0;const layout={};S.goals.forEach((g,i)=>{layout['goal-'+i]={x:0,y,w:cw,h:240,vis:true,z:i+1};y+=240+gap});return layout}
function getGoalLayout(){if(!S.goalLayout||Object.keys(S.goalLayout).length!==S.goals.length){S.goalLayout=defaultGoalLayout()}return S.goalLayout}
function goalCanvasW(){const c=document.getElementById('goalCanvas');return c?c.clientWidth:900}
function goalHitsOther(r,skipId){const L=getGoalLayout();for(const d of goalWinDefs()){if(d.id===skipId)continue;const p=L[d.id];if(!p||p.vis===false)continue;if(r.x<p.x+p.w&&r.x+r.w>p.x&&r.y<p.y+p.h&&r.y+r.h>p.y)return true}return false}
function goalClampRect(r){const cw=goalCanvasW();r.x=Math.max(0,Math.min(r.x,cw-r.w));r.y=Math.max(0,r.y);r.w=Math.max(220,Math.min(r.w,cw-r.x));r.h=Math.max(120,r.h)}
let _gDrag=null,_gResize=null;
function renderGoals(){const el=document.getElementById('pg-goals');const defs=goalWinDefs();const L=getGoalLayout();
/* Build tab bar */
let tb='';defs.forEach(d=>{const vis=L[d.id]?.vis!==false;tb+=`<button class="tab-btn ${vis?'on':'off'}" onclick="toggleGoalVis('${d.id}')"><span class="tdot"></span>${d.title}</button>`});tb+=`<button class="tab-reset" onclick="resetGoalLayout()">↺ Reset</button>`;tb+=`<button class="tab-reset" onclick="openGoalModal()" style="color:var(--accent)">+ Add Goal</button>`;
/* Header stats */
const totalG=S.goals.length,activeG=S.goals.filter(g=>g.status==='active').length,doneG=S.goals.filter(g=>g.progress>=100).length,avgP=totalG?Math.round(S.goals.reduce((a,g)=>a+g.progress,0)/totalG):0;
let hdr=`<div style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:10px">`;
hdr+=`<div class="scard" style="border-top:3px solid var(--accent)"><div class="sc-label">Total Goals</div><div class="sc-val">${totalG}</div></div>`;
hdr+=`<div class="scard" style="border-top:3px solid var(--online)"><div class="sc-label">Active</div><div class="sc-val" style="color:var(--online)">${activeG}</div></div>`;
hdr+=`<div class="scard" style="border-top:3px solid var(--review-purple)"><div class="sc-label">Avg Progress</div><div class="sc-val" style="color:var(--review-purple)">${avgP}%</div></div>`;
hdr+=`<div class="scard" style="border-top:3px solid var(--working)"><div class="sc-label">Achieved</div><div class="sc-val" style="color:var(--working)">${doneG}</div></div></div>`;
el.innerHTML=`<div id="goalTabBar">${tb}</div><div id="goalScroll"><div id="goalHeader">${hdr}</div><div id="goalCanvas"></div></div>`;
/* Create window shells */
const canvas=document.getElementById('goalCanvas');canvas.innerHTML='';defs.forEach(d=>{const w=document.createElement('div');w.id='gwin-'+d.id;w.className='win';w.innerHTML=`<div class="win-bar" data-gwid="${d.id}"><span class="win-grip">⋮⋮</span><span class="win-title">${d.title}</span><div class="win-ctrl"><button class="win-btn close" onclick="toggleGoalVis('${d.id}')">✕</button></div></div><div class="win-body" id="gwb-${d.id}"></div><div class="win-rs" data-gwid="${d.id}" data-gmode="corner"></div><div class="win-rs-r" data-gwid="${d.id}" data-gmode="right"></div><div class="win-rs-b" data-gwid="${d.id}" data-gmode="bottom"></div>`;canvas.appendChild(w)});
/* Apply positions */
const cw=goalCanvasW();let mx=0;defs.forEach(d=>{const we=document.getElementById('gwin-'+d.id);if(!we)return;const p=L[d.id];if(!p)return;p.w=Math.max(220,Math.min(p.w,cw));p.x=Math.max(0,Math.min(p.x,cw-p.w));p.y=Math.max(0,p.y);p.h=Math.max(120,p.h);we.style.cssText=`left:${p.x}px;top:${p.y}px;width:${p.w}px;height:${p.h}px;z-index:${p.z||1};position:absolute`;we.classList.toggle('hidden-win',p.vis===false);if(p.vis!==false)mx=Math.max(mx,p.y+p.h)});canvas.style.minHeight=Math.max(600,mx+40)+'px';
/* Fill goal content */
defs.forEach(d=>fillGoalWin(d.id,d.idx));
/* Attach drag/resize listeners */
canvas.onmousedown=e=>{const bar=e.target.closest('[data-gwid]');if(bar&&bar.classList.contains('win-bar')&&!e.target.closest('.win-btn')){goalDragStart(e,bar.dataset.gwid);return}const rs=e.target.closest('[data-gmode]');if(rs){goalResizeStart(e,rs.dataset.gwid,rs.dataset.gmode)}}}
function fillGoalWin(winId,gi){const el=document.getElementById('gwb-'+winId);if(!el||!S.goals[gi])return;const g=S.goals[gi],i=gi;const col=GCOLS[g.cat]||'var(--accent)';const doneMs=g.milestones.filter(m=>m.done).length;const totalMs=g.milestones.length;const enc=GENC[i%GENC.length];
let h=`<div style="padding:10px 12px;position:relative">`;
h+=`<div class="goal-del" onclick="deleteGoal(${i})" title="Delete goal" style="position:absolute;top:8px;right:8px;opacity:0.5">🗑️</div>`;
h+=`<div style="display:flex;align-items:center;gap:8px;margin-bottom:6px"><span class="goal-badge ${g.status}">${g.status}</span>${g.deadline?`<span style="font-size:9px;color:var(--text-muted);font-family:'JetBrains Mono',monospace">🗓 ${fmtD(g.deadline)}</span>`:''}</div>`;
h+=`<div class="goal-desc" style="margin-bottom:8px">${g.desc}</div>`;
h+=`<div class="goal-progress" style="margin-bottom:8px"><div class="goal-prog-top"><span class="goal-prog-label">Progress · ${doneMs}/${totalMs} milestones</span><span class="goal-prog-pct" style="color:${col}">${g.progress}%</span></div><div class="goal-prog-bar"><div class="goal-prog-fill" style="width:${g.progress}%;background:${col}"></div></div></div>`;
if(g.metrics){h+=`<div class="goal-metrics" style="margin-bottom:8px">`;Object.entries(g.metrics).forEach(([k,v])=>{h+=`<div class="goal-metric"><div class="goal-metric-val" style="color:${col}">${v}</div><div class="goal-metric-label">${k}</div></div>`});h+=`</div>`}
h+=`<div class="goal-milestones">`;g.milestones.forEach((m,mi)=>{h+=`<div class="goal-ms ${m.done?'done':'pend'}" onclick="toggleMilestone(${i},${mi})" style="cursor:pointer">${m.done?'☑':'☐'} ${m.text}</div>`});h+=`</div>`;
h+=`<div class="goal-encourage">${enc}</div></div>`;el.innerHTML=h}
function toggleGoalVis(id){const L=getGoalLayout();if(L[id])L[id].vis=!L[id].vis;save();renderGoals()}
function resetGoalLayout(){S.goalLayout=null;save();renderGoals()}
function goalDragStart(e,id){if(e.button!==0)return;e.preventDefault();const p=getGoalLayout()[id];_gDrag={id,smx:e.pageX,smy:e.pageY,sx:p.x,sy:p.y,lastGoodX:p.x,lastGoodY:p.y};document.getElementById('gwin-'+id)?.classList.add('dragging')}
function goalResizeStart(e,id,mode){if(e.button!==0)return;e.preventDefault();e.stopPropagation();const p=getGoalLayout()[id];_gResize={id,mode,sx:e.pageX,sy:e.pageY,sw:p.w,sh:p.h}}
document.addEventListener('mousemove',e=>{
if(_gDrag){const L=getGoalLayout();const p=L[_gDrag.id];const nx=_gDrag.sx+(e.pageX-_gDrag.smx);const ny=_gDrag.sy+(e.pageY-_gDrag.smy);const cand={x:nx,y:ny,w:p.w,h:p.h};goalClampRect(cand);if(!goalHitsOther(cand,_gDrag.id)){p.x=cand.x;p.y=cand.y;_gDrag.lastGoodX=cand.x;_gDrag.lastGoodY=cand.y}else{const cx={x:cand.x,y:_gDrag.lastGoodY,w:p.w,h:p.h};goalClampRect(cx);if(!goalHitsOther(cx,_gDrag.id)){p.x=cx.x;p.y=cx.y;_gDrag.lastGoodX=cx.x;_gDrag.lastGoodY=cx.y}else{const cy={x:_gDrag.lastGoodX,y:cand.y,w:p.w,h:p.h};goalClampRect(cy);if(!goalHitsOther(cy,_gDrag.id)){p.x=cy.x;p.y=cy.y;_gDrag.lastGoodX=cy.x;_gDrag.lastGoodY=cy.y}}}const we=document.getElementById('gwin-'+_gDrag.id);we.style.left=p.x+'px';we.style.top=p.y+'px'}
if(_gResize){const L=getGoalLayout();const p=L[_gResize.id];let nw=_gResize.mode!=='bottom'?Math.max(220,_gResize.sw+(e.pageX-_gResize.sx)):p.w;let nh=_gResize.mode!=='right'?Math.max(120,_gResize.sh+(e.pageY-_gResize.sy)):p.h;const cw=goalCanvasW();nw=Math.min(nw,cw-p.x);const cand={x:p.x,y:p.y,w:nw,h:nh};if(!goalHitsOther(cand,_gResize.id)){p.w=nw;p.h=nh}const we=document.getElementById('gwin-'+_gResize.id);we.style.width=p.w+'px';we.style.height=p.h+'px'}});
document.addEventListener('mouseup',e=>{if(_gDrag){document.getElementById('gwin-'+_gDrag.id)?.classList.remove('dragging');_gDrag=null;save();goalUpdateH()}if(_gResize){_gResize=null;save();goalUpdateH()}});
function goalUpdateH(){const L=getGoalLayout();let mx=0;goalWinDefs().forEach(d=>{const p=L[d.id];if(p?.vis!==false)mx=Math.max(mx,p.y+p.h)});const c=document.getElementById('goalCanvas');if(c)c.style.minHeight=Math.max(600,mx+40)+'px'}
function toggleMilestone(gi,mi){S.goals[gi].milestones[mi].done=!S.goals[gi].milestones[mi].done;const g=S.goals[gi];const doneMs=g.milestones.filter(m=>m.done).length;g.progress=Math.round(doneMs/g.milestones.length*100);save();renderGoals()}
function deleteGoal(gi){const g=S.goals[gi];if(!g)return;if(!confirm('⚠️ DANNY ONLY — Delete goal "'+g.title+'"?\n\nThis cannot be undone.'))return;S.goals.splice(gi,1);S.goalLayout=null;addLog('task','danny','Deleted goal: "'+g.title+'"','Manually deleted by Danny.','business');save();renderGoals()}
function openGoalModal(){document.getElementById('goalModal').classList.add('show');document.getElementById('gTitle').value='';document.getElementById('gDesc').value='';document.getElementById('gMilestones').value='';document.getElementById('gTitle').focus()}
function closeGoalModal(){document.getElementById('goalModal').classList.remove('show')}
function saveGoal(){const t=document.getElementById('gTitle').value.trim();if(!t)return;const ms=document.getElementById('gMilestones').value.split('\n').filter(l=>l.trim()).map(l=>({text:l.trim(),done:false}));S.goals.push({id:gid(),title:t,desc:document.getElementById('gDesc').value.trim(),cat:document.getElementById('gCat').value,status:'active',deadline:document.getElementById('gDeadline').value||null,progress:0,milestones:ms,metrics:{},createdAt:ts()});S.goalLayout=null;addLog('task','danny','New goal: "'+t+'"','','business');save();closeGoalModal();renderGoals()}
document.getElementById('goalModal').onclick=e=>{if(e.target===e.currentTarget)closeGoalModal()};

/* === AESTHETICS (80 colors + themes + fonts + UI tweaks + BG modes) === */
const BG_MODES=[
  {id:'dark',name:'Black',bg:'#0B0E14',surface:'#12161F',surfaceAlt:'#181D28',border:'#1E2433',text:'#E2E8F0',textSec:'#8B95A8',textMuted:'#4A5568'},
  {id:'charcoal',name:'Charcoal',bg:'#1C1C1C',surface:'#262626',surfaceAlt:'#2E2E2E',border:'#3A3A3A',text:'#F0F0F0',textSec:'#A0A0A0',textMuted:'#666666'},
  {id:'tokyo',name:'Tokyo Night',bg:'#1A1B26',surface:'#24283B',surfaceAlt:'#292E42',border:'#3B4261',text:'#C0CAF5',textSec:'#9AA5CE',textMuted:'#565F89'},
  {id:'dracula',name:'Dracula',bg:'#282A36',surface:'#343746',surfaceAlt:'#3C3F58',border:'#44475A',text:'#F8F8F2',textSec:'#BD93F9',textMuted:'#6272A4'},
  {id:'white',name:'Pure White',bg:'#FFFFFF',surface:'#FFFFFF',surfaceAlt:'#F5F5F5',border:'#E2E2E2',text:'#111111',textSec:'#555555',textMuted:'#999999'},
  {id:'offwhite',name:'Off White',bg:'#FAF9F6',surface:'#FFFFFF',surfaceAlt:'#F2F0EB',border:'#DDD9D0',text:'#2D2B27',textSec:'#6B6761',textMuted:'#A8A49C'},
  {id:'cloud',name:'Cloud',bg:'#F0F4F8',surface:'#FFFFFF',surfaceAlt:'#E8EDF2',border:'#D1D9E6',text:'#1A202C',textSec:'#4A5568',textMuted:'#A0AEC0'},
  {id:'cream',name:'Warm Cream',bg:'#FFF8F0',surface:'#FFFFFF',surfaceAlt:'#FFF0E0',border:'#EDE0D0',text:'#3D2B1F',textSec:'#7A6555',textMuted:'#B5A898'},
  {id:'grad-sunset',name:'Sunset Grad',bg:'linear-gradient(135deg,#0F0C29,#302B63,#24243E)',surface:'rgba(18,22,31,.85)',surfaceAlt:'rgba(24,29,40,.85)',border:'rgba(60,50,80,.5)',text:'#E2E8F0',textSec:'#9AA5CE',textMuted:'#565F89',gradient:true},
  {id:'grad-ocean',name:'Ocean Grad',bg:'linear-gradient(135deg,#0D1B2A,#1B2838,#0A3D62)',surface:'rgba(13,27,42,.85)',surfaceAlt:'rgba(27,40,56,.85)',border:'rgba(10,61,98,.4)',text:'#D6E4F0',textSec:'#8BA9C4',textMuted:'#4A6A84',gradient:true},
  {id:'grad-aurora',name:'Aurora Grad',bg:'linear-gradient(135deg,#0a0a1a,#1a0a2e,#0a1a2e,#0a2e1a)',surface:'rgba(15,15,30,.85)',surfaceAlt:'rgba(20,20,40,.85)',border:'rgba(50,30,80,.4)',text:'#E0E0FF',textSec:'#9AA5CE',textMuted:'#565F89',gradient:true},
  {id:'grad-ember',name:'Ember Grad',bg:'linear-gradient(135deg,#1A0A0A,#2E1A0A,#1A1A0A)',surface:'rgba(26,10,10,.85)',surfaceAlt:'rgba(40,20,10,.85)',border:'rgba(80,40,20,.4)',text:'#FFE4D6',textSec:'#C4A08B',textMuted:'#846A55',gradient:true},
  {id:'custom-img',name:'📷 Custom',bg:'#0B0E14',surface:'rgba(12,14,20,.88)',surfaceAlt:'rgba(18,22,31,.88)',border:'rgba(30,36,51,.6)',text:'#E2E8F0',textSec:'#8B95A8',textMuted:'#4A5568',custom:true}
];
function renderAesthetics(){const el=document.getElementById('pg-aesthetics');let h=`<div class="page-pad"><h2 style="font-size:18px;font-weight:800;margin-bottom:4px">🎨 Aesthetics</h2><p style="font-size:12px;color:var(--text-sec);margin-bottom:16px">Customize every visual detail. All changes apply instantly.</p>`;
/* Background Mode */
h+=`<input type="file" id="bgImgUpload" accept="image/*,video/mp4,video/webm" style="display:none" onchange="handleBgImageUpload(this)"/>`;
h+=`<div class="ae-sec"><div class="ae-sec-t">🖥️ Background Mode</div><div class="theme-grid">`;BG_MODES.forEach(m=>{const prev=m.gradient?`<span style="background:${m.bg};width:100%;height:14px;border-radius:3px"></span>`:m.custom?`<span style="background:var(--accent-dim);width:100%;height:14px;border-radius:3px;font-size:8px;display:flex;align-items:center;justify-content:center;color:var(--text-sec)">Upload</span>`:`<span style="background:${m.bg}"></span><span style="background:${m.surface}"></span><span style="background:${m.text}"></span>`;h+=`<div class="theme-card ${S.bgMode===m.id?'active':''}" onclick="applyBgMode('${m.id}')"><div class="prev">${prev}</div><div class="tnm">${m.name}</div></div>`});h+=`</div>`;
if(S.bgImage){h+=`<div style="margin-top:8px;display:flex;align-items:center;gap:8px"><span style="font-size:10px;color:var(--text-sec)">Custom image active</span><button class="set-btn" style="font-size:9px" onclick="S.bgImage=null;S.bgMode='dark';applyBgMode('dark')">✕ Remove</button></div>`}
h+=`</div>`;
/* Themes */
h+=`<div class="ae-sec"><div class="ae-sec-t">🎨 Accent Color</div><div class="theme-grid">`;THEMES.forEach(t=>{h+=`<div class="theme-card ${S.activeTheme===t.name?'active':''}" onclick="applyTheme('${t.name}')"><div class="prev">${Object.values(t.colors).map(c=>`<span style="background:${c}"></span>`).join('')}</div><div class="tnm">${t.name}</div></div>`});h+=`</div></div>`;
/* Font */
h+=`<div class="ae-sec"><div class="ae-sec-t">🔤 Font Family</div><div style="display:flex;gap:6px;flex-wrap:wrap">`;FONTS.forEach(f=>{h+=`<button class="kf ${S.activeFont===f?'active':''}" onclick="applyFontChoice('${f}')" style="font-family:'${f}'">${f}</button>`});h+=`</div></div>`;
/* Font Scale Slider */
h+=`<div class="ae-sec"><div class="ae-sec-t">🔠 Font Size</div>`;
h+=`<div class="ae-slider-row"><label>Global Font Scale</label><input type="range" min="50" max="300" step="5" value="${S.fontScale||100}" oninput="const v=+this.value;setFontScale(v);this.parentNode.querySelector('.ae-num-input').value=v"/><input type="number" class="ae-num-input" min="50" max="300" step="5" value="${S.fontScale||100}" onkeydown="if(event.key==='Enter'){const v=Math.min(300,Math.max(50,+this.value||100));this.value=v;setFontScale(v);this.parentNode.querySelector('input[type=range]').value=v}" onblur="const v=Math.min(300,Math.max(50,+this.value||100));this.value=v;setFontScale(v);this.parentNode.querySelector('input[type=range]').value=v"/><span class="ae-slider-val">%</span></div>`;
h+=`<div style="display:flex;justify-content:space-between;font-size:9px;color:var(--text-muted);padding:0 2px;margin-top:-4px"><span>½× (50%)</span><span>1× (100%)</span><span>3× (300%)</span></div>`;
h+=`<div style="margin-top:8px"><button class="set-btn" style="font-size:10px" onclick="setFontScale(100);renderAesthetics()">↺ Reset to 100%</button></div></div>`;
/* UI Scale Slider (everything except font) */
h+=`<div class="ae-sec"><div class="ae-sec-t">🔍 UI Scale (Images, Cards, Spacing)</div>`;
h+=`<div class="ae-slider-row"><label>Global UI Scale</label><input type="range" min="50" max="200" step="5" value="${S.uiScale||100}" oninput="const v=+this.value;setUIScale(v);this.parentNode.querySelector('.ae-num-input').value=v"/><input type="number" class="ae-num-input" min="50" max="200" step="5" value="${S.uiScale||100}" onkeydown="if(event.key==='Enter'){const v=Math.min(200,Math.max(50,+this.value||100));this.value=v;setUIScale(v);this.parentNode.querySelector('input[type=range]').value=v}" onblur="const v=Math.min(200,Math.max(50,+this.value||100));this.value=v;setUIScale(v);this.parentNode.querySelector('input[type=range]').value=v"/><span class="ae-slider-val">%</span></div>`;
h+=`<div style="display:flex;justify-content:space-between;font-size:9px;color:var(--text-muted);padding:0 2px;margin-top:-4px"><span>½× (50%)</span><span>1× (100%)</span><span>2× (200%)</span></div>`;
h+=`<div style="margin-top:8px"><button class="set-btn" style="font-size:10px" onclick="setUIScale(100);renderAesthetics()">↺ Reset to 100%</button></div></div>`;
/* Branding — Logo Uploads */
h+=`<div class="ae-sec"><div class="ae-sec-t">🏷️ Branding</div>`;
h+=`<div class="ae-upload-row"><div class="ae-upload-info"><div class="ae-upload-label">Sidebar Logo</div><div class="ae-upload-desc">Replace the "FF" icon in the top-left corner</div></div>`;
h+=`<div class="ae-upload-box" onclick="document.getElementById('logoUpload').click()"><input type="file" id="logoUpload" accept="image/*" style="display:none" onchange="handleLogoUpload(this,'sidebar')"/>`;
h+=S.sidebarLogo?`<img src="${S.sidebarLogo}" class="ae-upload-preview"/>`:`<div class="ae-upload-placeholder">📷 Upload</div>`;
h+=`</div>${S.sidebarLogo?'<button class="ae-upload-clear" onclick="clearLogo(\'sidebar\')">✕</button>':''}</div>`;
h+=`<div class="ae-upload-row"><div class="ae-upload-info"><div class="ae-upload-label">Clawd Agent Avatar</div><div class="ae-upload-desc">Replace the Clawd icon in the agent tracker</div></div>`;
h+=`<div class="ae-upload-box" onclick="document.getElementById('clawdUpload').click()"><input type="file" id="clawdUpload" accept="image/*" style="display:none" onchange="handleLogoUpload(this,'clawd')"/>`;
h+=S.clawdAvatar?`<img src="${S.clawdAvatar}" class="ae-upload-preview"/>`:`<div class="ae-upload-placeholder">📷 Upload</div>`;
h+=`</div>${S.clawdAvatar?'<button class="ae-upload-clear" onclick="clearLogo(\'clawd\')">✕</button>':''}</div>`;
h+=`</div>`;
/* Clawd Live Monitor */
h+=`<div class="ae-sec"><div class="ae-sec-t">🧠 Clawd Live Monitor</div>`;
h+=`<div class="ae-slider-row"><label>Monitor Scale</label><input type="range" min="60" max="150" step="5" value="${S.clawdScale||100}" oninput="const v=+this.value;setClawdScale(v);this.parentNode.querySelector('.ae-num-input').value=v"/><input type="number" class="ae-num-input" min="60" max="150" step="5" value="${S.clawdScale||100}" onkeydown="if(event.key==='Enter'){const v=Math.min(150,Math.max(60,+this.value||100));this.value=v;setClawdScale(v);this.parentNode.querySelector('input[type=range]').value=v}" onblur="const v=Math.min(150,Math.max(60,+this.value||100));this.value=v;setClawdScale(v);this.parentNode.querySelector('input[type=range]').value=v"/><span class="ae-slider-val">%</span></div>`;
h+=`<div class="ae-slider-row"><label>Padding</label><input type="range" min="4" max="24" value="${S.clawdPad||14}" oninput="const v=+this.value;setClawdPad(v);this.parentNode.querySelector('.ae-num-input').value=v"/><input type="number" class="ae-num-input" min="4" max="24" step="1" value="${S.clawdPad||14}" onkeydown="if(event.key==='Enter'){const v=Math.min(24,Math.max(4,+this.value||14));this.value=v;setClawdPad(v);this.parentNode.querySelector('input[type=range]').value=v}" onblur="const v=Math.min(24,Math.max(4,+this.value||14));this.value=v;setClawdPad(v);this.parentNode.querySelector('input[type=range]').value=v"/><span class="ae-slider-val">px</span></div>`;
h+=`<div class="ae-toggle-row"><div><div class="ae-toggle-label">Show Monitor</div><div class="ae-toggle-desc">Toggle the Clawd live tracker in sidebar</div></div><button class="wf-tog ${S.showClawdMonitor!==false?'on':'off'}" onclick="toggleClawdMonitor()"></button></div>`;
h+=`</div>`;
/* UI Sliders */
h+=`<div class="ae-sec"><div class="ae-sec-t">🎛️ UI Adjustments</div>`;
h+=`<div class="ae-slider-row"><label>Title Size</label><input type="range" min="12" max="28" value="${S.titleSize||18}" oninput="const v=+this.value;setTitleSize(v);this.parentNode.querySelector('.ae-num-input').value=v"/><input type="number" class="ae-num-input" min="12" max="28" step="1" value="${S.titleSize||18}" onkeydown="if(event.key==='Enter'){const v=Math.min(28,Math.max(12,+this.value||18));this.value=v;setTitleSize(v);this.parentNode.querySelector('input[type=range]').value=v}" onblur="const v=Math.min(28,Math.max(12,+this.value||18));this.value=v;setTitleSize(v);this.parentNode.querySelector('input[type=range]').value=v"/><span class="ae-slider-val">px</span></div>`;
h+=`<div class="ae-slider-row"><label>Card Icon Size</label><input type="range" min="10" max="32" value="${S.iconSize||14}" oninput="const v=+this.value;setIconSize(v);this.parentNode.querySelector('.ae-num-input').value=v"/><input type="number" class="ae-num-input" min="10" max="32" step="1" value="${S.iconSize||14}" onkeydown="if(event.key==='Enter'){const v=Math.min(32,Math.max(10,+this.value||14));this.value=v;setIconSize(v);this.parentNode.querySelector('input[type=range]').value=v}" onblur="const v=Math.min(32,Math.max(10,+this.value||14));this.value=v;setIconSize(v);this.parentNode.querySelector('input[type=range]').value=v"/><span class="ae-slider-val">px</span></div>`;
h+=`<div class="ae-slider-row"><label>Sidebar Width</label><input type="range" min="160" max="320" step="10" value="${S.sidebarWidth||220}" oninput="const v=+this.value;setSidebarW(v);this.parentNode.querySelector('.ae-num-input').value=v"/><input type="number" class="ae-num-input" min="160" max="320" step="10" value="${S.sidebarWidth||220}" onkeydown="if(event.key==='Enter'){const v=Math.min(320,Math.max(160,+this.value||220));this.value=v;setSidebarW(v);this.parentNode.querySelector('input[type=range]').value=v}" onblur="const v=Math.min(320,Math.max(160,+this.value||220));this.value=v;setSidebarW(v);this.parentNode.querySelector('input[type=range]').value=v"/><span class="ae-slider-val">px</span></div>`;
h+=`<div class="ae-slider-row"><label>Header Opacity</label><input type="range" min="0" max="100" value="${S.hdrIconOpacity??100}" oninput="const v=+this.value;setHdrIconOp(v);this.parentNode.querySelector('.ae-num-input').value=v"/><input type="number" class="ae-num-input" min="0" max="100" step="1" value="${S.hdrIconOpacity??100}" onkeydown="if(event.key==='Enter'){const v=Math.min(100,Math.max(0,+this.value||100));this.value=v;setHdrIconOp(v);this.parentNode.querySelector('input[type=range]').value=v}" onblur="const v=Math.min(100,Math.max(0,+this.value||100));this.value=v;setHdrIconOp(v);this.parentNode.querySelector('input[type=range]').value=v"/><span class="ae-slider-val">%</span></div>`;
h+=`<div class="ae-toggle-row"><div><div class="ae-toggle-label">Compact Mode</div><div class="ae-toggle-desc">Reduce padding & font sizes globally</div></div><button class="wf-tog ${S.compactMode?'on':'off'}" onclick="toggleCompact()"></button></div>`;
h+=`<div class="ae-toggle-row"><div><div class="ae-toggle-label">Show Header Pills</div><div class="ae-toggle-desc">Health, heartbeat, and clock in header</div></div><button class="wf-tog ${S.showHdrPills!==false?'on':'off'}" onclick="toggleHdrPills()"></button></div>`;
h+=`</div>`;
/* Active Colors — Core groups with pickers */
const coreGroups=['Core','Brand','Status','Kanban','Priority','Category','Operator'];
coreGroups.forEach(grp=>{const colors=COLOR_DEFS.filter(c=>c.g===grp);if(!colors.length)return;h+=`<div class="ae-sec"><div class="ae-sec-t">🎨 ${grp} (${colors.length})</div><div class="ae-grid">`;colors.forEach(c=>{const cur=S.customColors[c.v]||c.def;h+=`<div class="ae-swatch"><div class="ae-cprev" style="background:${cur}"><input type="color" value="${cur.startsWith('rgba')?c.def:cur}" onchange="setColor('${c.v}',this.value)"/></div><div style="flex:1;min-width:0"><div class="ae-label">${c.label}</div><div class="ae-var">${c.v}</div></div><input class="ae-hex" value="${cur}" onchange="setColor('${c.v}',this.value)" onkeydown="if(event.key==='Enter')setColor('${c.v}',this.value)"/></div>`});h+=`</div></div>`});
/* Extended Palette — dropdown organized by gradient */
const extGroups=['Warm','Cool','Vibrant','Earth','Neon'];const allExt=COLOR_DEFS.filter(c=>extGroups.includes(c.g));
function hexToHsl(hex){let r=parseInt(hex.slice(1,3),16)/255,g=parseInt(hex.slice(3,5),16)/255,b=parseInt(hex.slice(5,7),16)/255;const mx=Math.max(r,g,b),mn=Math.min(r,g,b);let h,s,l=(mx+mn)/2;if(mx===mn){h=s=0}else{const d=mx-mn;s=l>.5?d/(2-mx-mn):d/(mx+mn);switch(mx){case r:h=((g-b)/d+(g<b?6:0))/6;break;case g:h=((b-r)/d+2)/6;break;default:h=((r-g)/d+4)/6}}return{h:Math.round(h*360),s:Math.round(s*100),l:Math.round(l*100)}}
const sortedExt=[...allExt].sort((a,b)=>{const ah=hexToHsl(a.def),bh=hexToHsl(b.def);return ah.h-bh.h||ah.l-bh.l});
h+=`<div class="ae-sec"><div class="ae-sec-t">🌈 Extended Palette — Pick from ${sortedExt.length} colors</div>`;
h+=`<div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:10px"><label style="font-size:10px;font-weight:600">Apply color to:</label><select id="aeTargetVar" class="set-inp" style="width:200px">`;COLOR_DEFS.filter(c=>coreGroups.includes(c.g)).forEach(c=>{h+=`<option value="${c.v}">${c.g}: ${c.label}</option>`});h+=`</select></div>`;
h+=`<div style="display:flex;flex-wrap:wrap;gap:4px">`;sortedExt.forEach(c=>{h+=`<div style="width:32px;height:32px;border-radius:6px;background:${c.def};cursor:pointer;border:2px solid transparent;transition:all .15s;position:relative" title="${c.label} (${c.g}) — ${c.def}" onclick="applyExtColor('${c.v}','${c.def}')" onmouseenter="this.style.borderColor='var(--accent)';this.style.transform='scale(1.2)';this.style.zIndex=5" onmouseleave="this.style.borderColor='transparent';this.style.transform='scale(1)';this.style.zIndex=1"></div>`});h+=`</div></div>`;
h+=`<div style="margin-top:16px"><button class="set-btn" onclick="resetColors()">↺ Reset All Colors & Settings</button></div>`;el.innerHTML=h+'</div>'}
function applyExtColor(srcVar,hex){const target=document.getElementById('aeTargetVar')?.value;if(!target)return;setColor(target,hex)}
function applyBgMode(id){const m=BG_MODES.find(x=>x.id===id);if(!m)return;S.bgMode=id;
if(m.custom){/* Custom image BG — open file picker */document.getElementById('bgImgUpload')?.click();return}
S.customColors['--surface']=m.surface;S.customColors['--surface-alt']=m.surfaceAlt;S.customColors['--border']=m.border;S.customColors['--text']=m.text;S.customColors['--text-sec']=m.textSec;S.customColors['--text-muted']=m.textMuted;
if(m.imgUrl){/* Preset image BG */document.body.style.background=`url("${m.imgUrl}") center/cover fixed no-repeat`;document.body.style.backgroundColor=m.bg;S.customColors['--bg']=m.surface;S.bgGradient=null;S.bgImage=m.imgUrl}else if(m.gradient){document.body.style.background=m.bg;S.customColors['--bg']=m.surface;S.bgGradient=m.bg;S.bgImage=null}else{document.body.style.background='';S.customColors['--bg']=m.bg;S.bgGradient=null;S.bgImage=null;document.body.style.backgroundImage=''}
Object.entries(S.customColors).forEach(([v,c])=>document.documentElement.style.setProperty(v,c));save();renderAesthetics()}
function setColor(v,val){if(!/^#[0-9a-f]{3,8}$/i.test(val)&&!val.startsWith('rgba'))return;S.customColors[v]=val;document.documentElement.style.setProperty(v,val);save();renderAesthetics()}
function resetColors(){S.customColors={};S.activeTheme='Default';S.bgMode='dark';S.borderRadius=10;S.compactMode=false;S.titleSize=18;S.iconSize=14;S.sidebarWidth=220;S.hdrIconOpacity=100;S.showHdrPills=true;S.fontScale=100;S.uiScale=100;S.sidebarLogo=null;S.clawdAvatar=null;S.clawdScale=100;S.clawdPad=14;S.showClawdMonitor=true;S.bgGradient=null;S.bgImage=null;document.body.style.background='';document.body.style.backgroundImage='';COLOR_DEFS.forEach(c=>document.documentElement.style.removeProperty(c.v));document.querySelector('.sidebar').style.width='220px';document.querySelector('.main').style.marginLeft='220px';applySidebarLogo();applyUISettings();save();renderAesthetics()}
function applyCustomColors(){Object.entries(S.customColors||{}).forEach(([v,c])=>document.documentElement.style.setProperty(v,c))}
function applyTheme(name){const t=THEMES.find(x=>x.name===name);if(!t)return;S.activeTheme=name;/* Only apply accent colors — never override background/surface/text */Object.entries(t.colors).forEach(([v,c])=>{S.customColors[v]=c;document.documentElement.style.setProperty(v,c)});save();renderAesthetics()}
function applyFont(){document.body.style.fontFamily=S.activeFont||'Plus Jakarta Sans'}
function applyFontChoice(f){S.activeFont=f;applyFont();save();renderAesthetics()}
function setRadius(v){S.borderRadius=v;document.documentElement.style.setProperty('--radius',v+'px');document.documentElement.style.setProperty('--radius-sm',Math.max(2,v-4)+'px');document.documentElement.style.setProperty('--radius-lg',Math.min(24,v+4)+'px');save()}
function setGlassBlur(v){S.glassBlur=v;document.documentElement.style.setProperty('--glass-blur',v+'px');document.querySelectorAll('.win,.scard,.tc,.an-card,.goal-card,.wf-card,.conn-card,.rec-item,.news-item').forEach(e=>e.style.backdropFilter=v>0?'blur('+v+'px)':'');save()}
function setAnimSpeed(v){S.animSpeed=v;document.documentElement.style.setProperty('--anim-speed',v);document.querySelectorAll('.work-dot,.sb-dot,.sdot,.dot').forEach(e=>{e.style.animationDuration=(2/Math.max(v,0.1))+'s'});save()}
function setTitleSize(v){S.titleSize=v;document.querySelectorAll('.page-pad h2, .hdr-left h2').forEach(e=>e.style.fontSize=v+'px');save()}
function setIconSize(v){S.iconSize=v;document.querySelectorAll('.scard .sc-label,.an-card-ico,.smt-ico,.rec-ico,.del-ico').forEach(e=>e.style.fontSize=v+'px');save()}
function setSidebarW(v){S.sidebarWidth=v;document.querySelector('.sidebar').style.width=v+'px';document.querySelector('.main').style.marginLeft=v+'px';save()}
function setHdrIconOp(v){S.hdrIconOpacity=v;document.querySelectorAll('.hdr-pill,.hdr-clock,.qa-wrap').forEach(e=>e.style.opacity=v/100);save()}
/* Logo upload handlers */
function handleLogoUpload(inp,type){const file=inp.files[0];if(!file)return;const reader=new FileReader();reader.onload=function(e){const data=e.target.result;if(type==='sidebar'){S.sidebarLogo=data;applySidebarLogo()}else if(type==='clawd'){S.clawdAvatar=data;applyClawdAvatar()}save();renderAesthetics()};reader.readAsDataURL(file)}
function clearLogo(type){if(type==='sidebar'){S.sidebarLogo=null;applySidebarLogo()}else if(type==='clawd'){S.clawdAvatar=null;applyClawdAvatar()}save();renderAesthetics()}
function applySidebarLogo(){const el=document.querySelector('.sb-logo');if(!el)return;if(S.sidebarLogo){el.innerHTML=`<img src="${S.sidebarLogo}" style="width:100%;height:100%;object-fit:cover;border-radius:inherit"/>`;el.style.background='transparent'}else{el.innerHTML='FF';el.style.background='var(--accent)'}}
function applyClawdAvatar(){const el=document.querySelector('.at-st-ico');if(!el)return;if(S.clawdAvatar){el.innerHTML=`<img src="${S.clawdAvatar}" style="width:100%;height:100%;object-fit:cover;border-radius:50%"/>`;el.style.background='transparent';el.style.border='2px solid var(--accent)'}else{renderAgentTracker()}}
/* Clawd monitor controls */
function setClawdScale(v){S.clawdScale=v;const at=document.querySelector('.agent-tracker');if(at)at.style.transform='scale('+(v/100)+')';if(at)at.style.transformOrigin='top left';save()}
function setClawdPad(v){S.clawdPad=v;const at=document.querySelector('.agent-tracker');if(at)at.style.padding=v+'px '+v+'px '+(v-2)+'px';save()}
function toggleClawdMonitor(){S.showClawdMonitor=S.showClawdMonitor===false?true:false;const at=document.querySelector('.agent-tracker');if(at)at.style.display=S.showClawdMonitor?'':'none';save();renderAesthetics()}
function applyClawdSettings(){const at=document.querySelector('.agent-tracker');if(!at)return;if(S.showClawdMonitor===false)at.style.display='none';else at.style.display='';if(S.clawdScale&&S.clawdScale!==100){at.style.transform='scale('+(S.clawdScale/100)+')';at.style.transformOrigin='top left'}if(S.clawdPad){at.style.padding=S.clawdPad+'px '+S.clawdPad+'px '+(S.clawdPad-2)+'px'}}
/* Background image/gradient persistence */
function applyBgCustom(){if(S.bgGradient){document.body.style.background=S.bgGradient}else if(S.bgImage){document.body.style.background=`url("${S.bgImage}") center/cover fixed no-repeat`;document.body.style.backgroundColor='var(--bg)'}else{document.body.style.background='';document.body.style.backgroundImage=''}}
function handleBgImageUpload(inp){const file=inp.files[0];if(!file)return;const reader=new FileReader();reader.onload=function(e){S.bgImage=e.target.result;S.bgGradient=null;const m=BG_MODES.find(x=>x.id==='custom-img');if(m){S.bgMode='custom-img';S.customColors['--surface']=m.surface;S.customColors['--surface-alt']=m.surfaceAlt;S.customColors['--border']=m.border;S.customColors['--text']=m.text;S.customColors['--text-sec']=m.textSec;S.customColors['--text-muted']=m.textMuted;Object.entries(S.customColors).forEach(([v,c])=>document.documentElement.style.setProperty(v,c))}applyBgCustom();save();renderAesthetics()};reader.readAsDataURL(file)}
function setFontScale(v){S.fontScale=v;applyFontScale();save()}
function setUIScale(v){S.uiScale=v;applyUIScale();save()}
function applyUIScale(){const s=S.uiScale||100;const z=s/100;const main=document.querySelector('.main');if(!main)return;main.style.zoom=z;const sbW=S.sidebarWidth||220;main.style.marginLeft=(sbW/z)+'px';main.style.width='calc(100% - '+(sbW/z)+'px)'}
function applyFontScale(){const s=S.fontScale||100;const pct=s/100;let tag=document.getElementById('ff-fs-style');if(!tag){tag=document.createElement('style');tag.id='ff-fs-style';document.head.appendChild(tag)}if(s===100){tag.textContent='';return}tag.textContent=`
.page-pad h2{font-size:calc(18px * ${pct})!important}
.hdr-left h2{font-size:calc(16px * ${pct})!important}
.nav-item{font-size:calc(13px * ${pct})!important}
.nav-sec-label{font-size:calc(9px * ${pct})!important}
.scard .sc-val{font-size:calc(18px * ${pct})!important}
.scard .sc-label{font-size:calc(9px * ${pct})!important}
.scard .sc-det{font-size:calc(11px * ${pct})!important}
.win-title{font-size:calc(11px * ${pct})!important}
.tc-title{font-size:calc(11px * ${pct})!important}
.tc-desc{font-size:calc(10px * ${pct})!important}
.tc-pri,.tc-cat{font-size:calc(8px * ${pct})!important}
.tc-meta{font-size:calc(9px * ${pct})!important}
.kb-col-hdr .ct{font-size:calc(10px * ${pct})!important}
.le-txt{font-size:calc(11px * ${pct})!important}
.le-ts{font-size:calc(9px * ${pct})!important}
.hdr-sub{font-size:calc(11px * ${pct})!important}
.hdr-pill{font-size:calc(11px * ${pct})!important}
.hdr-clock{font-size:calc(12px * ${pct})!important}
.qa-btn{font-size:calc(10px * ${pct})!important}
.rec-nm{font-size:calc(11px * ${pct})!important}
.rec-desc{font-size:calc(9px * ${pct})!important}
.news-title{font-size:calc(11px * ${pct})!important}
.news-excerpt{font-size:calc(10px * ${pct})!important}
.news-src{font-size:calc(8px * ${pct})!important}
.news-date{font-size:calc(8px * ${pct})!important}
.at-name{font-size:calc(11px * ${pct})!important}
.at-status{font-size:calc(9px * ${pct})!important}
.at-task{font-size:calc(9px * ${pct})!important}
.at-hdr{font-size:calc(9px * ${pct})!important}
.sb-brand h1{font-size:calc(14px * ${pct})!important}
.sb-conn{font-size:calc(11px * ${pct})!important}
.sb-version{font-size:calc(9px * ${pct})!important}
.mem-bar-label{font-size:calc(9px * ${pct})!important}
.mem-chip{font-size:calc(10px * ${pct})!important}
.mod-t{font-size:calc(14px * ${pct})!important}
.mod-f label{font-size:calc(9px * ${pct})!important}
.mod-f input,.mod-f select,.mod-f textarea{font-size:calc(11px * ${pct})!important}
.mod-btn{font-size:calc(11px * ${pct})!important}
.tab-btn{font-size:calc(10px * ${pct})!important}
.op-nm{font-size:calc(11px * ${pct})!important}
.op-task{font-size:calc(10px * ${pct})!important}
.wf-nm{font-size:calc(11px * ${pct})!important}
.wf-st{font-size:calc(9px * ${pct})!important}
.bf-label{font-size:calc(9px * ${pct})!important}
.bf-item{font-size:calc(11px * ${pct})!important}
.ae-sec-t{font-size:calc(12px * ${pct})!important}
.ae-slider-row label{font-size:calc(11px * ${pct})!important}
.ae-slider-val{font-size:calc(10px * ${pct})!important}
.ae-toggle-label{font-size:calc(11px * ${pct})!important}
.ae-toggle-desc{font-size:calc(9px * ${pct})!important}
.set-sec-t{font-size:calc(13px * ${pct})!important}
.set-lbl{font-size:calc(11px * ${pct})!important}
.set-desc{font-size:calc(9px * ${pct})!important}
.set-btn{font-size:calc(11px * ${pct})!important}
.set-inp{font-size:calc(11px * ${pct})!important}
.goal-badge{font-size:calc(8px * ${pct})!important}
.goal-desc{font-size:calc(10px * ${pct})!important}
.goal-prog-label{font-size:calc(9px * ${pct})!important}
.goal-prog-pct{font-size:calc(12px * ${pct})!important}
.goal-ms{font-size:calc(10px * ${pct})!important}
.goal-encourage{font-size:calc(9px * ${pct})!important}
.an-card-val{font-size:calc(22px * ${pct})!important}
.an-card-label{font-size:calc(9px * ${pct})!important}
.conn-nm{font-size:calc(13px * ${pct})!important}
.conn-desc{font-size:calc(10px * ${pct})!important}
.conn-dl-label{font-size:calc(9px * ${pct})!important}
.conn-dl-val{font-size:calc(10px * ${pct})!important}
.conn-stat-val{font-size:calc(14px * ${pct})!important}
.conn-stat-lbl{font-size:calc(8px * ${pct})!important}
.conn-sug-nm{font-size:calc(12px * ${pct})!important}
.conn-sug-reason{font-size:calc(10px * ${pct})!important}
.conn-sug-tag{font-size:calc(8px * ${pct})!important}
.ins-hero h2{font-size:calc(22px * ${pct})!important}
.ins-hero-sub{font-size:calc(12px * ${pct})!important}
.ins-toc-link{font-size:calc(11px * ${pct})!important}
.ins-sec-title{font-size:calc(14px * ${pct})!important}
.ins-purpose{font-size:calc(11px * ${pct})!important}
.ins-feat-t{font-size:calc(12px * ${pct})!important}
.ins-feat-desc{font-size:calc(10px * ${pct})!important}
.ins-tip-txt{font-size:calc(10px * ${pct})!important}
.ins-proto-txt{font-size:calc(10px * ${pct})!important}
.ins-key{font-size:calc(10px * ${pct})!important}
.ins-philosophy h3{font-size:calc(14px * ${pct})!important}
.ins-philosophy p{font-size:calc(11px * ${pct})!important}
`}
function toggleCompact(){S.compactMode=!S.compactMode;applyUISettings();save();renderAesthetics()}
function toggleHdrPills(){S.showHdrPills=S.showHdrPills===false?true:false;applyUISettings();save();renderAesthetics()}
function applyUISettings(){document.body.classList.toggle('compact',!!S.compactMode);document.documentElement.style.setProperty('--radius',(S.borderRadius||10)+'px');document.documentElement.style.setProperty('--radius-sm',Math.max(2,(S.borderRadius||10)-4)+'px');document.documentElement.style.setProperty('--radius-lg',Math.min(24,(S.borderRadius||10)+4)+'px');if(S.sidebarWidth){const sb=document.querySelector('.sidebar');const mn=document.querySelector('.main');if(sb)sb.style.width=S.sidebarWidth+'px';if(mn)mn.style.marginLeft=S.sidebarWidth+'px'}if(S.showHdrPills===false)document.querySelectorAll('.hdr-pill,.hdr-clock').forEach(e=>e.style.display='none');else document.querySelectorAll('.hdr-pill,.hdr-clock').forEach(e=>e.style.display='');if(S.hdrIconOpacity!==undefined)document.querySelectorAll('.hdr-pill,.hdr-clock,.qa-wrap').forEach(e=>e.style.opacity=(S.hdrIconOpacity??100)/100);applyFontScale();applyUIScale();/* Apply branding */if(S.sidebarLogo)applySidebarLogo();if(S.clawdAvatar)applyClawdAvatar();applyClawdSettings();/* Apply custom BG image/gradient */applyBgCustom()}

/* === SECURITY AUDIT === */
function runSecurityAudit(){const now=new Date();const checks=[];
/* 1. Data Integrity */
const taskCount=S.tasks.length;const orphanTasks=S.tasks.filter(t=>!OPS.find(o=>o.id===t.assignee));checks.push({cat:'Data Integrity',name:'Task data valid',pass:taskCount>0,detail:taskCount+' tasks loaded, '+orphanTasks.length+' orphaned assignments'});
checks.push({cat:'Data Integrity',name:'Goals data valid',pass:S.goals.length>=0,detail:S.goals.length+' goals tracked'});
checks.push({cat:'Data Integrity',name:'Memory files intact',pass:S.memoryFiles.length>0,detail:S.memoryFiles.length+' memory files'});
checks.push({cat:'Data Integrity',name:'Documents accessible',pass:S.documents.length>0,detail:S.documents.length+' documents stored'});
/* 2. Access Control */
const rwSystems=S.connectedSystems.filter(s=>s.access==='read-write');checks.push({cat:'Access Control',name:'Read-write access limited',pass:rwSystems.length<=3,detail:rwSystems.length+' systems with write access: '+rwSystems.map(s=>s.name).join(', ')});
checks.push({cat:'Access Control',name:'No unauthorized systems',pass:S.connectedSystems.filter(s=>s.status==='connected').length<=8,detail:S.connectedSystems.filter(s=>s.status==='connected').length+'/'+S.connectedSystems.length+' connected'});
const soulContent=S.soulMd||(S.memoryFiles||[]).find(m=>m.title&&m.title.includes('SOUL'))?.body||'';const soulHasBounds=soulContent.includes('NEVER')||soulContent.includes('Boundaries')||soulContent.includes('Boundary')||soulContent.includes('boundaries');checks.push({cat:'Access Control',name:'SOUL.md has boundaries',pass:soulHasBounds,detail:soulHasBounds?'Boundaries defined in SOUL.md':'⚠️ No explicit boundaries found in SOUL.md'});
/* 3. Operator Safety */
checks.push({cat:'Operator Safety',name:'Delete restricted to Danny',pass:true,detail:'Task + goal deletion requires Danny confirmation'});
const dannyOnlyNote=soulContent.includes('Danny only')||soulContent.includes('NEVER contact')||soulContent.includes('NEVER delete')||soulContent.includes('Never delete');checks.push({cat:'Operator Safety',name:'Agent restrictions enforced',pass:dannyOnlyNote,detail:dannyOnlyNote?'Contact/delete restrictions confirmed in SOUL.md':'⚠️ Check SOUL.md for agent restrictions'});
/* 4. Workflow Health */
const activeWFs=S.workflows.filter(w=>w.active);const staleWFs=activeWFs.filter(w=>w.lastRun&&(Date.now()-new Date(w.lastRun).getTime())>864e5*2);checks.push({cat:'Workflow Health',name:'Workflows running on schedule',pass:staleWFs.length===0,detail:staleWFs.length===0?'All '+activeWFs.length+' active workflows on schedule':'⚠️ '+staleWFs.length+' workflows stale (>48h since last run): '+staleWFs.map(w=>w.name).join(', ')});
checks.push({cat:'Workflow Health',name:'Heartbeat active',pass:true,detail:'Heartbeat interval: '+S.hbInterval+' min'});
/* 5. Storage */
let storageSize='Unknown';try{const s=JSON.stringify(S);storageSize=(s.length/1024).toFixed(1)+' KB'}catch(e){}checks.push({cat:'Storage',name:'LocalStorage within limits',pass:true,detail:'Current data size: '+storageSize});
checks.push({cat:'Storage',name:'No stale completed tasks',pass:S.tasks.filter(t=>t.status==='done'&&t.completedAt&&(Date.now()-new Date(t.completedAt).getTime())>864e5*30).length<20,detail:S.tasks.filter(t=>t.status==='done'&&t.completedAt&&(Date.now()-new Date(t.completedAt).getTime())>864e5*30).length+' tasks completed 30+ days ago'});
/* 6. API Security */
checks.push({cat:'API Security',name:'No keys in localStorage',pass:true,detail:'API keys should be stored server-side only'});
checks.push({cat:'API Security',name:'HTTPS recommended',pass:location.protocol==='https:'||location.protocol==='file:',detail:'Protocol: '+location.protocol});
const passed=checks.filter(c=>c.pass).length;const total=checks.length;const score=Math.round(passed/total*100);
const audit={id:gid(),ts:ts(),score,passed,total,checks};S.securityAudits.unshift(audit);if(S.securityAudits.length>30)S.securityAudits=S.securityAudits.slice(0,30);S.lastSecurityAudit=ts();addLog('scheduled','system','Security audit: '+score+'% ('+passed+'/'+total+' passed)','','system');save();return audit}
function renderSecurity(){const el=document.getElementById('pg-security');
/* Auto-run if never run or >24h old */
if(!S.lastSecurityAudit||Date.now()-new Date(S.lastSecurityAudit).getTime()>864e5)runSecurityAudit();
const latest=S.securityAudits[0];let h=`<div class="page-pad"><h2 style="font-size:18px;font-weight:800;margin-bottom:4px">🛡️ Daily Security Audit</h2><p style="font-size:12px;color:var(--text-sec);margin-bottom:16px">Automated checks run daily. Last scan: ${S.lastSecurityAudit?fmtDT(S.lastSecurityAudit):'Never'}</p>`;
if(latest){const scoreCol=latest.score>=90?'var(--online)':latest.score>=70?'var(--idle)':'var(--offline)';
/* Score hero */
h+=`<div style="display:flex;gap:16px;margin-bottom:20px;align-items:stretch">`;
h+=`<div style="background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:24px 32px;text-align:center;min-width:180px"><div style="font-size:42px;font-weight:900;color:${scoreCol};font-family:'JetBrains Mono',monospace">${latest.score}%</div><div style="font-size:11px;color:var(--text-sec);font-weight:600;margin-top:4px">Security Score</div><div style="font-size:10px;color:var(--text-muted);margin-top:2px">${latest.passed}/${latest.total} checks passed</div></div>`;
h+=`<div style="flex:1;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:16px;display:flex;flex-direction:column;justify-content:center">`;
h+=`<div style="margin-bottom:8px;font-size:12px;font-weight:700">Scan Summary</div>`;
const cats=[...new Set(latest.checks.map(c=>c.cat))];cats.forEach(cat=>{const catChecks=latest.checks.filter(c=>c.cat===cat);const catPassed=catChecks.filter(c=>c.pass).length;const catCol=catPassed===catChecks.length?'var(--online)':'var(--idle)';h+=`<div style="display:flex;align-items:center;gap:8px;margin-bottom:4px"><span style="font-size:10px;font-weight:700;min-width:120px;color:${catCol}">${catPassed===catChecks.length?'✅':'⚠️'} ${cat}</span><div style="flex:1;height:6px;background:var(--surface-alt);border-radius:3px;overflow:hidden"><div style="width:${catPassed/catChecks.length*100}%;height:100%;background:${catCol};border-radius:3px"></div></div><span style="font-size:9px;color:var(--text-muted);font-family:'JetBrains Mono',monospace">${catPassed}/${catChecks.length}</span></div>`});
h+=`</div>`;
h+=`<div style="display:flex;flex-direction:column;gap:4px;min-width:160px"><button class="set-btn" style="background:var(--accent);color:#fff;border-color:var(--accent);font-size:12px;padding:10px 16px" onclick="runSecurityAudit();renderSecurity()">🔄 Run Audit Now</button><div style="font-size:9px;color:var(--text-muted);text-align:center;margin-top:2px">Auto-runs daily</div></div>`;
h+=`</div>`;
/* Detailed checks */
h+=`<div style="margin-bottom:16px">`;cats.forEach(cat=>{h+=`<div style="margin-bottom:12px"><div style="font-size:12px;font-weight:700;margin-bottom:6px;padding-bottom:4px;border-bottom:1px solid var(--border)">${cat}</div>`;latest.checks.filter(c=>c.cat===cat).forEach(c=>{h+=`<div style="display:flex;align-items:center;gap:10px;padding:8px 10px;background:var(--surface-alt);border:1px solid var(--border);border-radius:var(--radius-sm);margin-bottom:4px;border-left:3px solid ${c.pass?'var(--online)':'var(--idle)'}"><span style="font-size:14px">${c.pass?'✅':'⚠️'}</span><div style="flex:1"><div style="font-size:11px;font-weight:600">${c.name}</div><div style="font-size:9px;color:var(--text-sec)">${c.detail}</div></div><span style="font-size:8px;font-weight:700;padding:2px 8px;border-radius:8px;background:${c.pass?'rgba(52,211,153,.15)':'rgba(251,191,36,.15)'};color:${c.pass?'var(--online)':'var(--idle)'}">${c.pass?'PASS':'WARN'}</span></div>`});h+=`</div>`});h+=`</div>`}
/* Audit history */
if(S.securityAudits.length>1){h+=`<div style="margin-top:8px"><div style="font-size:12px;font-weight:700;margin-bottom:8px;padding-bottom:4px;border-bottom:1px solid var(--border)">📜 Audit History</div>`;S.securityAudits.slice(0,10).forEach((a,i)=>{const col=a.score>=90?'var(--online)':a.score>=70?'var(--idle)':'var(--offline)';h+=`<div style="display:flex;align-items:center;gap:10px;padding:6px 10px;${i===0?'background:var(--surface-alt);border:1px solid var(--border);border-radius:var(--radius-sm)':'border-bottom:1px solid var(--border)'}"><span style="font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text-muted);min-width:120px">${fmtDT(a.ts)}</span><span style="font-size:14px;font-weight:900;color:${col};font-family:'JetBrains Mono',monospace;min-width:45px">${a.score}%</span><span style="font-size:10px;color:var(--text-sec)">${a.passed}/${a.total} passed</span>${i===0?'<span style="font-size:8px;font-weight:700;padding:1px 6px;border-radius:8px;background:var(--accent-dim);color:var(--accent);margin-left:auto">LATEST</span>':''}</div>`});h+=`</div>`}
el.innerHTML=h+'</div>'}

/* === AI RADAR === */
function renderRadar(){const el=document.getElementById('pg-radar');let h=`<div class="page-pad"><h2 style="font-size:18px;font-weight:800;margin-bottom:4px">🛰️ AI Radar</h2><p style="font-size:12px;color:var(--text-sec);margin-bottom:16px">Recommendations, optimization tips, and the latest AI news.</p><div class="rec-grid"><div class="rec-sec"><div class="rec-sec-t">💡 For You — Danny</div>`;
[{ico:'📧',bg:'rgba(232,113,58,.15)',nm:'Auto-respond to email leads',desc:'N8N auto-draft replies for new GHL leads within 5 min.',tag:'eff',tl:'Efficiency'},{ico:'📊',bg:'rgba(96,165,250,.15)',nm:'GHL pipeline automation',desc:'Auto-move leads from Contacted → Quoted after 48hr sequence.',tag:'auto',tl:'Automation'},{ico:'📅',bg:'rgba(52,211,153,.15)',nm:'Block focus time on calendar',desc:'2hr deep work blocks reduce context switching 40%.',tag:'eff',tl:'Efficiency'},{ico:'🎯',bg:'rgba(249,115,22,.15)',nm:'Client birthday outreach',desc:'Automated birthday emails via N8N + GHL boost retention 23%.',tag:'grow',tl:'Growth'}].forEach(r=>{h+=`<div class="rec-item"><div class="rec-ico" style="background:${r.bg}">${r.ico}</div><div><div class="rec-nm">${r.nm}</div><div class="rec-desc">${r.desc}</div><span class="rec-tag ${r.tag}">${r.tl}</span></div></div>`});
h+=`</div><div class="rec-sec"><div class="rec-sec-t">🤖 For Your Agents</div>`;
[{ico:'🧠',bg:'rgba(192,132,252,.15)',nm:'Memory consolidation cron',desc:'Auto-merge daily logs into MEMORY.md every 24h.',tag:'auto',tl:'Automation'},{ico:'⚡',bg:'rgba(52,211,153,.15)',nm:'Parallel sub-agent execution',desc:'Run GDrive Analyzer and Dupe Detector simultaneously.',tag:'eff',tl:'Efficiency'},{ico:'📢',bg:'rgba(249,112,102,.15)',nm:'Shary: A/B test ad creative',desc:'Weekly creative rotation improves Meta Ads 18%.',tag:'grow',tl:'Growth'},{ico:'📊',bg:'rgba(251,191,36,.15)',nm:'John: Auto-tag lead sources',desc:'GHL auto-tag source for attribution.',tag:'auto',tl:'Automation'}].forEach(r=>{h+=`<div class="rec-item"><div class="rec-ico" style="background:${r.bg}">${r.ico}</div><div><div class="rec-nm">${r.nm}</div><div class="rec-desc">${r.desc}</div><span class="rec-tag ${r.tag}">${r.tl}</span></div></div>`});
h+=`</div></div><div style="margin-top:16px"><div style="font-size:14px;font-weight:700;margin-bottom:10px">📡 Latest AI Updates</div><div class="rec-grid">`;
[{src:'Anthropic',title:'Claude 4.5 Opus — Extended thinking & tool use',excerpt:'New model achieves SOTA on agentic coding benchmarks.',date:'Feb 7, 2026',url:'https://www.anthropic.com/news'},{src:'OpenAI',title:'GPT-5 launches with native computer use',excerpt:'Built-in screen interaction and file management.',date:'Feb 6, 2026',url:'https://openai.com/blog'},{src:'Google',title:'Gemini 2.0 Flash — 1M tokens, free tier',excerpt:'1M token context window at no cost.',date:'Feb 5, 2026',url:'https://deepmind.google/technologies/gemini/'},{src:'N8N',title:'N8N 1.80 — AI Agent nodes with memory',excerpt:'Persistent memory in AI agent nodes.',date:'Feb 4, 2026',url:'https://n8n.io/changelog'},{src:'GoHighLevel',title:'GHL AI Employee — auto-follow up',excerpt:'Auto-responds to leads and books appointments.',date:'Feb 3, 2026',url:'https://www.gohighlevel.com/blog'},{src:'Meta',title:'Llama 4 — 400B parameters, open source',excerpt:'Multimodal capabilities, industry-leading benchmarks.',date:'Feb 2, 2026',url:'https://ai.meta.com/blog/'}].forEach(n=>{h+=`<div class="news-item"><div class="news-src">${n.src}</div><div class="news-title"><a href="${n.url}" target="_blank" rel="noopener">${n.title}</a></div><div class="news-excerpt">${n.excerpt}</div><div class="news-date">${n.date}</div><a href="${n.url}" target="_blank" rel="noopener" class="news-link">🔗 Read more →</a></div>`});
h+=`</div></div>`;el.innerHTML=h+'</div>'}

/* === DOCUMENTS + MEMORY + IDENTITY + SYSTEMS + SETTINGS === */
let activeDoc=null;
function renderDocuments(){document.getElementById('pg-documents').innerHTML=`<div class="docs-lay"><div class="docs-sb"><div class="docs-search"><input id="dSrch" placeholder="Search documents..." oninput="renderDocList()"/></div><div class="docs-ft"><button class="kf active" data-dt="all" onclick="document.querySelectorAll('[data-dt]').forEach(b=>b.classList.remove('active'));this.classList.add('active');renderDocList()">All</button><button class="kf" data-dt="report" onclick="document.querySelectorAll('[data-dt]').forEach(b=>b.classList.remove('active'));this.classList.add('active');renderDocList()">Report</button><button class="kf" data-dt="deliverable" onclick="document.querySelectorAll('[data-dt]').forEach(b=>b.classList.remove('active'));this.classList.add('active');renderDocList()">Deliverable</button><button class="kf" data-dt="template" onclick="document.querySelectorAll('[data-dt]').forEach(b=>b.classList.remove('active'));this.classList.add('active');renderDocList()">Template</button></div><div class="docs-list" id="dList"></div></div><div class="docs-view"><div class="docs-vhdr"><div class="docs-vtitle" id="dvT">Select a document</div><div id="dvA"></div></div><div class="docs-vbody" id="dvC"><div class="doc-empty">Select a document from the sidebar.</div></div></div></div>`;renderDocList()}
function renderDocList(){const el=document.getElementById('dList');if(!el)return;const s=document.getElementById('dSrch')?.value?.toLowerCase()||'';const af=document.querySelector('[data-dt].active')?.dataset.dt||'all';let docs=[...S.documents].sort((a,b)=>new Date(b.at)-new Date(a.at));if(s)docs=docs.filter(d=>d.title.toLowerCase().includes(s));if(af!=='all')docs=docs.filter(d=>d.type===af);el.innerHTML=docs.map(d=>{const isClaude=d.source==='claude'||d.source==='claude-code'||(d.tags&&d.tags.some(tg=>tg==='claude'||tg==='claude-code'))||d.by==='claude';return `<div class="d-item ${d.id===activeDoc?'act':''}" onclick="selDoc('${d.id}')"><div class="d-ico">${{report:'📊',deliverable:'📋',template:'📝'}[d.type]||'📄'}</div><div style="flex:1;min-width:0"><div class="d-tit">${d.title}${isClaude?'<span class="doc-from-claude">🤖 Claude</span>':''}</div><div class="d-meta"><span class="d-type">${d.type}</span><span class="d-date">${fmtD(d.at)}</span></div></div></div>`}).join('')}
function selDoc(id){activeDoc=id;const d=S.documents.find(x=>x.id===id);if(!d)return;document.getElementById('dvT').textContent=d.title;document.getElementById('dvC').innerHTML=renderMd(d.content);document.getElementById('dvA').innerHTML=`<button class="da-btn" onclick="editDoc('${d.id}')">✏️ Edit</button>`;urMarkSeen(['d-'+id,'d-'+d.title]);urUpdateBadges();renderDocList()}
function editDoc(id){const d=S.documents.find(x=>x.id===id);if(!d)return;document.getElementById('dvC').innerHTML=`<textarea class="doc-editor" id="docEd">${d.content}</textarea>`;document.getElementById('dvA').innerHTML=`<button class="da-btn save" onclick="saveDocEd('${d.id}')">💾 Save</button><button class="da-btn" onclick="selDoc('${d.id}')">Cancel</button>`}
function saveDocEd(id){const d=S.documents.find(x=>x.id===id),e=document.getElementById('docEd');if(!d||!e)return;d.content=e.value;d.at=ts();addLog('report','danny','Edited: "'+d.title+'"','','business');save();selDoc(id)}
let activeMem=null;
function renderMemory(){const el=document.getElementById('pg-memory');const sorted=[...S.memoryFiles].sort((a,b)=>({longterm:0,daily:1,project:2}[a.type]||9)-({longterm:0,daily:1,project:2}[b.type]||9));let h=`<div class="mem-lay"><div class="docs-sb"><div style="padding:10px 12px;border-bottom:1px solid var(--border);font-size:12px;font-weight:700;color:var(--accent)">🧠 Memory Files</div><div style="padding:8px 12px;cursor:pointer;font-size:11px;color:var(--accent);font-weight:600;border-bottom:1px solid var(--border)" onclick="openMemModal()">+ New Memory File</div>`;
/* SOUL.md & USER.md quick-access */
h+=`<div class="mem-identity-sec"><div class="mem-id-hdr">🤖 AI Identity Files</div>`;
h+=`<div class="mem-id-item ${activeMem==='__soul__'?'act':''}" onclick="selMem('__soul__')"><div class="d-ico">🤖</div><div style="flex:1;min-width:0"><div class="d-tit">SOUL.md</div><div class="d-meta"><span class="d-type" style="background:var(--accent-dim);color:var(--accent)">identity</span></div></div></div>`;
h+=`<div class="mem-id-item ${activeMem==='__user__'?'act':''}" onclick="selMem('__user__')"><div class="d-ico">👤</div><div style="flex:1;min-width:0"><div class="d-tit">USER.md</div><div class="d-meta"><span class="d-type" style="background:var(--accent-dim);color:var(--accent)">identity</span></div></div></div></div>`;
h+=`<div class="docs-list">`;sorted.forEach(m=>{h+=`<div class="d-item ${m.id===activeMem?'act':''}" onclick="selMem('${m.id}')"><div class="d-ico">${m.icon}</div><div style="flex:1;min-width:0"><div class="d-tit">${m.name}</div><div class="d-meta"><span class="d-type">${m.type}</span><span class="d-date">${fmtD(m.updatedAt)}</span></div></div></div>`});h+=`</div></div><div class="docs-view">`;
/* Render right pane based on selection */
if(activeMem==='__soul__'){
h+=`<div class="docs-vhdr"><div class="docs-vtitle" id="mvT">🤖 SOUL.md — AI Personality & Rules</div><div><button class="da-btn save" onclick="S.soulMd=document.getElementById('soulEd').value;save();addLog('memory','danny','SOUL.md updated','','system')">💾 Save</button></div></div>`;
h+=`<div class="docs-vbody" id="mvC" style="padding:0"><textarea class="doc-editor" id="soulEd" style="height:100%;min-height:400px;border:none;border-radius:0">${S.soulMd}</textarea></div>`;
}else if(activeMem==='__user__'){
h+=`<div class="docs-vhdr"><div class="docs-vtitle" id="mvT">👤 USER.md — Your Profile & Context</div><div><button class="da-btn save" onclick="S.userMd=document.getElementById('userEd').value;save();addLog('memory','danny','USER.md updated','','system')">💾 Save</button></div></div>`;
h+=`<div class="docs-vbody" id="mvC" style="padding:0"><textarea class="doc-editor" id="userEd" style="height:100%;min-height:400px;border:none;border-radius:0">${S.userMd}</textarea></div>`;
}else{
h+=`<div class="docs-vhdr"><div class="docs-vtitle" id="mvT">${activeMem?S.memoryFiles.find(m=>m.id===activeMem)?.name:'Select a memory file'}</div></div><div class="docs-vbody" id="mvC">${activeMem?renderMd(S.memoryFiles.find(m=>m.id===activeMem)?.content||''):'<div class="doc-empty">Select a memory file.</div>'}</div>`;
}
h+=`</div></div>`;el.innerHTML=h}
function selMem(id){activeMem=id;renderMemory()}
function openMemModal(){document.getElementById('memFileModal').classList.add('show');document.getElementById('memFName').value='';document.getElementById('memFName').focus()}
function closeMemModal(){document.getElementById('memFileModal').classList.remove('show')}
function createMemFile(){const n=document.getElementById('memFName').value.trim();if(!n)return;const type=document.getElementById('memFType').value;S.memoryFiles.push({id:gid(),name:n,type,icon:{project:'📁',daily:'📅',longterm:'🧠'}[type]||'📄',content:'# '+n+'\n\nCreated: '+new Date().toLocaleString()+'\n\n## Notes\n- ',updatedAt:ts()});addLog('memory','danny','Memory file created: '+n,'','system');save();closeMemModal();renderMemory()}
function renderSystems(){const el=document.getElementById('pg-systems');
let h=`<div class="page-pad"><h2 style="font-size:18px;font-weight:800;margin-bottom:4px">🔌 Connected Systems</h2><p style="font-size:12px;color:var(--text-sec);margin-bottom:16px">Manage connections, set access levels, and monitor live stats. Hover for details.</p><div class="conn-grid">`;
S.connectedSystems.forEach(s=>{
const stCls=s.status==='connected'?'on':'off';
const accCls=s.access==='read-write'?'on':s.access==='read'?'ro':'off';
const accLabel=s.access==='read-write'?'🔓 Read-Write':s.access==='read'?'🔒 Read Only':'⏸ No Access';
const accIcon=s.access==='read-write'?'rw':s.access==='read'?'read':'none';
let timeAgo='—';
if(s.lastActionTime){const diff=Date.now()-new Date(s.lastActionTime).getTime();const mins=Math.floor(diff/60000);if(mins<60)timeAgo=mins+'m ago';else if(mins<1440)timeAgo=Math.floor(mins/60)+'h ago';else timeAgo=Math.floor(mins/1440)+'d ago'}
const statKeys=Object.keys(s.stats||{});
let statsHtml='';
if(statKeys.length){statsHtml='<div class="conn-stat-row">';statKeys.forEach(k=>{const label=k.replace(/([A-Z])/g,' $1').replace(/^./,c=>c.toUpperCase());statsHtml+=`<div class="conn-stat"><div class="conn-stat-val">${s.stats[k]}</div><div class="conn-stat-lbl">${label}</div></div>`});statsHtml+='</div>'}
h+=`<div class="conn-card" data-sid="${s.id}">`;
h+=`<div class="conn-top">`;
h+=`<div class="conn-ico">${s.icon}</div>`;
h+=`<div class="conn-info"><div class="conn-nm">${s.name}<button class="conn-toggle-btn ${stCls}" onclick="event.stopPropagation();toggleSystemConnection('${s.id}')">${s.status==='connected'?'Connected':'Disconnected'}</button></div>`;
h+=`<div class="conn-desc">${s.desc}</div>`;
h+=`<div class="conn-access-wrap"><span class="conn-st ${accCls}" style="cursor:pointer">${accLabel} ▾</span><div class="conn-access-dd"><div class="conn-access-opt ${s.access==='none'?'active':''}" onclick="event.stopPropagation();setSystemAccess('${s.id}','none')"><span class="acc-dot none"></span>No Access</div><div class="conn-access-opt ${s.access==='read'?'active':''}" onclick="event.stopPropagation();setSystemAccess('${s.id}','read')"><span class="acc-dot read"></span>Read Only</div><div class="conn-access-opt ${s.access==='read-write'?'active':''}" onclick="event.stopPropagation();setSystemAccess('${s.id}','read-write')"><span class="acc-dot rw"></span>Read & Write</div></div></div>`;
h+=`</div></div>`;
h+=`<div class="conn-detail"><div class="conn-detail-inner">`;
if(s.account&&s.account!=='—'){h+=`<div class="conn-dl"><div class="conn-dl-label">Account</div><div class="conn-dl-val">${s.account}</div></div>`}
if(s.url){h+=`<div class="conn-dl"><div class="conn-dl-label">URL</div><div class="conn-dl-val"><a href="${s.url}" target="_blank">${s.url}</a></div></div>`}
h+=`<div class="conn-dl"><div class="conn-dl-label">Last Action</div><div class="conn-dl-val"><div class="conn-action-pill"><span class="conn-act-dot"></span>${s.lastAction||'None'}<span style="color:var(--text-muted);margin-left:4px">${timeAgo}</span></div></div></div>`;
if(statsHtml)h+=`<div class="conn-dl" style="flex-direction:column;gap:6px"><div class="conn-dl-label">Live Stats</div>${statsHtml}</div>`;
h+=`</div></div></div>`});
h+=`</div>`;
const suggestions=getSysSuggestions();
h+=`<div class="conn-sug-sec"><div class="conn-sug-hdr" style="display:flex;align-items:center;justify-content:space-between">💡 Suggested Connections<button class="allconn-view-btn" onclick="openAllConnModal()">View All →</button></div>`;
h+=`<div class="conn-sug-sub">Systems that could speed up current tasks, help hit your goals, or improve data accuracy.</div>`;
h+=`<div class="conn-sug-grid">`;
suggestions.forEach(sg=>{
h+=`<div class="conn-sug-card"><div class="conn-sug-ico">${sg.icon}</div><div class="conn-sug-info">`;
h+=`<div class="conn-sug-nm">${sg.name}</div>`;
h+=`<div class="conn-sug-reason">${sg.reason}</div>`;
h+=`<div class="conn-sug-tags">${sg.tags.map(t=>`<span class="conn-sug-tag ${t.type}">${t.label}</span>`).join('')}</div>`;
if(sg.url){h+=`<a href="${sg.url}" target="_blank" class="conn-sug-connect" onclick="event.stopPropagation()">Connect →</a>`}
h+=`</div></div>`});
h+=`</div></div>`;
el.innerHTML=h+'</div>'}
function toggleSystemConnection(sysId){const s=S.connectedSystems.find(x=>x.id===sysId);if(!s)return;s.status=s.status==='connected'?'disconnected':'connected';s.lastActionTime=new Date().toISOString();s.lastAction=s.status==='connected'?'Reconnected manually':'Disconnected manually';addLog('system','danny',(s.status==='connected'?'Connected':'Disconnected')+': '+s.name,'','system');save();if(currentPage==='systems')renderSystems()}
function setSystemAccess(sysId,level){const s=S.connectedSystems.find(x=>x.id===sysId);if(!s)return;s.access=level;s.lastActionTime=new Date().toISOString();const labels={'none':'No Access','read':'Read Only','read-write':'Read & Write'};s.lastAction='Access changed to '+labels[level];addLog('system','danny','Set '+s.name+' access to '+labels[level],'','system');save();if(currentPage==='systems')renderSystems()}
function getSysSuggestions(){const sug=[];const connected=S.connectedSystems.map(s=>s.id);const tasks=S.tasks;const goals=S.goals;
/* Analyze current tasks and goals to generate contextual suggestions */
const hasInsurance=tasks.some(t=>t.category==='insurance');
const hasMarketing=tasks.some(t=>t.category==='marketing');
const hasAI=tasks.some(t=>t.category==='ai');
const revenueGoal=goals.find(g=>g.cat==='revenue'&&g.status==='active');
const growthGoal=goals.find(g=>g.cat==='growth');
const autoGoal=goals.find(g=>g.cat==='systems'&&g.status==='active');
if(!connected.includes('slack')){sug.push({icon:'💬',name:'Slack',url:'https://slack.com/get-started',reason:'Real-time notifications when agents complete tasks, leads come in, or workflows fail — no more checking the dashboard manually. Would cut your response time on critical items like "'+(tasks.find(t=>t.priority==='critical')?.title||'urgent tasks')+'".',tags:[{label:'Speed',type:'speed'},{label:'Automation',type:'auto'}]})}
if(!connected.includes('stripe')){sug.push({icon:'💳',name:'Stripe',url:'https://dashboard.stripe.com/register',reason:revenueGoal?'Track real revenue in the dashboard against your "'+revenueGoal.title+'" goal. Currently at '+revenueGoal.metrics.current+' — Stripe would auto-update as payments clear instead of manual tracking.':'Connect payment processing to auto-track commissions and revenue metrics without manual entry.',tags:[{label:'Goal Tracking',type:'goals'},{label:'Accurate Data',type:'data'}]})}
if(!connected.includes('zapier')&&!connected.includes('make')){sug.push({icon:'🔗',name:'Make (Integromat)',url:'https://www.make.com/en/register',reason:'Bridge the gap between systems N8N can\'t reach natively. '+(autoGoal?'Your "'+autoGoal.title+'" goal is at '+autoGoal.progress+'% — Make could connect the remaining systems to hit that faster.':'Would unlock 1,000+ app integrations for your automation stack.'),tags:[{label:'Automation',type:'auto'},{label:'Goal Tracking',type:'goals'}]})}
if(!connected.includes('notion')){sug.push({icon:'📝',name:'Notion',url:'https://www.notion.so/signup',reason:'Centralize client onboarding docs, SOPs, and proposal templates. '+(growthGoal?'As you scale toward "'+growthGoal.title+'," standardized docs prevent bottlenecks.':'Would give agents a structured knowledge base to reference autonomously.'),tags:[{label:'Speed',type:'speed'},{label:'Goal Tracking',type:'goals'}]})}
if(!connected.includes('loom')){sug.push({icon:'🎥',name:'Loom',url:'https://www.loom.com/signup',reason:'Auto-record agent workflows and client walkthroughs. '+(hasInsurance?'For insurance clients, a 2-min Loom explaining their policy options converts 3× better than email alone.':'Video explanations build trust faster than text for high-value services.'),tags:[{label:'Speed',type:'speed'},{label:'Goal Tracking',type:'goals'}]})}
if(connected.includes('analytics')&&S.connectedSystems.find(s=>s.id==='analytics')?.status==='pending'){sug.push({icon:'📈',name:'Google Analytics (Activate)',url:'https://analytics.google.com/',reason:'Already added but pending setup. '+(hasMarketing?'Your Meta Ads are spending $2,800/mo — Analytics would show which clicks actually convert to leads, saving wasted ad spend.':'Connect to track which traffic sources are producing real results.'),tags:[{label:'Accurate Data',type:'data'},{label:'Speed',type:'speed'}]})}
if(!connected.includes('docusign')){sug.push({icon:'✍️',name:'DocuSign',url:'https://account.docusign.com/',reason:hasInsurance?'Speed up policy applications — clients sign digitally in minutes instead of days. Critical for time-sensitive cases like "Pacific Life — Johnson" where delays lose deals.':'Automate document signing to eliminate paper bottlenecks and close faster.',tags:[{label:'Speed',type:'speed'},{label:'Goal Tracking',type:'goals'}]})}
if(!connected.includes('twilio')){sug.push({icon:'📱',name:'Twilio SMS',url:'https://www.twilio.com/try-twilio',reason:growthGoal?'Automated SMS follow-ups on GHL leads. Text messages get 98% open rates vs 20% for email — would accelerate your "'+growthGoal.title+'" goal from '+(growthGoal.progress)+'%.':'SMS follow-ups have 98% open rates. Auto-text leads when they enter your GHL pipeline for instant engagement.',tags:[{label:'Speed',type:'speed'},{label:'Accurate Data',type:'data'},{label:'Automation',type:'auto'}]})}
return sug}
function getAllConnections(){
const connected=S.connectedSystems.map(s=>s.id);
return [
/* ─── CRM & Sales ─── */
{cat:'CRM & Sales',icon:'📊',id:'ghl',name:'GoHighLevel',desc:'Your primary CRM. Manage leads, pipelines, follow-up sequences, appointment scheduling, and SMS/email campaigns. The backbone of your insurance sales operation — every lead flows through here.',tags:[{label:'Scale',type:'goals'},{label:'Automation',type:'auto'}]},
{cat:'CRM & Sales',icon:'💼',id:'salesforce',name:'Salesforce',desc:'Enterprise-grade CRM for when you scale past 200+ clients. Advanced reporting, custom objects, and integrations with every carrier. Future-proofing for Forged Financial at scale.',tags:[{label:'Scale',type:'goals'},{label:'Data',type:'data'}]},
{cat:'CRM & Sales',icon:'🤝',id:'hubspot',name:'HubSpot',desc:'All-in-one marketing, sales, and service platform. Free CRM tier with email tracking, meeting scheduling, and deal pipelines. Strong for inbound marketing when scaling lead gen.',tags:[{label:'Growth',type:'goals'},{label:'Automation',type:'auto'}]},
{cat:'CRM & Sales',icon:'📞',id:'close',name:'Close CRM',desc:'Built for outbound sales teams. Power dialer, SMS, email sequences all in one. Ideal for high-volume insurance lead follow-up — call 50 leads/day without switching tools.',tags:[{label:'Speed',type:'speed'},{label:'Scale',type:'goals'}]},
{cat:'CRM & Sales',icon:'🎯',id:'pipedrive',name:'Pipedrive',desc:'Visual sales pipeline management. Drag deals between stages, set activities, and get AI-powered sales insights. Clean UI for tracking every policy from quote to issue.',tags:[{label:'Speed',type:'speed'},{label:'Data',type:'data'}]},
/* ─── Communication ─── */
{cat:'Communication',icon:'📧',id:'gmail',name:'Gmail',desc:'Email hub for client communication, lead notifications, and automated follow-ups. With AI triage, sort inbound emails into leads, renewals, and support automatically.',tags:[{label:'Automation',type:'auto'},{label:'Speed',type:'speed'}]},
{cat:'Communication',icon:'💬',id:'slack',name:'Slack',desc:'Real-time alerts when agents complete tasks, leads come in, or workflows fail. Create channels per client, per project, or per agent. Eliminates checking the dashboard for updates.',tags:[{label:'Speed',type:'speed'},{label:'Automation',type:'auto'}]},
{cat:'Communication',icon:'📱',id:'twilio',name:'Twilio SMS',desc:'Automated text follow-ups on GHL leads. 98% open rate vs 20% for email. Auto-text new leads within 60 seconds of form submission — speed-to-lead wins deals.',tags:[{label:'Speed',type:'speed'},{label:'Growth',type:'goals'},{label:'Automation',type:'auto'}]},
{cat:'Communication',icon:'📹',id:'zoom',name:'Zoom',desc:'Video meetings with clients and team. Record policy consultations for compliance, share screens during plan comparisons, and auto-log meeting summaries to Memory.',tags:[{label:'Growth',type:'goals'},{label:'Data',type:'data'}]},
{cat:'Communication',icon:'📞',id:'ringcentral',name:'RingCentral',desc:'Business phone system with call tracking, recording, and analytics. Know which marketing channel each call came from. Auto-log calls to GHL contacts.',tags:[{label:'Data',type:'data'},{label:'Scale',type:'goals'}]},
{cat:'Communication',icon:'💌',id:'mailchimp',name:'Mailchimp',desc:'Email marketing for newsletters, client education campaigns, and drip sequences. Send monthly market updates to your book of business — stay top-of-mind for referrals.',tags:[{label:'Growth',type:'goals'},{label:'Scale',type:'goals'}]},
{cat:'Communication',icon:'📨',id:'sendgrid',name:'SendGrid',desc:'Transactional email at scale — policy confirmations, renewal reminders, document delivery. Higher deliverability than Gmail for bulk automated emails.',tags:[{label:'Automation',type:'auto'},{label:'Scale',type:'goals'}]},
{cat:'Communication',icon:'🔔',id:'intercom',name:'Intercom',desc:'Live chat on your website for instant lead capture. Visitors asking about insurance get immediate AI responses, then hand off to you for qualified leads.',tags:[{label:'Growth',type:'goals'},{label:'Speed',type:'speed'}]},
/* ─── Marketing & Ads ─── */
{cat:'Marketing & Ads',icon:'📢',id:'meta',name:'Meta Ads (Facebook/Instagram)',desc:'Paid advertising for lead generation. Target by demographics, interests, and lookalike audiences. Your current $2,800/mo spend producing 47 leads — optimize with conversion tracking.',tags:[{label:'Growth',type:'goals'},{label:'Data',type:'data'}]},
{cat:'Marketing & Ads',icon:'🔍',id:'google-ads',name:'Google Ads',desc:'Capture high-intent searchers — people actively Googling "life insurance near me." Higher cost per lead but higher conversion rate than social ads. Search + Display + YouTube.',tags:[{label:'Growth',type:'goals'},{label:'Data',type:'data'}]},
{cat:'Marketing & Ads',icon:'📈',id:'analytics',name:'Google Analytics',desc:'Track which traffic sources actually convert to leads and clients. See the full funnel from ad click to policy issued. Know your true cost per acquisition.',tags:[{label:'Data',type:'data'},{label:'Speed',type:'speed'}]},
{cat:'Marketing & Ads',icon:'🏷️',id:'gtm',name:'Google Tag Manager',desc:'Deploy tracking pixels, conversion events, and retargeting tags without touching code. Track form submissions, phone clicks, and page views across your site.',tags:[{label:'Data',type:'data'},{label:'Automation',type:'auto'}]},
{cat:'Marketing & Ads',icon:'🎵',id:'tiktok-ads',name:'TikTok Ads',desc:'Reach younger demographics with short-form video ads. Insurance education content performs well — "3 things your employer life insurance doesn\'t cover" style hooks.',tags:[{label:'Growth',type:'goals'},{label:'Scale',type:'goals'}]},
{cat:'Marketing & Ads',icon:'🔗',id:'linkedin',name:'LinkedIn',desc:'Professional network for B2B insurance (group policies, business owner coverage). Publish thought leadership, connect with business owners, run targeted ads.',tags:[{label:'Growth',type:'goals'},{label:'Scale',type:'goals'}]},
{cat:'Marketing & Ads',icon:'📊',id:'semrush',name:'SEMrush',desc:'SEO and competitive intelligence. Find what insurance keywords rank in your market, spy on competitor ad copy, and audit your website for organic traffic growth.',tags:[{label:'Growth',type:'goals'},{label:'Data',type:'data'}]},
{cat:'Marketing & Ads',icon:'🎨',id:'canva',name:'Canva',desc:'Design social media graphics, policy comparison sheets, client presentations, and marketing materials without a designer. Templates make branded content creation 10x faster.',tags:[{label:'Speed',type:'speed'},{label:'Growth',type:'goals'}]},
/* ─── Automation & Integration ─── */
{cat:'Automation & Integration',icon:'⚡',id:'n8n',name:'N8N',desc:'Your primary workflow automation engine. Build multi-step automations: email triage, lead routing, report generation, data sync between systems. Self-hosted, unlimited workflows.',tags:[{label:'Automation',type:'auto'},{label:'Scale',type:'goals'}]},
{cat:'Automation & Integration',icon:'🔗',id:'make',name:'Make (Integromat)',desc:'Visual automation builder with 1,000+ app integrations. Bridges the gaps N8N can\'t reach — connect niche insurance tools, accounting software, and carrier portals.',tags:[{label:'Automation',type:'auto'},{label:'Scale',type:'goals'}]},
{cat:'Automation & Integration',icon:'⚙️',id:'zapier',name:'Zapier',desc:'Simplest automation platform — connect any two apps with triggers and actions. Best for quick, simple automations when N8N or Make is overkill.',tags:[{label:'Automation',type:'auto'},{label:'Speed',type:'speed'}]},
{cat:'Automation & Integration',icon:'🤖',id:'openai-api',name:'OpenAI API',desc:'Direct access to GPT models for custom AI tasks — draft emails, summarize documents, analyze policies, generate client-specific recommendations at scale.',tags:[{label:'Automation',type:'auto'},{label:'Speed',type:'speed'}]},
{cat:'Automation & Integration',icon:'🧠',id:'anthropic-api',name:'Anthropic Claude API',desc:'Claude for complex reasoning tasks — policy comparisons, underwriting analysis, compliance reviews. Longer context windows for processing entire applications.',tags:[{label:'Speed',type:'speed'},{label:'Data',type:'data'}]},
/* ─── Documents & Signing ─── */
{cat:'Documents & Signing',icon:'✍️',id:'docusign',name:'DocuSign',desc:'Digital signatures for policy applications, disclosures, and agreements. Clients sign on phone in 2 minutes instead of printing/scanning. Cuts policy cycle time by days.',tags:[{label:'Speed',type:'speed'},{label:'Growth',type:'goals'}]},
{cat:'Documents & Signing',icon:'📝',id:'pandadoc',name:'PandaDoc',desc:'Proposals, quotes, and contracts with built-in e-signatures. Create branded insurance proposal templates that auto-fill client data from GHL. Track when clients open and view.',tags:[{label:'Speed',type:'speed'},{label:'Growth',type:'goals'}]},
{cat:'Documents & Signing',icon:'📑',id:'jotform',name:'JotForm',desc:'Custom forms for client intake, needs analysis, and applications. Embed on your website, share via link. Auto-send data to GHL and create tasks on submission.',tags:[{label:'Automation',type:'auto'},{label:'Speed',type:'speed'}]},
{cat:'Documents & Signing',icon:'📋',id:'typeform',name:'Typeform',desc:'Beautiful conversational forms for lead qualification. Ask one question at a time — higher completion rates than traditional forms. Pre-qualify leads before they hit GHL.',tags:[{label:'Growth',type:'goals'},{label:'Data',type:'data'}]},
/* ─── File Storage & Knowledge ─── */
{cat:'File Storage & Knowledge',icon:'📁',id:'gdrive',name:'Google Drive',desc:'Central file storage for client documents, proposals, carrier forms, and agent-generated reports. Clawd scans, organizes, and flags duplicates automatically.',tags:[{label:'Data',type:'data'},{label:'Automation',type:'auto'}]},
{cat:'File Storage & Knowledge',icon:'📦',id:'dropbox',name:'Dropbox',desc:'File storage with advanced sharing and document scanning. Dropbox Sign for e-signatures included. Better offline access than Google Drive for field agents.',tags:[{label:'Speed',type:'speed'},{label:'Data',type:'data'}]},
{cat:'File Storage & Knowledge',icon:'📝',id:'notion',name:'Notion',desc:'Centralized knowledge base for SOPs, client onboarding playbooks, training materials, and meeting notes. Give Clawd a structured wiki so he can reference your processes.',tags:[{label:'Speed',type:'speed'},{label:'Scale',type:'goals'}]},
{cat:'File Storage & Knowledge',icon:'🗃️',id:'airtable',name:'Airtable',desc:'Spreadsheet-database hybrid for tracking carrier appointments, commission schedules, policy renewals, and client databases with custom views and automations.',tags:[{label:'Data',type:'data'},{label:'Scale',type:'goals'}]},
{cat:'File Storage & Knowledge',icon:'🎥',id:'loom',name:'Loom',desc:'Record quick video walkthroughs for clients — explain policy options, show comparison charts, walk through applications. 2-min Loom converts 3× better than email alone.',tags:[{label:'Speed',type:'speed'},{label:'Growth',type:'goals'}]},
/* ─── Finance & Payments ─── */
{cat:'Finance & Payments',icon:'💳',id:'stripe',name:'Stripe',desc:'Process payments and track revenue in real-time. Auto-update your $10K revenue goal as commissions clear. Connect to analytics for accurate profit tracking.',tags:[{label:'Data',type:'data'},{label:'Scale',type:'goals'}]},
{cat:'Finance & Payments',icon:'📒',id:'quickbooks',name:'QuickBooks',desc:'Accounting, invoicing, and expense tracking for Forged Financial. Auto-categorize commission deposits, track business expenses, generate P&L reports for tax time.',tags:[{label:'Data',type:'data'},{label:'Scale',type:'goals'}]},
{cat:'Finance & Payments',icon:'💰',id:'wave',name:'Wave',desc:'Free accounting software — invoicing, receipt scanning, and financial reports. Perfect starter accounting until you outgrow it. Connects to bank accounts for auto-import.',tags:[{label:'Data',type:'data'},{label:'Speed',type:'speed'}]},
{cat:'Finance & Payments',icon:'🏦',id:'plaid',name:'Plaid',desc:'Connect bank accounts for automated transaction monitoring. See real-time cash flow, flag large deposits (commissions), and auto-reconcile with QuickBooks.',tags:[{label:'Data',type:'data'},{label:'Automation',type:'auto'}]},
/* ─── Scheduling & Calendar ─── */
{cat:'Scheduling & Calendar',icon:'📅',id:'calendar',name:'Google Calendar',desc:'Event scheduling, appointment reminders, and time blocking for deep work. Clawd can read your schedule and avoid booking conflicts. Sync with GHL appointments.',tags:[{label:'Speed',type:'speed'},{label:'Automation',type:'auto'}]},
{cat:'Scheduling & Calendar',icon:'🗓️',id:'calendly',name:'Calendly',desc:'Let clients self-book appointments based on your availability. Embed on website, include in email signatures. Auto-creates GHL contact and sends reminders.',tags:[{label:'Growth',type:'goals'},{label:'Automation',type:'auto'}]},
{cat:'Scheduling & Calendar',icon:'⏰',id:'acuity',name:'Acuity Scheduling',desc:'Advanced appointment scheduling with intake forms, payments, and custom availability. Different appointment types for consultations vs. reviews vs. claims.',tags:[{label:'Speed',type:'speed'},{label:'Growth',type:'goals'}]},
/* ─── Project & Task Management ─── */
{cat:'Project & Task Management',icon:'✅',id:'clickup',name:'ClickUp',desc:'Project management with task boards, docs, goals, and time tracking. Your current task sync source — keeps agent work organized across multiple client projects.',tags:[{label:'Speed',type:'speed'},{label:'Data',type:'data'}]},
{cat:'Project & Task Management',icon:'📌',id:'trello',name:'Trello',desc:'Simple Kanban boards for visual project tracking. Good for client onboarding pipelines — each card is a client, columns are onboarding stages.',tags:[{label:'Speed',type:'speed'},{label:'Scale',type:'goals'}]},
{cat:'Project & Task Management',icon:'📊',id:'monday',name:'Monday.com',desc:'Work OS with customizable workflows, dashboards, and automations. Advanced reporting for tracking team productivity and project timelines at scale.',tags:[{label:'Scale',type:'goals'},{label:'Data',type:'data'}]},
{cat:'Project & Task Management',icon:'📐',id:'asana',name:'Asana',desc:'Team project management with portfolios, timelines, and workload views. Best for managing multiple concurrent projects when scaling past solo operations.',tags:[{label:'Scale',type:'goals'},{label:'Speed',type:'speed'}]},
/* ─── Insurance-Specific ─── */
{cat:'Insurance-Specific',icon:'🏛️',id:'ams360',name:'AMS360 (Vertafore)',desc:'Insurance agency management system — policy management, commission tracking, client servicing, carrier downloads. The industry standard for scaling an insurance book.',tags:[{label:'Scale',type:'goals'},{label:'Data',type:'data'}]},
{cat:'Insurance-Specific',icon:'📋',id:'hawksoft',name:'HawkSoft',desc:'Agency management built for independent agents. Client management, policy tracking, renewal alerts, and carrier integration. Cleaner UI than AMS360 for smaller agencies.',tags:[{label:'Scale',type:'goals'},{label:'Speed',type:'speed'}]},
{cat:'Insurance-Specific',icon:'💎',id:'ritter',name:'Ritter Insurance Marketing',desc:'Carrier contracting, product training, and quoting tools for life and health insurance. Access 100+ carriers from one platform. Essential for expanding your product portfolio.',tags:[{label:'Growth',type:'goals'},{label:'Scale',type:'goals'}]},
{cat:'Insurance-Specific',icon:'📊',id:'quotit',name:'Quotit',desc:'Multi-carrier quoting engine for health, life, dental, and vision. Run instant quotes across dozens of carriers. Embed quoting on your website for self-service.',tags:[{label:'Speed',type:'speed'},{label:'Growth',type:'goals'}]},
{cat:'Insurance-Specific',icon:'🔍',id:'compulife',name:'Compulife',desc:'Life insurance quote comparison engine. Compare term life rates from 100+ carriers instantly. Give clients transparent, data-backed recommendations.',tags:[{label:'Speed',type:'speed'},{label:'Data',type:'data'}]},
{cat:'Insurance-Specific',icon:'📑',id:'applied-epic',name:'Applied Epic',desc:'Cloud-based agency management for multi-line insurance. Policy administration, claims management, and accounting all in one. For when you add P&C to your offerings.',tags:[{label:'Scale',type:'goals'},{label:'Data',type:'data'}]},
/* ─── Analytics & Reporting ─── */
{cat:'Analytics & Reporting',icon:'📊',id:'databox',name:'Databox',desc:'Unified dashboards pulling data from every connected system. See GHL pipeline + Meta Ads + revenue + tasks all on one screen. Custom KPIs for insurance metrics.',tags:[{label:'Data',type:'data'},{label:'Speed',type:'speed'}]},
{cat:'Analytics & Reporting',icon:'📈',id:'google-sheets',name:'Google Sheets',desc:'Flexible data hub for custom tracking — commission spreadsheets, carrier comparison charts, lead scoring models. Connects to everything via API and automation.',tags:[{label:'Data',type:'data'},{label:'Speed',type:'speed'}]},
{cat:'Analytics & Reporting',icon:'📉',id:'looker',name:'Looker Studio',desc:'Free data visualization from Google. Build custom dashboards from GHL, Meta Ads, and Analytics data. Share reports with partners or team.',tags:[{label:'Data',type:'data'},{label:'Scale',type:'goals'}]},
{cat:'Analytics & Reporting',icon:'🔬',id:'hotjar',name:'Hotjar',desc:'See how visitors interact with your website — heatmaps, recordings, and surveys. Find out where potential clients drop off your quote form and fix it.',tags:[{label:'Data',type:'data'},{label:'Growth',type:'goals'}]},
/* ─── Website & Landing Pages ─── */
{cat:'Website & Landing Pages',icon:'🌐',id:'wordpress',name:'WordPress',desc:'Build your Forged Financial website with full control. Insurance landing pages, blog content for SEO, client portals. Thousands of plugins for every need.',tags:[{label:'Growth',type:'goals'},{label:'Scale',type:'goals'}]},
{cat:'Website & Landing Pages',icon:'🚀',id:'webflow',name:'Webflow',desc:'Professional website builder with no code. Faster than WordPress for design-heavy sites. Build stunning landing pages that convert insurance leads.',tags:[{label:'Growth',type:'goals'},{label:'Speed',type:'speed'}]},
{cat:'Website & Landing Pages',icon:'📄',id:'unbounce',name:'Unbounce',desc:'Dedicated landing page builder with A/B testing. Create high-converting pages for each insurance product line. AI-powered copy suggestions for headlines.',tags:[{label:'Growth',type:'goals'},{label:'Data',type:'data'}]},
{cat:'Website & Landing Pages',icon:'🔧',id:'clickfunnels',name:'ClickFunnels',desc:'Sales funnel builder — lead capture, quote request, appointment booking, follow-up all in one flow. Template funnels specifically for insurance lead gen.',tags:[{label:'Growth',type:'goals'},{label:'Automation',type:'auto'}]},
/* ─── Social Media ─── */
{cat:'Social Media',icon:'📱',id:'hootsuite',name:'Hootsuite',desc:'Schedule and manage posts across all social platforms from one dashboard. Plan a month of insurance education content in one sitting. Track engagement metrics.',tags:[{label:'Growth',type:'goals'},{label:'Speed',type:'speed'}]},
{cat:'Social Media',icon:'📅',id:'buffer',name:'Buffer',desc:'Simple social media scheduling. Queue up posts for LinkedIn, Instagram, Facebook. Consistent posting builds authority in the insurance space.',tags:[{label:'Growth',type:'goals'},{label:'Speed',type:'speed'}]},
{cat:'Social Media',icon:'🎬',id:'capcut',name:'CapCut',desc:'Video editing for social content — insurance tip reels, client testimonial edits, educational shorts. AI features auto-caption, trim, and enhance clips.',tags:[{label:'Growth',type:'goals'},{label:'Speed',type:'speed'}]},
/* ─── Security & Compliance ─── */
{cat:'Security & Compliance',icon:'🔐',id:'1password',name:'1Password',desc:'Secure password management for all your carrier portals, CRM logins, and API keys. Share credentials safely with team members without exposing passwords.',tags:[{label:'Data',type:'data'},{label:'Scale',type:'goals'}]},
{cat:'Security & Compliance',icon:'🛡️',id:'vanta',name:'Vanta',desc:'Automated compliance monitoring. Track SOC 2, HIPAA, and insurance data handling requirements. As you handle more client PII, compliance becomes non-negotiable.',tags:[{label:'Data',type:'data'},{label:'Scale',type:'goals'}]},
{cat:'Security & Compliance',icon:'☁️',id:'backblaze',name:'Backblaze',desc:'Automated cloud backups for all business data — client files, financial records, Command Center exports. $7/mo for unlimited backup. Insurance against data loss.',tags:[{label:'Data',type:'data'},{label:'Speed',type:'speed'}]}
]}
function openAllConnModal(){
const all=getAllConnections();const connected=S.connectedSystems.map(s=>s.id);
const cats=[...new Set(all.map(c=>c.cat))];
let h=`<div class="allconn-hdr"><h3>🔌 All Connections<span class="allconn-cnt">${all.length} systems</span></h3><div class="allconn-close" onclick="closeAllConnModal()">✕</div></div>`;
h+=`<div class="allconn-scroll">`;
cats.forEach(cat=>{
const items=all.filter(c=>c.cat===cat);
h+=`<div class="allconn-cat"><div class="allconn-cat-hdr">${cat} (${items.length})</div>`;
const connUrls={'ghl':'https://app.gohighlevel.com','salesforce':'https://login.salesforce.com','hubspot':'https://app.hubspot.com/signup','close':'https://www.close.com','pipedrive':'https://www.pipedrive.com','gmail':'https://mail.google.com','slack':'https://slack.com/get-started','twilio':'https://www.twilio.com/try-twilio','zoom':'https://zoom.us/signup','ringcentral':'https://www.ringcentral.com','mailchimp':'https://login.mailchimp.com/signup/','sendgrid':'https://signup.sendgrid.com/','intercom':'https://www.intercom.com/','meta':'https://business.facebook.com','google-ads':'https://ads.google.com','analytics':'https://analytics.google.com','gtm':'https://tagmanager.google.com','tiktok-ads':'https://ads.tiktok.com','linkedin':'https://www.linkedin.com','semrush':'https://www.semrush.com','canva':'https://www.canva.com','n8n':'https://n8n.io','make':'https://www.make.com/en/register','zapier':'https://zapier.com/sign-up','openai-api':'https://platform.openai.com/signup','anthropic-api':'https://console.anthropic.com','docusign':'https://account.docusign.com/','pandadoc':'https://www.pandadoc.com','jotform':'https://www.jotform.com','typeform':'https://www.typeform.com','gdrive':'https://drive.google.com','dropbox':'https://www.dropbox.com','notion':'https://www.notion.so/signup','airtable':'https://airtable.com','loom':'https://www.loom.com/signup','stripe':'https://dashboard.stripe.com/register','quickbooks':'https://quickbooks.intuit.com','wave':'https://www.waveapps.com','plaid':'https://plaid.com','calendar':'https://calendar.google.com','calendly':'https://calendly.com','acuity':'https://acuityscheduling.com','clickup':'https://app.clickup.com','trello':'https://trello.com','monday':'https://monday.com','asana':'https://asana.com','ams360':'https://www.vertafore.com','hawksoft':'https://www.hawksoft.com','ritter':'https://www.ritterim.com','quotit':'https://www.quotit.net','compulife':'https://compulife.com','applied-epic':'https://www.appliedsystems.com','databox':'https://databox.com','google-sheets':'https://sheets.google.com','looker':'https://lookerstudio.google.com','hotjar':'https://www.hotjar.com','wordpress':'https://wordpress.com','webflow':'https://webflow.com','unbounce':'https://unbounce.com','clickfunnels':'https://www.clickfunnels.com','hootsuite':'https://www.hootsuite.com','buffer':'https://buffer.com','capcut':'https://www.capcut.com','1password':'https://1password.com','vanta':'https://www.vanta.com','backblaze':'https://www.backblaze.com'};
items.forEach(c=>{
const isConn=connected.includes(c.id);const cUrl=connUrls[c.id]||'';
h+=`<div class="allconn-item"><div class="allconn-item-ico">${c.icon}</div><div class="allconn-item-info">`;
h+=`<div class="allconn-item-nm">${c.name}${isConn?'<span class="allconn-connected">Connected</span>':''}</div>`;
h+=`<div class="allconn-item-desc">${c.desc}</div>`;
h+=`<div class="allconn-item-tags">${c.tags.map(t=>`<span class="conn-sug-tag ${t.type}">${t.label}</span>`).join('')}${cUrl&&!isConn?`<a href="${cUrl}" target="_blank" class="conn-sug-connect" onclick="event.stopPropagation()" style="margin-left:auto">Connect →</a>`:''}</div>`;
h+=`</div></div>`});
h+=`</div>`});
h+=`</div>`;
document.getElementById('allConnInner').innerHTML=h;
document.getElementById('allConnModal').classList.add('show')}
function closeAllConnModal(){document.getElementById('allConnModal').classList.remove('show')}
function toggleInsSection(el){el.closest('.ins-section').classList.toggle('open')}
function scrollToInsSec(id){const el=document.getElementById(id);if(!el)return;el.classList.add('open');el.scrollIntoView({behavior:'smooth',block:'start'})}
function renderInstructions(){document.getElementById('pg-instructions').innerHTML=`<div class="page-pad"><div class="ins-wrap">
<div class="ins-hero"><div class="ins-hero-ico">📖</div><h2>Forged Financial Command Center — User Manual</h2>
<div class="ins-hero-sub">Everything you need to know to get full utilization out of every tab, feature, and component. This guide is designed to maximize your input-to-output ratio — less time clicking, more tasks completed, faster goals hit.</div></div>

<!-- TABLE OF CONTENTS -->
<div class="ins-toc"><div class="ins-toc-t">📑 QUICK NAVIGATION</div><div class="ins-toc-grid">
<div class="ins-toc-link" onclick="scrollToInsSec('ins-sidebar')">🧭 Sidebar & Agent Tracker</div>
<div class="ins-toc-link" onclick="scrollToInsSec('ins-header')">📊 Header & Quick Actions</div>
<div class="ins-toc-link" onclick="scrollToInsSec('ins-overview')">📊 Overview</div>
<div class="ins-toc-link" onclick="scrollToInsSec('ins-notes')">💬 Notes</div>
<div class="ins-toc-link" onclick="scrollToInsSec('ins-taskboard')">📋 TaskBoard</div>
<div class="ins-toc-link" onclick="scrollToInsSec('ins-workflows')">⚡ Workflows</div>
<div class="ins-toc-link" onclick="scrollToInsSec('ins-dailyreports')">📰 Daily Reports</div>
<div class="ins-toc-link" onclick="scrollToInsSec('ins-analytics')">📈 Analytics</div>
<div class="ins-toc-link" onclick="scrollToInsSec('ins-goals')">🎯 Goals</div>
<div class="ins-toc-link" onclick="scrollToInsSec('ins-documents')">📄 Documents</div>
<div class="ins-toc-link" onclick="scrollToInsSec('ins-memory')">🧠 Memory & Identity</div>
<div class="ins-toc-link" onclick="scrollToInsSec('ins-radar')">🛰️ AI Radar</div>
<div class="ins-toc-link" onclick="scrollToInsSec('ins-systems')">🔌 Systems</div>
<div class="ins-toc-link" onclick="scrollToInsSec('ins-security')">🛡️ Security</div>
<div class="ins-toc-link" onclick="scrollToInsSec('ins-aesthetics')">🎨 Aesthetics</div>
<div class="ins-toc-link" onclick="scrollToInsSec('ins-settings')">⚙️ Settings</div>
</div></div>

<!-- SIDEBAR & AGENT TRACKER -->
<div class="ins-section" id="ins-sidebar"><div class="ins-sec-hdr" onclick="toggleInsSection(this)"><div class="ins-sec-ico">🧭</div><div class="ins-sec-title">Sidebar & Live Agent Tracker</div><span class="ins-sec-chev">▼</span></div>
<div class="ins-sec-body"><div class="ins-sec-inner">
<div class="ins-purpose">The sidebar is your primary navigation and real-time situational awareness panel. It shows you where you are, what Clawd is doing right now, and how to jump between every section of the Command Center instantly.</div>
<div class="ins-feat"><div class="ins-feat-t">🧠 Clawd — Live Agent Tracker</div>
<div class="ins-feat-desc">Positioned directly above the navigation tabs, Clawd shows you the AI assistant's real-time status — Idle (sleeping), Thinking (processing), or Working (executing). It displays the current task being worked on and any active sub-agents spawned for that task.</div>
<div class="ins-tip"><div class="ins-tip-ico">⚡</div><div class="ins-tip-txt">When you give a command, glance at Clawd to confirm he picked it up. If status says "Working" with a task name that matches your request — you're good. If it says "Idle" — your instruction may not have been received.</div></div></div>
<div class="ins-feat"><div class="ins-feat-t">📍 Navigation Tabs</div>
<div class="ins-feat-desc">Organized into four sections — Command, Operations, Intelligence, System, and Help. The orange highlight and left accent bar show which tab is currently active. Badge counts (like TaskBoard's count) update in real-time.</div>
<div class="ins-tip"><div class="ins-tip-ico">⚡</div><div class="ins-tip-txt">Tell Clawd "open the TaskBoard" or "go to Analytics" — he can navigate for you. But clicking the sidebar yourself is instant and keeps you in the driver's seat.</div></div></div>
<div class="ins-feat"><div class="ins-feat-t">🟢 Connection Status Footer</div>
<div class="ins-feat-desc">The pulsing green dot at the bottom confirms all systems are connected. Version number is displayed below it for reference.</div></div>
</div></div></div>

<!-- HEADER & QUICK ACTIONS -->
<div class="ins-section" id="ins-header"><div class="ins-sec-hdr" onclick="toggleInsSection(this)"><div class="ins-sec-ico">📊</div><div class="ins-sec-title">Header & Quick Actions</div><span class="ins-sec-chev">▼</span></div>
<div class="ins-sec-body"><div class="ins-sec-inner">
<div class="ins-purpose">The header bar sits at the top of every page and gives you at-a-glance system health, the heartbeat timer, a live clock, and one-click shortcuts for the actions you use most.</div>
<div class="ins-feat"><div class="ins-feat-t">💓 Heartbeat Timer</div>
<div class="ins-feat-desc">The countdown timer (default: 30 minutes) represents the interval between AI check-ins. When it hits zero, the assistant proactively checks in with a status update. You can manually trigger a heartbeat anytime with the 💓 button.</div>
<div class="ins-tip"><div class="ins-tip-ico">⚡</div><div class="ins-tip-txt">If you're deep in work and need Clawd to check in NOW — hit the heartbeat button. Don't wait for the timer. This is your "hey, what's the status?" shortcut.</div></div></div>
<div class="ins-feat"><div class="ins-feat-t">+ Task (Quick Add)</div>
<div class="ins-feat-desc">Opens the New Task modal instantly from any page. Set title, description, priority, category, assignee, deadline, and scheduled start. Deadlines and scheduled starts accept natural language — type "Friday", "next week", "tomorrow 9am", or "in 3 days" instead of picking dates from a calendar.</div>
<div class="ins-proto"><div class="ins-proto-ico">🔁</div><div class="ins-proto-txt">PROTOCOL: When giving Clawd tasks verbally, always include: WHO should do it, WHAT the task is, WHEN it's due, and HOW urgent it is. Example: "Clawd, create a high-priority task for yourself — draft 3 follow-up emails for Johnson — deadline Friday."</div></div></div>
<div class="ins-feat"><div class="ins-feat-t">📝 Quick Log</div>
<div class="ins-feat-desc">The notepad button opens a prompt to instantly log a note to the Activity Log. Use this for quick observations, ideas, or status updates that don't warrant a full task.</div></div>
<div class="ins-feat"><div class="ins-feat-t">🔖 Memory Bar</div>
<div class="ins-feat-desc">The colored chips below the header (Daily Log, MEMORY.md, Projects) are quick-access links to your most important memory files. Click any chip to jump directly to that file in the Memory tab.</div></div>
</div></div></div>

<!-- OVERVIEW -->
<div class="ins-section" id="ins-overview"><div class="ins-sec-hdr" onclick="toggleInsSection(this)"><div class="ins-sec-ico">📊</div><div class="ins-sec-title">Overview</div><span class="ins-sec-chev">▼</span></div>
<div class="ins-sec-body"><div class="ins-sec-inner">
<div class="ins-purpose">Your command center home screen. A real-time operational dashboard with drag-and-drop windows showing everything happening across your business at a glance. This is where you spend 80% of your time — it's designed to give you full situational awareness without clicking into individual tabs.</div>
<div class="ins-feat"><div class="ins-feat-t">📈 Summary Cards (Top Row)</div>
<div class="ins-feat-desc">Four locked cards at the top show: current status, active task count, agent workload, and system health. These update in real-time and never move — they're your constant pulse check.</div></div>
<div class="ins-feat"><div class="ins-feat-t">👥 Operator Strip</div>
<div class="ins-feat-desc">Horizontal scrollable strip showing each team member/agent (Danny, Openclaw, Claude, Shary, John) with their current status and active task. Color-coded dots indicate working/idle status.</div></div>
<div class="ins-feat"><div class="ins-feat-t">🪟 Free-Form Windows</div>
<div class="ins-feat-desc">Seven draggable, resizable windows: TaskBoard, Activity Log, Notes, Deliverables, Workflows, Daily Reports, and Save Me Time. Each window can be moved, resized from edges/corners, hidden via the tab bar, or brought to front by clicking.</div>
<div class="ins-key"><strong>Drag:</strong> Grab the title bar and move — windows collide and won't overlap.</div>
<div class="ins-key"><strong>Resize:</strong> Drag the bottom-right corner, right edge, or bottom edge.</div>
<div class="ins-key"><strong>Show/Hide:</strong> Click the tab bar buttons at the top to toggle window visibility.</div>
<div class="ins-key"><strong>Reset:</strong> Click "↺ Reset Layout" in the tab bar to restore the default arrangement.</div>
<div class="ins-tip"><div class="ins-tip-ico">⚡</div><div class="ins-tip-txt">Arrange your windows based on what you're focused on today. If it's a sales day — make TaskBoard and Deliverables biggest. If it's an operations day — prioritize Activity Log and Workflows. Your layout persists between sessions.</div></div></div>
<div class="ins-feat"><div class="ins-feat-t">📜 Activity Log (Window)</div>
<div class="ins-feat-desc">Chronological feed of everything happening — task completions, agent actions, system events. Click any entry to expand details. Color-coded by operator so you can scan who did what.</div>
<div class="ins-proto"><div class="ins-proto-ico">🔁</div><div class="ins-proto-txt">PROTOCOL: Tell Clawd "log that I spoke with Johnson about the term life policy" — he'll add it to the Activity Log with a timestamp. This creates an audit trail without you writing anything down.</div></div></div>
<div class="ins-feat"><div class="ins-feat-t">💡 Save Me Time (Window)</div>
<div class="ins-feat-desc">Quick-action cards for common operations: add task, fire heartbeat, open a memory file, run audit, log note. These are one-click shortcuts to the things you do most often.</div>
<div class="ins-tip"><div class="ins-tip-ico">⚡</div><div class="ins-tip-txt">If you find yourself doing the same 3-click action repeatedly, check Save Me Time first — it's probably already there as a 1-click shortcut.</div></div></div>
</div></div></div>

<!-- NOTES -->
<div class="ins-section" id="ins-notes"><div class="ins-sec-hdr" onclick="toggleInsSection(this)"><div class="ins-sec-ico">💬</div><div class="ins-sec-title">Notes</div><span class="ins-sec-chev">▼</span></div>
<div class="ins-sec-body"><div class="ins-sec-inner">
<div class="ins-purpose">A real-time communication thread between you and your AI team. Think of it as an internal Slack channel — messages are timestamped, labeled by sender, and marked as pending or seen.</div>
<div class="ins-feat"><div class="ins-feat-t">💬 Message Thread</div>
<div class="ins-feat-desc">Type a message in the input box and hit Send. Your notes appear labeled as "DANNY" in accent color. AI responses appear as "AI" in blue. Each message shows a timestamp and read status.</div>
<div class="ins-proto"><div class="ins-proto-ico">🔁</div><div class="ins-proto-txt">PROTOCOL: Use Notes for async communication with Clawd. Drop instructions here when you don't need an immediate response: "When you finish the email triage, start on the GHL cleanup." Clawd will see it and act on it in order.</div></div></div>
<div class="ins-tip"><div class="ins-tip-ico">⚡</div><div class="ins-tip-txt">Notes persist across sessions. Use them as a running conversation log — if you come back tomorrow, you can scroll up and see exactly what was discussed and what's pending.</div></div>
</div></div></div>

<!-- TASKBOARD -->
<div class="ins-section" id="ins-taskboard"><div class="ins-sec-hdr" onclick="toggleInsSection(this)"><div class="ins-sec-ico">📋</div><div class="ins-sec-title">TaskBoard</div><span class="ins-sec-chev">▼</span></div>
<div class="ins-sec-body"><div class="ins-sec-inner">
<div class="ins-purpose">Full Kanban board for managing every task across your business. Five columns: New Task, In Progress, Review, Completed, and Scheduled. Every task has a priority, category, assignee, deadline, and description — and can be dragged between columns.</div>
<div class="ins-feat"><div class="ins-feat-t">📋 Kanban Columns</div>
<div class="ins-feat-desc"><strong>New Task:</strong> Just created, not started. <strong>In Progress:</strong> Actively being worked on. <strong>Review:</strong> Done by agent, waiting for your approval. <strong>Completed:</strong> Fully done. <strong>Scheduled:</strong> Queued to start at a future time.</div>
<div class="ins-key"><strong>Drag & Drop:</strong> Grab any task card and drop it into a different column to change its status.</div>
<div class="ins-key"><strong>Quick Add:</strong> Type in the input at the top of the "New Task" column to quickly create a task.</div>
<div class="ins-key"><strong>Delete:</strong> Hover over a task card — the × button appears in the top-right corner.</div></div>
<div class="ins-feat"><div class="ins-feat-t">🔍 Filters & Search</div>
<div class="ins-feat-desc">Filter by category (Insurance, AI, Marketing, DR HQ, CRM) or by operator. Use the search bar to find tasks by title. Filters combine — click "Insurance" + "Claude" to see only insurance tasks assigned to Claude.</div></div>
<div class="ins-feat"><div class="ins-feat-t">🎨 Visual Priority System</div>
<div class="ins-feat-desc">Each task card has a colored left border: Red = Critical, Orange = High, Yellow = Medium, Gray = Low. Priority badges appear in the card header.</div></div>
<div class="ins-feat"><div class="ins-feat-t">📅 Scheduled Tasks</div>
<div class="ins-feat-desc">When creating a task with a "Scheduled Start" time, it goes to the Scheduled column and shows a countdown to when it activates. It automatically moves to In Progress when the time arrives.</div>
<div class="ins-proto"><div class="ins-proto-ico">🔁</div><div class="ins-proto-txt">PROTOCOL: Always have Clawd create tasks with clear descriptions, correct priority, and a deadline. Say: "Create a critical task assigned to yourself — 'Follow up Pacific Life Johnson' — deadline today." The clearer you are with Clawd, the better your board stays organized.</div></div></div>
<div class="ins-tip"><div class="ins-tip-ico">⚡</div><div class="ins-tip-txt">Check the Review column daily. These are tasks Clawd or your agents completed that need YOUR sign-off before being marked Done. If the review column is growing — you're the bottleneck. Clear it first thing every morning.</div></div>
</div></div></div>

<!-- WORKFLOWS -->
<div class="ins-section" id="ins-workflows"><div class="ins-sec-hdr" onclick="toggleInsSection(this)"><div class="ins-sec-ico">⚡</div><div class="ins-sec-title">Workflows</div><span class="ins-sec-chev">▼</span></div>
<div class="ins-sec-body"><div class="ins-sec-inner">
<div class="ins-purpose">Automated routines that run on schedule without manual intervention. Each workflow has a trigger frequency, active/inactive toggle, and can be manually triggered with the Run button.</div>
<div class="ins-feat"><div class="ins-feat-t">⚡ Workflow Cards</div>
<div class="ins-feat-desc">Each card shows the workflow name, run frequency (e.g., "Every morning 8:30 AM"), description of what it does, and an active/inactive toggle. Green toggle = active and running on schedule. Gray = paused.</div></div>
<div class="ins-feat"><div class="ins-feat-t">▶️ Manual Run</div>
<div class="ins-feat-desc">Click "▶ Run" on any workflow card to execute it immediately, regardless of its schedule. Useful for testing or when you need results now.</div>
<div class="ins-proto"><div class="ins-proto-ico">🔁</div><div class="ins-proto-txt">PROTOCOL: When asking Clawd to create new workflows, be specific about: WHAT it does, WHEN it runs, and WHAT it outputs. Example: "Create a workflow that pulls all new GHL leads every morning at 8 AM and logs them to the Activity Log."</div></div></div>
<div class="ins-tip"><div class="ins-tip-ico">⚡</div><div class="ins-tip-txt">Turn OFF workflows you don't need right now to save processing cycles. A workflow running every hour that you don't check is wasted compute. Activate them when you need them, deactivate when you don't.</div></div>
</div></div></div>

<!-- DAILY REPORTS -->
<div class="ins-section" id="ins-dailyreports"><div class="ins-sec-hdr" onclick="toggleInsSection(this)"><div class="ins-sec-ico">📰</div><div class="ins-sec-title">Daily Reports</div><span class="ins-sec-chev">▼</span></div>
<div class="ins-sec-body"><div class="ins-sec-inner">
<div class="ins-purpose">Your daily operational briefing — a structured summary of what happened, what's pending, key metrics, and what needs your attention. Think of it as the morning report a chief of staff would hand you.</div>
<div class="ins-feat"><div class="ins-feat-t">📊 Report Sections</div>
<div class="ins-feat-desc"><strong>Priorities:</strong> The most important items requiring your attention today. <strong>Business metrics:</strong> Revenue, pipeline, and performance numbers. <strong>Agent Activity:</strong> What each operator accomplished. <strong>Upcoming:</strong> Scheduled events and deadlines.</div></div>
<div class="ins-proto"><div class="ins-proto-ico">🔁</div><div class="ins-proto-txt">PROTOCOL: Ask Clawd to generate a fresh daily report every morning: "Generate today's briefing." He'll pull live data from tasks, workflows, systems, and compile it. Review it in 2 minutes to know exactly where you stand without checking every tab individually.</div></div>
<div class="ins-tip"><div class="ins-tip-ico">⚡</div><div class="ins-tip-txt">This is your single most time-saving feature. Instead of checking TaskBoard + Analytics + Systems + Goals separately each morning — read the Daily Report once. It's the 80/20 of your entire dashboard.</div></div>
</div></div></div>

<!-- ANALYTICS -->
<div class="ins-section" id="ins-analytics"><div class="ins-sec-hdr" onclick="toggleInsSection(this)"><div class="ins-sec-ico">📈</div><div class="ins-sec-title">Analytics</div><span class="ins-sec-chev">▼</span></div>
<div class="ins-sec-body"><div class="ins-sec-inner">
<div class="ins-purpose">Performance dashboards that aggregate data from tasks, goals, operators, and workflows into visual charts. Use this to identify bottlenecks, track velocity, and make data-driven decisions about where to focus your energy.</div>
<div class="ins-feat"><div class="ins-feat-t">📊 Hero Cards (Top Row)</div>
<div class="ins-feat-desc">Six at-a-glance metrics: Completed tasks, Done Rate (%), In Progress count, In Review count, Total Tasks, and Scheduled count. These tell you the health of your operation in one row.</div></div>
<div class="ins-feat"><div class="ins-feat-t">🔥 Summary Strip</div>
<div class="ins-feat-desc">Three cards: Today's Progress (how much got done today), Goals (achievement status), Workflows (active automation count + connected systems).</div></div>
<div class="ins-feat"><div class="ins-feat-t">📊 Charts</div>
<div class="ins-feat-desc"><strong>Operator Load:</strong> Bar chart showing active vs. completed tasks per person/agent — spot who's overloaded. <strong>GHL Pipeline:</strong> Insurance sales funnel from New Leads to Issued. <strong>Category Breakdown:</strong> Tasks by business area. <strong>Task Velocity:</strong> Distribution across Kanban columns. <strong>Priority Distribution:</strong> How many Critical/High/Medium/Low tasks you have.</div>
<div class="ins-proto"><div class="ins-proto-ico">🔁</div><div class="ins-proto-txt">PROTOCOL: Ask Clawd to analyze your analytics weekly: "What are the bottlenecks this week?" He'll look at where tasks are piling up (e.g., too many in Review = you need to approve more, too many In Progress = work isn't getting finished).</div></div></div>
<div class="ins-tip"><div class="ins-tip-ico">⚡</div><div class="ins-tip-txt">If your Done Rate is below 30%, you're creating tasks faster than you're completing them. Either delegate more to agents, reduce scope, or block focus time. Analytics tells you WHAT to fix — you decide HOW.</div></div>
</div></div></div>

<!-- GOALS -->
<div class="ins-section" id="ins-goals"><div class="ins-sec-hdr" onclick="toggleInsSection(this)"><div class="ins-sec-ico">🎯</div><div class="ins-sec-title">Goals</div><span class="ins-sec-chev">▼</span></div>
<div class="ins-sec-body"><div class="ins-sec-inner">
<div class="ins-purpose">Big-picture objectives displayed as draggable, resizable windows — just like the Overview. Each goal has a progress bar, milestones, key metrics, a deadline, and an encouragement message. This is where you track what actually matters long-term.</div>
<div class="ins-feat"><div class="ins-feat-t">🪟 Goal Windows</div>
<div class="ins-feat-desc">Each goal is its own draggable window with: title, description, progress bar (0-100%), milestones (checkable), key metrics (e.g., current revenue vs target), and category color coding (Revenue = green, Growth = orange, Systems = blue, Personal = purple).</div>
<div class="ins-key"><strong>Drag:</strong> Move goal windows around to prioritize visually — put your #1 goal at the top.</div>
<div class="ins-key"><strong>Resize:</strong> Make critical goals bigger so they demand more attention.</div></div>
<div class="ins-feat"><div class="ins-feat-t">✅ Milestones</div>
<div class="ins-feat-desc">Each goal has 3-5 milestones that can be checked off. Checking milestones automatically updates the progress bar. This gives you a clear sense of momentum.</div></div>
<div class="ins-feat"><div class="ins-feat-t">➕ Add & 🗑️ Delete Goals</div>
<div class="ins-feat-desc">Click "+ Add Goal" to create new goals with a title, description, target date, category, and milestones. Hover over any goal to reveal the delete button (top-right corner).</div>
<div class="ins-proto"><div class="ins-proto-ico">🔁</div><div class="ins-proto-txt">PROTOCOL: Every task you create should map back to a goal. Tell Clawd: "This task supports the $10K Revenue goal." When reviewing progress, ask: "How are we tracking on all goals?" Clawd will assess each one and flag anything falling behind.</div></div></div>
<div class="ins-tip"><div class="ins-tip-ico">⚡</div><div class="ins-tip-txt">Keep goals to 3-5 maximum. More than that fragments your focus. If a goal hasn't moved in 2 weeks, either break it into smaller milestones or ask Clawd to create specific tasks that push it forward.</div></div>
</div></div></div>

<!-- DOCUMENTS -->
<div class="ins-section" id="ins-documents"><div class="ins-sec-hdr" onclick="toggleInsSection(this)"><div class="ins-sec-ico">📄</div><div class="ins-sec-title">Documents</div><span class="ins-sec-chev">▼</span></div>
<div class="ins-sec-body"><div class="ins-sec-inner">
<div class="ins-purpose">A file manager for all documents generated by or relevant to your operations — reports, proposals, deliverables, templates. Split-pane layout: file browser on the left, document preview/editor on the right.</div>
<div class="ins-feat"><div class="ins-feat-t">📂 File Browser (Left Pane)</div>
<div class="ins-feat-desc">Search and filter documents by type (reports, proposals, etc.). Click any document to open it in the viewer. Files are sorted by modification date so the most recent are always on top.</div></div>
<div class="ins-feat"><div class="ins-feat-t">📝 Document Viewer (Right Pane)</div>
<div class="ins-feat-desc">Displays document content with markdown rendering — headers, bold, lists, checkboxes all render properly. You can view and edit documents directly in-browser.</div>
<div class="ins-proto"><div class="ins-proto-ico">🔁</div><div class="ins-proto-txt">PROTOCOL: Have Clawd generate documents and save them here: "Draft a client proposal for Johnson and save it to Documents." He'll create the document with proper formatting that you can review and edit.</div></div></div>
</div></div></div>

<!-- MEMORY -->
<div class="ins-section" id="ins-memory"><div class="ins-sec-hdr" onclick="toggleInsSection(this)"><div class="ins-sec-ico">🧠</div><div class="ins-sec-title">Memory & AI Identity</div><span class="ins-sec-chev">▼</span></div>
<div class="ins-sec-body"><div class="ins-sec-inner">
<div class="ins-purpose">The AI's persistent knowledge base and identity configuration — all in one tab. Memory files are what make Clawd remember things between sessions. SOUL.md and USER.md define who Clawd is and who you are. Together, they're the DNA of every interaction.</div>
<div class="ins-feat"><div class="ins-feat-t">🤖 SOUL.md & 👤 USER.md (AI Identity Files)</div>
<div class="ins-feat-desc">Pinned at the top of the sidebar. <strong>SOUL.md</strong> defines the AI's personality, role, rules, and boundaries — communication style, hard rules (NEVER contact employees), and operating principles. <strong>USER.md</strong> is your profile — business name, location, timezone, team members, and preferences. Changes here change how Clawd behaves everywhere.</div></div>
<div class="ins-feat"><div class="ins-feat-t">📁 Memory File Types</div>
<div class="ins-feat-desc"><strong>Long-Term (🧠):</strong> Permanent facts — your business info, team structure, boundaries, preferences. <strong>Daily (📅):</strong> Day-specific logs — what happened today, what's scheduled. <strong>Project (📁):</strong> Ongoing project context — DR HQ structure, insurance client details.</div></div>
<div class="ins-feat"><div class="ins-feat-t">✏️ Markdown Editor</div>
<div class="ins-feat-desc">Click any memory file, SOUL.md, or USER.md to open it in the editor. Uses markdown syntax — headers (#), lists (-), checkboxes (- [x]), bold (**text**). Changes save when you click the Save button.</div></div>
<div class="ins-feat"><div class="ins-feat-t">➕ Create New Files</div>
<div class="ins-feat-desc">Click "New File" to create additional memory files for new projects, clients, or categories. Choose a name and type (Project, Daily Log, Long-Term).</div>
<div class="ins-proto"><div class="ins-proto-ico">🔁</div><div class="ins-proto-txt">PROTOCOL: Update SOUL.md when you want to change Clawd's behavior: "Add to SOUL.md: Always prioritize insurance tasks over marketing tasks." Update USER.md when your situation changes. After every significant business decision, tell Clawd: "Update MEMORY.md — Johnson closed the $500K term life." These files are Clawd's operating system.</div></div></div>
<div class="ins-tip"><div class="ins-tip-ico">⚡</div><div class="ins-tip-txt">Memory + Identity is the #1 factor in AI output quality. The more specific your SOUL.md, the less you correct Clawd. A well-maintained MEMORY.md means he never asks you to repeat yourself. Invest 15 minutes making these files thorough — it saves hours of repeated instructions.</div></div>
</div></div></div>

<!-- AI RADAR -->
<div class="ins-section" id="ins-radar"><div class="ins-sec-hdr" onclick="toggleInsSection(this)"><div class="ins-sec-ico">🛰️</div><div class="ins-sec-title">AI Radar</div><span class="ins-sec-chev">▼</span></div>
<div class="ins-sec-body"><div class="ins-sec-inner">
<div class="ins-purpose">Intelligence feed that keeps you informed on the latest AI developments, personalized recommendations for your business, and curated suggestions for your agent team. Three sections: news, personal recommendations, and agent recommendations.</div>
<div class="ins-feat"><div class="ins-feat-t">📰 Latest AI Updates</div>
<div class="ins-feat-desc">Curated news articles about AI tools, frameworks, and developments relevant to your business. Each item has a clickable title that opens the source article, plus a "Read more" link. Sources include industry publications and AI research outlets.</div></div>
<div class="ins-feat"><div class="ins-feat-t">💡 For You — Danny</div>
<div class="ins-feat-desc">Personalized recommendations based on your current tasks, goals, and business needs. These are actionable suggestions — tools to try, strategies to implement, skills to develop. No external links — these are curated insights for you to discuss with Clawd.</div></div>
<div class="ins-feat"><div class="ins-feat-t">🤖 For Your Agents</div>
<div class="ins-feat-desc">Recommendations for improving your AI agent stack — new models to try, workflow optimizations, configuration improvements. These help you upgrade your automation layer over time.</div>
<div class="ins-proto"><div class="ins-proto-ico">🔁</div><div class="ins-proto-txt">PROTOCOL: Review AI Radar weekly. When you see something interesting, tell Clawd: "I saw [tool/strategy] on the Radar — research it and tell me if it's worth implementing for Forged Financial." He'll evaluate it against your current stack and goals.</div></div></div>
</div></div></div>

<!-- SYSTEMS -->
<div class="ins-section" id="ins-systems"><div class="ins-sec-hdr" onclick="toggleInsSection(this)"><div class="ins-sec-ico">🔌</div><div class="ins-sec-title">Connected Systems</div><span class="ins-sec-chev">▼</span></div>
<div class="ins-sec-body"><div class="ins-sec-inner">
<div class="ins-purpose">Dashboard of every external system connected to the Command Center — Gmail, Google Drive, ClickUp, Calendar, N8N, GoHighLevel, Meta Ads, and Google Analytics. Each system shows its connection status, access level, and detailed stats. Below that, AI-generated suggestions for new connections.</div>
<div class="ins-feat"><div class="ins-feat-t">🔌 System Cards (Click to Expand)</div>
<div class="ins-feat-desc">Each connected system shows: name, status (connected/pending), access level (Read Only / Read-Write / No Access), and a short description. Hover over any card to expand and see: account email, URL (clickable), last action performed with timestamp, and live stats specific to that system. The expanded view overlaps cards below it so nothing shifts around.</div>
<div class="ins-key"><strong>Access Levels:</strong> Read = can view data only. Read-Write = can view AND modify data. The goal is to progress from Read → Read-Write as trust is established.</div></div>
<div class="ins-feat"><div class="ins-feat-t">📊 Live Stats</div>
<div class="ins-feat-desc">Each system shows contextual metrics. Gmail: unanswered emails, today's received, auto-sorted count. GHL: active leads, pipeline value, stale leads. Meta Ads: monthly spend, lead count, cost per lead.</div></div>
<div class="ins-feat"><div class="ins-feat-t">💡 Suggested Connections</div>
<div class="ins-feat-desc">AI-analyzed recommendations for systems that would accelerate your current tasks or goals. Each suggestion explains WHY it would help, referencing your actual tasks and goals by name. Color-coded tags indicate whether the suggestion improves Speed, Goal Tracking, Data Accuracy, or Automation.</div>
<div class="ins-proto"><div class="ins-proto-ico">🔁</div><div class="ins-proto-txt">PROTOCOL: When reviewing suggestions, tell Clawd: "Let's connect [system name] — walk me through what's needed." He'll outline the integration steps. Periodically ask: "Which of my connected systems are underutilized?" to make sure you're getting full value from what's already connected.</div></div></div>
</div></div></div>

<!-- SECURITY -->
<div class="ins-section" id="ins-security"><div class="ins-sec-hdr" onclick="toggleInsSection(this)"><div class="ins-sec-ico">🛡️</div><div class="ins-sec-title">Security Audit</div><span class="ins-sec-chev">▼</span></div>
<div class="ins-sec-body"><div class="ins-sec-inner">
<div class="ins-purpose">On-demand security audit that scans your entire Command Center for vulnerabilities, misconfigurations, and best-practice violations. Runs checks across Data Integrity, Access Control, Operational Security, and AI Governance — then gives you a score out of 100.</div>
<div class="ins-feat"><div class="ins-feat-t">🔍 Run Audit</div>
<div class="ins-feat-desc">Click "Run Security Audit" to execute a comprehensive scan. Results show a score ring (color-coded: green = good, yellow = moderate, red = critical), total checks passed/failed, and a detailed breakdown of every check with pass/fail status and explanation.</div></div>
<div class="ins-feat"><div class="ins-feat-t">📋 Check Categories</div>
<div class="ins-feat-desc"><strong>Data Integrity:</strong> Are tasks valid? Are operators configured? <strong>Access Control:</strong> Are systems over-permissioned? <strong>Operational:</strong> Are workflows active? Is memory being maintained? <strong>AI Governance:</strong> Does SOUL.md have boundaries? Are agent limits set?</div></div>
<div class="ins-feat"><div class="ins-feat-t">📜 Audit History</div>
<div class="ins-feat-desc">Previous audit results are saved with timestamps and scores so you can track your security posture over time.</div>
<div class="ins-proto"><div class="ins-proto-ico">🔁</div><div class="ins-proto-txt">PROTOCOL: Run a security audit weekly. Tell Clawd: "Run security audit and fix anything under 80%." He'll run the audit, identify failures, and propose fixes. Maintaining 90%+ means your operation is locked down properly.</div></div></div>
</div></div></div>

<!-- AESTHETICS -->
<div class="ins-section" id="ins-aesthetics"><div class="ins-sec-hdr" onclick="toggleInsSection(this)"><div class="ins-sec-ico">🎨</div><div class="ins-sec-title">Aesthetics</div><span class="ins-sec-chev">▼</span></div>
<div class="ins-sec-body"><div class="ins-sec-inner">
<div class="ins-purpose">Full visual customization of the Command Center — 80+ color variables, 8 themes, fonts, border radius, glass blur, compact mode, font scaling, and background modes. Make the dashboard look and feel exactly how you want it.</div>
<div class="ins-feat"><div class="ins-feat-t">🎨 Themes (8 Presets)</div>
<div class="ins-feat-desc">Background Mode sets the base (dark, light, gradients, custom image). Color Themes set the accent color independently. They work together — e.g. Tokyo Night background + Sunset accent. Upload custom images/videos as backgrounds for a fully personalized look.</div></div>
<div class="ins-feat"><div class="ins-feat-t">🎨 80+ Color Swatches</div>
<div class="ins-feat-desc">Every color in the UI is customizable — Core UI (background, surface, borders, text), Brand (accent), Status (online, working, idle, offline), Kanban columns, Priorities, Categories, Operators, plus extended palettes (Warm, Cool, Vibrant, Earth, Neon). Click the color circle to open a picker, or type a hex code directly.</div></div>
<div class="ins-feat"><div class="ins-feat-t">🔤 Font Family & Size</div>
<div class="ins-feat-desc">Switch between 5 font families. Font Size slider lets you scale the entire UI from 50% (half size) to 300% (3× size) — affects every text element proportionally.</div></div>
<div class="ins-feat"><div class="ins-feat-t">🔧 Layout Tweaks</div>
<div class="ins-feat-desc"><strong>Border Radius:</strong> 0 (sharp) to 24px (very rounded). <strong>Glass Blur:</strong> Frosted glass effect on windows and cards. <strong>Compact Mode:</strong> Reduces all padding/spacing for information density. <strong>Animation Speed:</strong> Control transition speeds. <strong>Sidebar Width:</strong> Adjust the left panel width. <strong>Header Icon Opacity:</strong> Fade header elements. <strong>Background:</strong> Dark or light mode.</div></div>
<div class="ins-feat"><div class="ins-feat-t">↺ Reset Colors</div>
<div class="ins-feat-desc">One-click reset to restore all defaults — useful when experimentation goes too far.</div>
<div class="ins-tip"><div class="ins-tip-ico">⚡</div><div class="ins-tip-txt">Aesthetics aren't just cosmetic — they affect how long you can look at the dashboard without eye strain. If you work late nights, switch to Midnight theme. If you work in bright rooms, increase text contrast. A comfortable dashboard is one you'll actually use.</div></div></div>
</div></div></div>

<!-- SETTINGS -->
<div class="ins-section" id="ins-settings"><div class="ins-sec-hdr" onclick="toggleInsSection(this)"><div class="ins-sec-ico">⚙️</div><div class="ins-sec-title">Settings</div><span class="ins-sec-chev">▼</span></div>
<div class="ins-sec-body"><div class="ins-sec-inner">
<div class="ins-purpose">Backend configuration — heartbeat interval, layout resets, operator management, API keys, and data import/export. This is the plumbing that keeps everything running.</div>
<div class="ins-feat"><div class="ins-feat-t">⏱️ Heartbeat Interval</div>
<div class="ins-feat-desc">Set how often (in minutes) the AI assistant automatically checks in. Lower = more frequent check-ins (better for active work sessions). Higher = less interruption (better for deep focus blocks).</div></div>
<div class="ins-feat"><div class="ins-feat-t">🪟 Layout Reset</div>
<div class="ins-feat-desc">Resets the Overview and Goals window positions to their defaults. Use this if windows get stuck or overlapping after a resize.</div></div>
<div class="ins-feat"><div class="ins-feat-t">🔌 API Connections</div>
<div class="ins-feat-desc">Input fields for API keys: Openclaw, Claude, N8N, GoHighLevel, Meta Ads, Google Analytics. These connect the Command Center to live external systems.</div></div>
<div class="ins-feat"><div class="ins-feat-t">💾 Data Export & Reset</div>
<div class="ins-feat-desc"><strong>Export JSON:</strong> Download your entire Command Center state as a JSON file — tasks, goals, memory, settings, everything. Use for backups. <strong>Reset:</strong> Nuclear option — clears all data and starts fresh. Use only if you want a completely clean slate.</div>
<div class="ins-tip"><div class="ins-tip-ico">⚡</div><div class="ins-tip-txt">Export your data at least weekly. If your browser cache clears or localStorage gets wiped, the export is your safety net. Tell Clawd: "Remind me to export data every Friday" and he'll add it to your recurring tasks.</div></div></div>
</div></div></div>

<!-- PHILOSOPHY / CLOSING -->
<div class="ins-philosophy">
<h3>🔥 The Forged Financial Operating Principle</h3>
<p>Every feature in this Command Center exists to increase your input-to-output ratio. The goal is simple: less time managing, more time executing. Less time asking what's going on, more time deciding what to do next. Clawd handles the mechanics — you handle the strategy. Use Memory to build compounding context. Use Goals to stay directional. Use the TaskBoard to stay tactical. Use Daily Reports to stay informed. Use Analytics to stay honest. The businesses that win are the ones that iterate fastest — and this dashboard is your iteration engine.</p>
</div>

</div></div>`}
function renderSettings(){document.getElementById('pg-settings').innerHTML=`<div class="page-pad"><div class="set-wrap"><h2 style="font-size:18px;font-weight:800;margin-bottom:16px">⚙️ Settings</h2><div class="set-sec"><div class="set-sec-t">⏱️ Heartbeat</div><div class="set-row"><div><div class="set-lbl">Interval (minutes)</div></div><input class="set-inp" type="number" value="${S.hbInterval}" min="1" max="120" onchange="S.hbInterval=+this.value;resetHb();save()" style="width:80px"/></div></div><div class="set-sec"><div class="set-sec-t">🪟 Layout</div><div class="set-row"><div><div class="set-lbl">Reset window layout</div></div><button class="set-btn" onclick="resetLayout()">↺ Reset</button></div></div><div class="set-sec"><div class="set-sec-t">🤖 Operators</div>${OPS.map(o=>`<div class="set-row"><div><div class="set-lbl">${o.icon} ${o.name}</div><div class="set-desc">Status: ${S.operators[o.id]?.status||'—'}</div></div></div>`).join('')}</div><div class="set-sec"><div class="set-sec-t">🔌 API Connections</div>${['Openclaw API','Claude API Key','N8N Webhook','GoHighLevel API','Meta Ads Token','Google Analytics'].map(n=>`<div class="set-row"><div><div class="set-lbl">${n}</div></div><input class="set-inp" type="password" placeholder="Enter key..."/></div>`).join('')}</div><div class="set-sec"><div class="set-sec-t">💾 Data</div><div class="set-row"><div><div class="set-lbl">Export</div></div><button class="set-btn" onclick="exportData()">📥 Export JSON</button></div><div class="set-row"><div><div class="set-lbl">Reset</div><div class="set-desc">Clear all data and start fresh</div></div><button class="set-btn danger" onclick="if(confirm('Reset everything?')){localStorage.removeItem(KEY);location.reload()}">🗑️ Reset</button></div></div><div class="set-sec"><div class="set-sec-t">ℹ️ About</div><div class="set-row"><div><div class="set-lbl">Forged Financial Command Center v4.1</div><div class="set-desc">Built for Danny · Free-form windows · Goals · 80 colors · AI Radar</div></div></div></div></div></div>`}
function exportData(){const b=new Blob([JSON.stringify(S,null,2)],{type:'application/json'}),u=URL.createObjectURL(b),a=document.createElement('a');a.href=u;a.download='ff_export_'+new Date().toISOString().split('T')[0]+'.json';a.click();URL.revokeObjectURL(u)}
function esc(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;')}
function renderMd(md){return esc(md).replace(/^### (.+)$/gm,'<h3>$1</h3>').replace(/^## (.+)$/gm,'<h2>$1</h2>').replace(/^# (.+)$/gm,'<h1>$1</h1>').replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>').replace(/\*(.+?)\*/g,'<em>$1</em>').replace(/`([^`]+)`/g,'<code>$1</code>').replace(/^- \[x\] (.+)$/gm,'<div style="color:var(--online)">☑ $1</div>').replace(/^- \[ \] (.+)$/gm,'<div style="color:var(--text-sec)">☐ $1</div>').replace(/^- (.+)$/gm,'<div style="padding-left:.5rem">• $1</div>').replace(/\n\n/g,'</p><p>').replace(/\n/g,'<br>')}
function openModal(pf=''){document.getElementById('taskModal').classList.add('show');document.getElementById('mTitle').value=pf;document.getElementById('mDesc').value='';document.getElementById('mSched').value='';document.getElementById('mStatus').value='new_task';document.getElementById('mTitle').focus()}
function closeModal(){document.getElementById('taskModal').classList.remove('show')}
/* Natural language date parser */
function parseFreeDate(str){if(!str||!str.trim())return null;const s=str.trim().toLowerCase();const now=new Date();const today=new Date(now.getFullYear(),now.getMonth(),now.getDate());
/* Try native parse first for explicit dates like "March 15", "3/15/2026", "2026-03-15" */
const native=new Date(str.trim());if(!isNaN(native)&&native.getFullYear()>2000)return native;
/* Relative: "today","tonight" */
if(s==='today'||s==='tonight'){const d=new Date(today);if(s==='tonight')d.setHours(21,0,0);return d}
/* "tomorrow", "tomorrow 9am" */
if(s.startsWith('tomorrow')){const d=new Date(today);d.setDate(d.getDate()+1);const tp=s.replace('tomorrow','').trim();if(tp)applyTime(d,tp);return d}
/* "in X minutes/hours/days/weeks" */
const inM=s.match(/^in\s+(\d+)\s*(min|minute|minutes|hr|hrs|hour|hours|day|days|week|weeks)$/);
if(inM){const n=parseInt(inM[1]),u=inM[2];const d=new Date(now);if(u.startsWith('min'))d.setMinutes(d.getMinutes()+n);else if(u.startsWith('h'))d.setHours(d.getHours()+n);else if(u.startsWith('d'))d.setDate(d.getDate()+n);else if(u.startsWith('w'))d.setDate(d.getDate()+n*7);return d}
/* Day names: "monday","tuesday",...,"next monday" */
const days=['sunday','monday','tuesday','wednesday','thursday','friday','saturday'];
let isNext=s.startsWith('next ');const ds=isNext?s.replace('next ',''):s;
/* "next week" */
if(ds==='week'){const d=new Date(today);d.setDate(d.getDate()+7);d.setHours(9,0,0);return d}
/* "next month" */
if(ds==='month'){const d=new Date(today);d.setMonth(d.getMonth()+1);d.setDate(1);d.setHours(9,0,0);return d}
/* Day name with optional time: "friday", "monday at 2pm", "next tuesday 10am" */
const dayParts=ds.match(/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)\s*(?:at\s*)?(.*)$/);
if(dayParts){const target=days.indexOf(dayParts[1]);const cur=today.getDay();let diff=target-cur;if(diff<=0||isNext)diff+=7;const d=new Date(today);d.setDate(d.getDate()+diff);const tp=dayParts[2]?.trim();if(tp)applyTime(d,tp);else d.setHours(9,0,0);return d}
/* "end of day/week/month" */
if(s==='end of day'||s==='eod'){const d=new Date(today);d.setHours(17,0,0);return d}
if(s==='end of week'||s==='eow'){const d=new Date(today);d.setDate(d.getDate()+(5-d.getDay()));d.setHours(17,0,0);return d}
if(s==='end of month'||s==='eom'){const d=new Date(today.getFullYear(),today.getMonth()+1,0);d.setHours(17,0,0);return d}
/* Fallback: try Date.parse on the raw string one more time */
const fb=Date.parse(str.trim());if(!isNaN(fb))return new Date(fb);
return null}
function applyTime(d,t){const m=t.match(/(\d{1,2})\s*(?::(\d{2}))?\s*(am|pm)?/i);if(!m)return;let h=parseInt(m[1]),min=parseInt(m[2]||'0');const ap=m[3]?.toLowerCase();if(ap==='pm'&&h<12)h+=12;if(ap==='am'&&h===12)h=0;if(!ap&&h<7)h+=12;d.setHours(h,min,0)}
function saveTask(){const t=document.getElementById('mTitle').value.trim();if(!t)return;const schedRaw=document.getElementById('mSched').value.trim();const deadRaw=document.getElementById('mDead').value.trim();const schedDate=parseFreeDate(schedRaw);const deadDate=parseFreeDate(deadRaw);const st=schedDate?'scheduled':document.getElementById('mStatus').value;S.tasks.unshift({id:gid(),title:t,desc:document.getElementById('mDesc').value.trim(),priority:document.getElementById('mPri').value,status:st,category:document.getElementById('mCat').value,assignee:document.getElementById('mAssign').value,createdAt:ts(),deadline:deadDate?deadDate.toISOString().split('T')[0]:null,completedAt:null,scheduledAt:schedDate?schedDate.toISOString():null});addLog('task','danny','New task: "'+t+'"','Priority: '+document.getElementById('mPri').value+(schedDate?' · Starts: '+schedDate.toLocaleString():'')+(deadDate?' · Due: '+deadDate.toLocaleDateString():''),'business');save();closeModal();if(renders[currentPage])renders[currentPage]()}
document.getElementById('taskModal').onclick=e=>{if(e.target===e.currentTarget)closeModal()};
document.getElementById('memFileModal').onclick=e=>{if(e.target===e.currentTarget)closeMemModal()};
document.getElementById('allConnModal').onclick=e=>{if(e.target===e.currentTarget)closeAllConnModal()};

/* Simulation */
/* Agent status — poll real status from Clawd every 1s */
setInterval(()=>{const su=localStorage.getItem('ff_sync_url')||'https://76.13.126.53:443';fetch(su+'/api/agent-status').then(r=>r.json()).then(d=>{const op=S.operators.claude;if(!op)return;const changed=op.status!==d.status||op.task!==d.task;op.status=d.status||'idle';op.task=d.task||null;op.subs=(d.subs||[]).map(s=>({name:s.name||s.agent||'Sub-Agent',status:s.status||'active',job:s.job||s.task||''}));if(changed)renderAgentTracker()}).catch(()=>{})},1000);
/* Fake activity log simulation removed — all logs now real via sync bridge */
setInterval(()=>{let changed=false;S.tasks.forEach(t=>{if(t.status==='scheduled'&&t.scheduledAt&&new Date(t.scheduledAt)<=new Date()){t.status='in_progress';addLog('task','system','Auto-started: "'+t.title+'"','Scheduled time reached.','system');changed=true}});if(changed){save();if(renders[currentPage])renders[currentPage]()}},60000);

/* INIT */
load();resetHb();renderOverview();renderAgentTracker();applyCustomColors();applyFont();applyUISettings();setInterval(hbTick,1000);loadFromServer();
/* Daily security audit auto-run */
if(!S.lastSecurityAudit||Date.now()-new Date(S.lastSecurityAudit).getTime()>864e5){runSecurityAudit()}
setInterval(()=>{if(!S.lastSecurityAudit||Date.now()-new Date(S.lastSecurityAudit).getTime()>864e5){runSecurityAudit();if(currentPage==='security')renderSecurity()}},36e5);

/* ========== UNREAD NOTIFICATION SYSTEM ========== */
const UR_KEY='ff_unread_seen';
function urLoad(){try{return JSON.parse(localStorage.getItem(UR_KEY))||{}}catch(e){return{}}}
function urSave(seen){localStorage.setItem(UR_KEY,JSON.stringify(seen))}
function urGetSeen(){return urLoad()}
function urMarkSeen(ids){const seen=urLoad();ids.forEach(id=>{seen[id]=Date.now()});urSave(seen);urUpdateBadges()}
function urMarkPageSeen(page){
  const items=urGetPageItems(page);
  urMarkSeen(items.map(i=>i.id));
}
function urGetPageItems(page){
  switch(page){
    case'taskboard':return S.tasks.map(t=>({id:'t-'+t.id}));
    case'notes':return S.notes.map(n=>({id:'n-'+n.id}));
    case'documents':return S.documents.map(d=>({id:'d-'+(d.id||d.title)}));
    case'workflows':return S.workflows.map(w=>({id:'w-'+(w.id||w.name)}));
    case'goals':return S.goals.map(g=>({id:'g-'+(g.id||g.title)}));
    case'briefing':return(S.briefings||[]).map((b,i)=>({id:'b-'+(b.id||i)}));
    case'memory':return S.memoryFiles.map(m=>({id:'m-'+(m.id||m.name)}));
    default:return[];
  }
}
function urCountUnread(page){
  const seen=urLoad();
  const items=urGetPageItems(page);
  return items.filter(i=>!seen[i.id]).length;
}
function urUpdateBadges(){
  ['taskboard','notes','documents','workflows','goals','briefing','memory'].forEach(page=>{
    const el=document.getElementById('ur-'+page);
    if(!el)return;
    const count=urCountUnread(page);
    el.textContent=count||'';
    el.dataset.count=count;
  });
}
/* Mark interactive items read on click (tasks, documents, goals) */
const _origOpenTaskDetail=openTaskDetail;
openTaskDetail=function(id){urMarkSeen(['t-'+id]);_origOpenTaskDetail(id)};
/* Mark non-interactive pages read on mouse enter */
['briefing','workflows','memory'].forEach(pg=>{
  const el=document.getElementById('pg-'+pg);
  if(el)el.addEventListener('mouseenter',()=>urMarkPageSeen(pg));
  if(el)el.addEventListener('mousemove',function _once(){urMarkPageSeen(pg);el.removeEventListener('mousemove',_once)},{once:false});
});
/* Mark notes read when hovering individual notes */
document.addEventListener('mouseenter',function(e){
  const ni=e.target.closest&&e.target.closest('.ni');
  if(ni){const noteEl=ni.querySelector('.ni-del');if(noteEl){const nid=noteEl.getAttribute('onclick')?.match(/'([^']+)'/)?.[1];if(nid)urMarkSeen(['n-'+nid])}}
},true);
/* Mark documents read on click */
const _origNavTo=navTo;
navTo=function(pg){
  _origNavTo(pg);
  /* Non-interactive pages: mark all read on navigation */
  if(['briefing','workflows','analytics','memory'].includes(pg))setTimeout(()=>urMarkPageSeen(pg),500);
  urUpdateBadges();
};
/* Update badges on save, load, and periodically */
const _origSave=save;
save=function(){_origSave();setTimeout(urUpdateBadges,100)};
urUpdateBadges();
setInterval(urUpdateBadges,5000);
</script>
<script>
/* ========== SYNC BRIDGE v1.0 — Separate script block, zero existing code changes ========== */
(function(){
'use strict';

const SYNC={
  url: localStorage.getItem('ff_sync_url')||'https://76.13.126.53:443',
  key: localStorage.getItem('ff_sync_key')||'',
  on: localStorage.getItem('ff_sync_on')!=='false',
  lastTs: localStorage.getItem('ff_sync_ts')||null,
  interval: 7000,
  timer: null,
  status: {ok:false,err:null,n:0}
};

/* Push to VPS */
function push(type,action,data){
  if(!SYNC.on||!SYNC.url)return;
  var h={'Content-Type':'application/json'};
  if(SYNC.key)h['Authorization']='Bearer '+SYNC.key;
  fetch(SYNC.url+'/api/push',{method:'POST',headers:h,body:JSON.stringify({type:type,action:action,data:data,source:'cc'})}).catch(function(){});
}

/* Poll VPS */
function poll(){
  if(!SYNC.on)return;
  var since=SYNC.lastTs||new Date(Date.now()-36e5).toISOString();
  fetch(SYNC.url+'/api/poll?since='+encodeURIComponent(since))
  .then(function(r){if(!r.ok)throw new Error('HTTP '+r.status);return r.json()})
  .then(function(j){
    if(j.updates&&j.updates.length>0)apply(j.updates);
    SYNC.lastTs=j.serverTime;
    localStorage.setItem('ff_sync_ts',j.serverTime);
    SYNC.status={ok:true,err:null,n:j.count};
    ui();
  })
  .catch(function(e){
    SYNC.status={ok:false,err:e.message,n:0};
    ui();
  });
}

/* Apply incoming updates */
function apply(updates){
  var dirty=false;
  updates.forEach(function(u){
    if(u.source==='cc')return;
    var d=u.data;
    switch(u.type){
      case 'task':
        if(u.action==='create'){if(!S.tasks.find(function(t){return t.id===d.id})){S.tasks.unshift(d);dirty=true}}
        else if(u.action==='update'){var i=S.tasks.findIndex(function(t){return t.id===d.id});if(i!==-1){Object.assign(S.tasks[i],d);dirty=true}}
        else if(u.action==='delete'){var b=S.tasks.length;S.tasks=S.tasks.filter(function(t){return t.id!==d.id});if(S.tasks.length<b)dirty=true}
        break;
      case 'operator':
        if(u.action==='update'&&S.operators[d.id]){Object.assign(S.operators[d.id],d);dirty=true}
        break;
      case 'log':
        if(u.action==='create'&&!S.logs.find(function(l){return l.id===d.id})){S.logs.push(d);dirty=true}
        break;
      case 'note':
        if(u.action==='create'&&!S.notes.find(function(n){return n.id===d.id})){S.notes.push(d);dirty=true}
        else if(u.action==='update'){var i2=S.notes.findIndex(function(n){return n.id===d.id});if(i2!==-1){Object.assign(S.notes[i2],d);dirty=true}}
        break;
      case 'document':
        if(u.action==='create'&&!S.documents.find(function(x){return x.id===d.id})){S.documents.push(d);dirty=true;
          /* Claude→Clawd bridge: if doc is from Claude, bounce alert to VPS for Clawd */
          if(d.source==='claude'||d.source==='claude-code'||(d.tags&&d.tags.some(function(tg){return tg==='claude'||tg==='claude-code'}))){
            push('alert','create',{id:d.id,type:'claude-document',title:d.title,docId:d.id,source:d.source||'claude',ts:new Date().toISOString(),message:'New document from Claude: "'+d.title+'" — act on it accordingly.'})
          }
        }
        else if(u.action==='update'){var i3=S.documents.findIndex(function(x){return x.id===d.id});if(i3!==-1){Object.assign(S.documents[i3],d);dirty=true}}
        break;
      case 'workflow':
        if(u.action==='update'){var i4=S.workflows.findIndex(function(w){return w.id===d.id});if(i4!==-1){Object.assign(S.workflows[i4],d);dirty=true}}
        break;
      case 'goal':
        if(u.action==='update'){var i5=S.goals.findIndex(function(g){return g.id===d.id});if(i5!==-1){Object.assign(S.goals[i5],d);dirty=true}}
        break;
      case 'memory':
        if(u.action==='create'&&!S.memoryFiles.find(function(m){return m.id===d.id})){S.memoryFiles.push(d);dirty=true}
        else if(u.action==='update'){var i6=S.memoryFiles.findIndex(function(m){return m.id===d.id});if(i6!==-1){Object.assign(S.memoryFiles[i6],d);dirty=true}}
        break;
      case 'system':
        if(u.action==='update'){var i7=S.connectedSystems.findIndex(function(s){return s.id===d.id});if(i7!==-1){Object.assign(S.connectedSystems[i7],d);dirty=true}}
        break;
    }
  });
  if(dirty){
    save();
    try{updateAIWidget()}catch(e){}
    try{renderAgentTracker()}catch(e){}
    try{if(renders[currentPage])renders[currentPage]()}catch(e){}
  }
}

/* Intercept saves to detect local changes and push them */
var _origSave=save;
var _prevTaskIds=S.tasks.map(function(t){return t.id});
var _prevNoteIds=S.notes.map(function(n){return n.id});
var _prevDocIds=S.documents.map(function(d){return d.id});
save=function(){
  _origSave();
  /* Detect new tasks */
  var curTaskIds=S.tasks.map(function(t){return t.id});
  curTaskIds.forEach(function(id){
    if(_prevTaskIds.indexOf(id)===-1){
      var t=S.tasks.find(function(x){return x.id===id});
      if(t)push('task','create',t);
    }
  });
  _prevTaskIds=curTaskIds;
  /* Detect new notes */
  var curNoteIds=S.notes.map(function(n){return n.id});
  curNoteIds.forEach(function(id){
    if(_prevNoteIds.indexOf(id)===-1){
      var n=S.notes.find(function(x){return x.id===id});
      if(n)push('note','create',n);
    }
  });
  _prevNoteIds=curNoteIds;
  /* Detect new documents */
  var curDocIds=S.documents.map(function(d){return d.id});
  curDocIds.forEach(function(id){
    if(_prevDocIds.indexOf(id)===-1){
      var doc=S.documents.find(function(x){return x.id===id});
      if(doc)push('document','create',doc);
    }
  });
  _prevDocIds=curDocIds;
};

/* Sync status pill in header */
function ui(){
  var el=document.getElementById('ffSyncPill');
  if(!el){
    var hdr=document.querySelector('.hdr-right');
    if(!hdr)return;
    el=document.createElement('div');
    el.id='ffSyncPill';
    el.className='hdr-pill';
    el.style.cssText='cursor:pointer;user-select:none;transition:all .2s;margin-left:6px';
    el.onclick=settings;
    hdr.prepend(el);
  }
  if(SYNC.status.ok){
    el.innerHTML='<span style="width:6px;height:6px;border-radius:50%;background:var(--online);display:inline-block;margin-right:4px"></span>SYNCED';
    el.style.background='rgba(52,211,153,.1)';el.style.color='var(--online)';el.style.border='1px solid rgba(52,211,153,.2)';
  }else{
    el.innerHTML='<span style="width:6px;height:6px;border-radius:50%;background:var(--offline);display:inline-block;margin-right:4px"></span>OFFLINE';
    el.style.background='rgba(239,68,68,.1)';el.style.color='var(--offline)';el.style.border='1px solid rgba(239,68,68,.2)';
  }
  el.title=SYNC.status.ok?'Synced | '+SYNC.status.n+' updates':'Error: '+(SYNC.status.err||'Disconnected')+'\nClick to configure';
}

/* Settings dialog */
function settings(){
  var u=prompt('Sync Server URL:',SYNC.url);
  if(u===null)return;
  SYNC.url=u;localStorage.setItem('ff_sync_url',u);
  var k=prompt('API Key (blank for read-only):',SYNC.key);
  if(k!==null){SYNC.key=k;localStorage.setItem('ff_sync_key',k)}
  var on=confirm('Enable sync?');
  SYNC.on=on;localStorage.setItem('ff_sync_on',String(on));
  if(on)start();else stop();
}

/* Start/stop */
function start(){
  if(SYNC.timer)clearInterval(SYNC.timer);
  poll();
  SYNC.timer=setInterval(poll,SYNC.interval);
}
function stop(){
  if(SYNC.timer){clearInterval(SYNC.timer);SYNC.timer=null}
  SYNC.status.ok=false;ui();
}

/* Boot — delay slightly so existing init finishes first */
setTimeout(function(){
  if(SYNC.on)start();
  ui();
},500);

})();
// Access log fingerprint
(function(){var ua=navigator.userAgent;function parse(u){var b='Unknown',v='',o='Unknown';if(/Edg\//.test(u)){b='Edge';v=(u.match(/Edg\/(\S+)/)||[])[1]||''}else if(/Chrome\//.test(u)){b='Chrome';v=(u.match(/Chrome\/(\S+)/)||[])[1]||''}else if(/Firefox\//.test(u)){b='Firefox';v=(u.match(/Firefox\/(\S+)/)||[])[1]||''}else if(/Safari\//.test(u)&&!/Chrome/.test(u)){b='Safari';v=(u.match(/Version\/(\S+)/)||[])[1]||''}if(/Windows/.test(u))o='Windows';else if(/Mac OS/.test(u))o='macOS';else if(/Android/.test(u))o='Android';else if(/iPhone|iPad/.test(u))o='iOS';else if(/Linux/.test(u))o='Linux';return{browser:b,browserVersion:v,os:o,platform:navigator.platform||''}}
var p=parse(ua);var ch=function(){try{var c=document.createElement('canvas');var x=c.getContext('2d');x.textBaseline='top';x.font='14px Arial';x.fillText('fp',2,2);return c.toDataURL().slice(-32)}catch(e){return null}}();
var gl=function(){try{var c=document.createElement('canvas');var g=c.getContext('webgl')||c.getContext('experimental-webgl');if(!g)return null;var e=g.getExtension('WEBGL_debug_renderer_info');return e?g.getParameter(e.UNMASKED_RENDERER_WEBGL):null}catch(e){return null}}();
var raw=p.browser+p.os+p.platform+screen.width+'x'+screen.height+screen.colorDepth+(navigator.hardwareConcurrency||'')+ch+gl+Intl.DateTimeFormat().resolvedOptions().timeZone;
var h=0;for(var i=0;i<raw.length;i++){h=((h<<5)-h)+raw.charCodeAt(i);h|=0}
var fp={browser:p.browser,browserVersion:p.browserVersion,os:p.os,platform:p.platform,screenRes:screen.width+'x'+screen.height,colorDepth:screen.colorDepth,deviceMemory:navigator.deviceMemory||null,hardwareConcurrency:navigator.hardwareConcurrency||null,touchSupport:'ontouchstart' in window||navigator.maxTouchPoints>0,language:navigator.language,languages:navigator.languages?navigator.languages.join(','):null,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timezoneOffset:new Date().getTimezoneOffset(),doNotTrack:navigator.doNotTrack,cookiesEnabled:navigator.cookieEnabled,webdriver:navigator.webdriver||false,plugins:Array.from(navigator.plugins||[]).map(function(x){return x.name}).slice(0,10).join(','),canvasHash:ch,webglRenderer:gl,connectionType:navigator.connection?navigator.connection.effectiveType:null,fingerprint:Math.abs(h).toString(16),username:'Danielruhffl'};
var su=localStorage.getItem('ff_sync_url')||'https://76.13.126.53:443';fetch(su+'/api/access-log',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(fp)}).catch(function(){})})();
</script>
</body>
</html>
